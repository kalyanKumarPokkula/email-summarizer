/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={58:(e,t,r)=>{"use strict";r.d(t,{DS:()=>u,Tr:()=>c,bO:()=>s,gI:()=>o,xW:()=>l});var a=r(765),n=r(4350),i=r(9830);class s extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new s({start:e=>function r(){return t.read().then((({done:t,value:a})=>{if(!t)return e.enqueue(a),r();e.close()}))}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new s({async pull(t){const{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function o(e,t=2){const r=Array.from({length:t},(()=>[]));return r.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))}function l(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){const r={...e};for(const[e,a]of Object.entries(t))e in r&&!Array.isArray(r[e])?r[e]=l(r[e],a):r[e]=a;return r}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class c{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise(((t,r)=>{n.Nx.runWithConfig((0,a.DY)(e.config),(async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then((e=>t(void 0)),r)}),!0)}))}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?n.Nx.runWithConfig((0,a.DY)(this.config),this.signal?async()=>(0,i.o)(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function u(e,t,r,a,...n){const i=new c({generator:t,startSetup:r,signal:a}),s=await i.setup;return{output:e(i,s,...n),setup:s}}},199:(e,t,r)=>{"use strict";function a(e){return!(!e||"object"!=typeof e||!("type"in e)||"tool_call"!==e.type)}r.d(t,{K:()=>a,q:()=>n});class n extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}},204:e=>{const t=/^[0-9]+$/,r=(e,r)=>{const a=t.test(e),n=t.test(r);return a&&n&&(e=+e,r=+r),e===r?0:a&&!n?-1:n&&!a?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},228:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function a(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,a,i,s){if("function"!=typeof a)throw new TypeError("The listener must be a function");var o=new n(a,i||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function o(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,a,n=[];if(0===this._eventsCount)return n;for(a in e=this._events)t.call(e,a)&&n.push(r?a.slice(1):a);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e){var t=r?r+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var n=0,i=a.length,s=new Array(i);n<i;n++)s[n]=a[n].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,a=this._events[t];return a?a.fn?1:a.length:0},o.prototype.emit=function(e,t,a,n,i,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,a),!0;case 4:return u.fn.call(u.context,t,a,n),!0;case 5:return u.fn.call(u.context,t,a,n,i),!0;case 6:return u.fn.call(u.context,t,a,n,i,s),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,a);break;case 4:u[c].fn.call(u[c].context,t,a,n);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,a,n){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||n&&!o.once||a&&o.context!==a||s(this,i);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||n&&!o[l].once||a&&o[l].context!==a)&&c.push(o[l]);c.length?this._events[i]=1===c.length?c[0]:c:s(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new a,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},329:(e,t,r)=>{"use strict";r.d(t,{L:()=>i});var a=r(5311),n=r(6993);class i extends n.m{async formatPromptValue(e){const t=await this.format(e);return new a.HY(t)}}},365:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var a=r(1601),n=r.n(a),i=r(6314),s=r.n(i)()(n());s.push([e.id,":root {\n\t--primary-color: #32cd32;\n\t--secondary-color: #90ee90;\n\t--font-color-primary: #070f0a;\n\t--font-color-secondary: #363636;\n\t--background-color: #eeeeee;\n}\n\n.summary-sidebar {\n\twidth: 300px;\n\theight: auto;\n\tbackground-color: var(--background-color);\n\t/* border: 1px solid #e0e0e0; */\n\tborder-radius: 8px;\n\tpadding: 15px;\n\tbox-sizing: border-box;\n\toverflow-y: auto; /* In case summary is long */\n\tmargin-left: 15px; /* Add some left margin to separate from Gmail content */\n\tbox-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */\n\tposition: relative; /*  Enable positioning for pseudo-element */\n\tcolor: var(\n\t\t--font-color-secondary\n\t); /* Ensure text is visible on the dark background, adjust if needed */\n}\n\n.summary-sidebar h1 {\n\tcolor: var(--primary-color);\n\tfont-size: 22px;\n}\n\n.summary-sidebar h2 {\n\tcolor: var(--font-color-primary);\n}\n\n.intoCopy ul {\n\tlist-style: none; /* Remove default bullets */\n\tpadding-left: 0; /* Remove default padding */\n}\n\n.intoCopy li::before {\n\tcontent: '➡️ '; /* Add arrow icon before each item */\n\tmargin-right: 5px;\n}\n\n.intoCopy button {\n\tmargin-top: 5%;\n\tbackground-color: var(--primary-color);\n\tcolor: var(--background-color);\n\tfont-size: 16px;\n\twidth: 100%;\n\talign-items: center;\n\tborder: none;\n\tborder-radius: 4px;\n\tpadding: 5% 0 5% 0;\n}\n\n.summary-content {\n\tmargin-top: 10px; /* Adjust margin for better spacing */\n}\n\n.summary-header {\n\tfont-size: 16px;\n\tfont-weight: bold;\n\tmargin-bottom: 10px;\n\tcolor: #1f1f1f; /* Adjust margin for better spacing */\n}\n\n.summary-text {\n\twhite-space: pre-wrap;\n\tline-height: 1.5;\n\tfont-size: 14px;\n\tcolor: #202124;\n}\n\n/* New styles for the email content box */\n.email-content-box {\n\tborder: 1px solid #e0e0e0; /* Light gray border */\n\tborder-radius: 8px; /* Rounded corners */\n\tpadding: 10px; /* Padding inside the box */\n\tbackground-color: #f9f9f9; /* Light background color */\n\tbox-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* Subtle shadow */\n\tmargin-top: 20px; /* Space above the content box */\n}\n\n.copy-feedback {\n\tposition: fixed;\n\ttop: 20px;\n\tright: 20px;\n\tbackground-color: #4caf50; /* Green background */\n\tcolor: white;\n\tpadding: 10px;\n\tborder-radius: 5px;\n\tbox-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);\n\tz-index: 1000; /* Ensure it appears above other elements */\n}\n\n.action-items h3 {\n\tcolor: var(--font-color-primary);\n}\n\n.action-items ul {\n\tlist-style: none; /* Remove default bullets */\n\tpadding-left: 0; /* Remove default padding */\n}\n\n.action-items li::before {\n\tcontent: '⚙️ '; /* Add arrow icon before each item */\n\tmargin-right: 5px;\n}\n\n/* Styles for action buttons in the sidebar */\n.actionButtons button {\n\tpadding: 8px 15px;\n\tborder-radius: 4px;\n\tcursor: pointer;\n\tborder: none; /* Remove default border */\n\tcolor: white; /* Default text color for primary buttons */\n}\n\n/* Styles for action buttons container to add spacing */\n.actionButtons {\n\tdisplay: flex; /* Use flexbox to easily control spacing */\n\tgap: 10px; /* Add a gap of 10px between the flex items (buttons) */\n\tjustify-content: flex-start; /* Align buttons to the start if container is wider */\n\t/* or justify-content: space-between; if you want buttons to spread out */\n}\n\n/* Styles for action buttons in the sidebar */\n.actionButtons button {\n\tpadding: 8px 15px;\n\tborder-radius: 4px;\n\tcursor: pointer;\n\t/* border: 1px solid var(--primary-color); */\n\tcolor: #ffffff;\n\t/* margin-right: 10px;  No need for margin-right anymore with flex gap */\n}\n\n/* Style for the Copy and Reply buttons (primary color) */\n.actionButtons button:nth-child(1), /* Selects the first button (Copy) */\n  .actionButtons button:nth-child(3)  /* Selects the third button (Reply) */ {\n\tbackground-color: var(--primary-color); /* Gmail-like blue color */\n}\n\n/* Style for the Double Check button (transparent) */\n.actionButtons button:nth-child(2) /* Selects the second button (Double Check) */ {\n\tbackground-color: var(--primary-color);\n\tborder: 1px solid #ccc; /* Light grey border */\n\tcolor: #555; /* Dark grey text */\n\tcolor: inherit;\n\tcolor: black;\n\tcolor: rgba(0, 0, 0, 0.87);\n\tcolor: #202124;\n}\n\n/* Optional: Hover effect */\n.actionButtons button:hover {\n\topacity: 0.9;\n}\n\n/* Optional: Focus effect\n.actionButtons button:focus {\n\toutline: 1px solid #32cd32;\n\toutline-offset: 2px;\n} */\n\n.nav-header {\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 10px 5px;\n\t/* border-bottom: 1px solid #e0e0e0; */\n\t/* background-color: #fff; */\n\tposition: sticky;\n\ttop: 0;\n\tz-index: 1;\n}\n\n.back-button {\n\tbackground: none;\n\tborder: none;\n\tfont-size: 24px;\n\tcursor: pointer;\n\tpadding: 5px 10px;\n\tmargin-right: 10px;\n\tcolor: var(--font-color-primary);\n\tborder-radius: 50%;\n\twidth: 36px;\n\theight: 36px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.back-button:hover {\n\ttransform: scale(1.07); /* Enlarge the button slightly */\n\ttransition: transform 0.2s ease; /* Smooth transition effect */\n}\n\n.nav-header h1 {\n\tmargin: 0;\n\tfont-size: 18px;\n\tflex-grow: 1;\n}\n\n.privacy-toggle-container {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tmargin-top: 20px;\n\tpadding: 10px;\n\tbackground-color: rgba(50, 205, 50, 0.1);\n\tborder-radius: 8px;\n}\n\n.toggle-label {\n\tcolor: var(--font-color-primary);\n\tfont-size: 16px;\n\tfont-weight: 500;\n}\n\n.switch {\n\tposition: relative;\n\tdisplay: inline-block;\n\twidth: 50px;\n\theight: 24px;\n}\n\n.switch input {\n\topacity: 0;\n\twidth: 0;\n\theight: 0;\n}\n\n.slider {\n\tposition: absolute;\n\tcursor: pointer;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: #ccc;\n\ttransition: 0.4s;\n\tborder-radius: 24px;\n}\n\n.slider:before {\n\tposition: absolute;\n\tcontent: '';\n\theight: 16px;\n\twidth: 16px;\n\tleft: 4px;\n\tbottom: 4px;\n\tbackground-color: white;\n\ttransition: 0.4s;\n\tborder-radius: 50%;\n}\n\ninput:checked + .slider {\n\tbackground-color: var(--primary-color);\n}\n\ninput:checked + .slider:before {\n\ttransform: translateX(26px);\n}\n\n/* Optional hover effect */\n.switch:hover .slider:before {\n\tbox-shadow: 0 0 3px rgba(0, 0, 0, 0.2);\n}\n",""]);const o=s},487:(e,t,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:i}=r(6261),s=r(6735),o=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],u=t.safeSrc=[],d=t.t={};let h=0;const p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",i],[p,n]],f=(e,t,r)=>{const a=(e=>{for(const[t,r]of m)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=h++;s(e,n,t),d[e]=n,c[n]=t,u[n]=a,o[n]=new RegExp(t,r?"g":void 0),l[n]=new RegExp(a,r?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),f("MAINVERSION",`(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${c[d.NUMERICIDENTIFIER]}|${c[d.NONNUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${c[d.NUMERICIDENTIFIERLOOSE]}|${c[d.NONNUMERICIDENTIFIER]})`),f("PRERELEASE",`(?:-(${c[d.PRERELEASEIDENTIFIER]}(?:\\.${c[d.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${c[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[d.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${p}+`),f("BUILD",`(?:\\+(${c[d.BUILDIDENTIFIER]}(?:\\.${c[d.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${c[d.MAINVERSION]}${c[d.PRERELEASE]}?${c[d.BUILD]}?`),f("FULL",`^${c[d.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${c[d.MAINVERSIONLOOSE]}${c[d.PRERELEASELOOSE]}?${c[d.BUILD]}?`),f("LOOSE",`^${c[d.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${c[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${c[d.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:${c[d.PRERELEASE]})?${c[d.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:${c[d.PRERELEASELOOSE]})?${c[d.BUILD]}?)?)?`),f("XRANGE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${a}})(?:\\.(\\d{1,${a}}))?(?:\\.(\\d{1,${a}}))?`),f("COERCE",`${c[d.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",c[d.COERCEPLAIN]+`(?:${c[d.PRERELEASE]})?`+`(?:${c[d.BUILD]})?(?:$|[^\\d])`),f("COERCERTL",c[d.COERCE],!0),f("COERCERTLFULL",c[d.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${c[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",f("TILDE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${c[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",f("CARET",`^${c[d.LONECARET]}${c[d.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${c[d.LONECARET]}${c[d.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${c[d.GTLT]}\\s*(${c[d.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]}|${c[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${c[d.XRANGEPLAIN]})\\s+-\\s+(${c[d.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${c[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[d.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},534:(e,t,r)=>{const a=r(9558);e.exports=(e,t)=>new a(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},547:(e,t,r)=>{const a=r(4899);e.exports=(e,t)=>new a(e,t).minor},639:e=>{e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},747:(e,t,r)=>{"use strict";r.d(t,{Y:()=>i});const a=(...e)=>fetch(...e),n=Symbol.for("ls:fetch_implementation"),i=()=>globalThis[n]??a},753:(e,t,r)=>{const a=r(9558);e.exports=(e,t,r)=>(e=new a(e,r),t=new a(t,r),e.intersects(t,r))},765:(e,t,r)=>{"use strict";r.d(t,{DY:()=>d,SV:()=>o,ZI:()=>c,kJ:()=>s,p_:()=>i,tn:()=>u});var a=r(5780),n=r(4350);const i=25;async function s(e){return a.Td._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function o(...e){const t={};for(const r of e.filter((e=>!!e)))for(const e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){const a=t[e]??[];t[e]=[...new Set(a.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=r.timeout:void 0!==r.timeout&&(t.timeout=Math.min(t.timeout,r.timeout));else if("signal"===e)void 0===t.signal?t.signal=r.signal:void 0!==r.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,r.signal]):t.signal=r.signal);else if("callbacks"===e){const e=t.callbacks,n=r.callbacks;if(Array.isArray(n))if(e)if(Array.isArray(e))t.callbacks=e.concat(n);else{const r=e.copy();for(const e of n)r.addHandler((0,a.tW)(e),!0);t.callbacks=r}else t.callbacks=n;else if(n)if(e)if(Array.isArray(e)){const r=n.copy();for(const t of e)r.addHandler((0,a.tW)(t),!0);t.callbacks=r}else t.callbacks=new a.Td(n._parentRunId,{handlers:e.handlers.concat(n.handlers),inheritableHandlers:e.inheritableHandlers.concat(n.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(n.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(n.inheritableTags))),metadata:{...e.metadata,...n.metadata}});else t.callbacks=n}else{const a=e;t[a]=r[a]??t[a]}return t}const l=new Set(["string","number","boolean"]);function c(e){const t=n.Nx.getRunnableConfig();let r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){const{runId:e,runName:a,...n}=t;r=Object.entries(n).reduce(((e,[t,r])=>(void 0!==r&&(e[t]=r),e)),r)}if(e&&(r=Object.entries(e).reduce(((e,[t,r])=>(void 0!==r&&(e[t]=r),e)),r)),r?.configurable)for(const e of Object.keys(r.configurable))l.has(typeof r.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=r.configurable[e]);if(void 0!==r.timeout){if(r.timeout<=0)throw new Error("Timeout must be a positive number");const e=AbortSignal.timeout(r.timeout);void 0!==r.signal?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,e])):r.signal=e,delete r.timeout}return r}function u(e={},{callbacks:t,maxConcurrency:r,recursionLimit:a,runName:n,configurable:i,runId:s}={}){const o=c(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==a&&(o.recursionLimit=a),void 0!==r&&(o.maxConcurrency=r),void 0!==n&&(o.runName=n),void 0!==i&&(o.configurable={...o.configurable,...i}),void 0!==s&&delete o.runId,o}function d(e){return e?{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal}:void 0}},780:(e,t,r)=>{"use strict";function a(e,t=n){e=e.trim();const r=/```(json)?(.*)```/s.exec(e);return t(r?r[2]:e)}function n(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="";const r=[];let a=!1,n=!1;for(let i of e){if(a)'"'!==i||n?"\n"!==i||n?n="\\"===i&&!n:i="\\n":a=!1;else if('"'===i)a=!0,n=!1;else if("{"===i)r.push("}");else if("["===i)r.push("]");else if("}"===i||"]"===i){if(!r||r[r.length-1]!==i)return null;r.pop()}t+=i}a&&(t+='"');for(let e=r.length-1;e>=0;e-=1)t+=r[e];try{return JSON.parse(t)}catch(e){return null}}r.d(t,{D:()=>a,d:()=>n})},818:(e,t,r)=>{const a=r(4621);e.exports=(e,t,r)=>0===a(e,t,r)},995:(e,t,r)=>{const a=r(9558);e.exports=(e,t,r)=>{try{t=new a(t,r)}catch(e){return!1}return t.test(e)}},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1259:(e,t,r)=>{"use strict";r.d(t,{Kj:()=>a.Kj,gk:()=>a.gk});var a=r(6928)},1368:(e,t,r)=>{"use strict";function a(e,t){return e.lc_error_code=t,e.message=`${e.message}\n\nTroubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/\n`,e}r.d(t,{Y:()=>a})},1534:(e,t,r)=>{const a=r(818),n=r(9606),i=r(2559),s=r(7372),o=r(4056),l=r(6133);e.exports=(e,t,r,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return a(e,r,c);case"!=":return n(e,r,c);case">":return i(e,r,c);case">=":return s(e,r,c);case"<":return o(e,r,c);case"<=":return l(e,r,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},1590:(e,t,r)=>{"use strict";r.d(t,{J:()=>s,j:()=>i});var a=r(5960);function n(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function i(e){return"function"==typeof e._addRunToRunMap}class s extends a.NK{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`\n\n${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=function(e,t,r){const a=r.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${a}Z`.replace(/[-:.]/g,"")+t}(e.start_time,e.id,e.execution_order),r={...e};if(void 0!==r.parent_run_id){const e=this.runMap.get(r.parent_run_id);e&&(this._addChildRun(e,r),e.child_execution_order=Math.max(e.child_execution_order,r.child_execution_order),r.trace_id=e.trace_id,void 0!==e.dotted_order&&(r.dotted_order=[e.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,a,n,i,s,o){const l=this._getExecutionOrder(a),c=Date.now(),u=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:i||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,a,n,i,s,o){const l=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,a,n,i,s,o);return await(this.onRunCreate?.(l)),await(this.onLLMStart?.(l)),l}_createRunForChatModelStart(e,t,r,a,n,i,s,o){const l=this._getExecutionOrder(a),c=Date.now(),u=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:i||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,a,n,i,s,o){const l=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,a,n,i,s,o);return await(this.onRunCreate?.(l)),await(this.onLLMStart?.(l)),l}async handleLLMEnd(e,t,r,a,n){const i=this.runMap.get(t);if(!i||"llm"!==i?.run_type)throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...n},await(this.onLLMEnd?.(i)),await this._endTrace(i),i}async handleLLMError(e,t,r,a,n){const i=this.runMap.get(t);if(!i||"llm"!==i?.run_type)throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...n},await(this.onLLMError?.(i)),await this._endTrace(i),i}_createRunForChainStart(e,t,r,a,n,i,s,o){const l=this._getExecutionOrder(a),c=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return this._addRunToRunMap(u)}async handleChainStart(e,t,r,a,n,i,s,o){const l=this.runMap.get(r)??this._createRunForChainStart(e,t,r,a,n,i,s,o);return await(this.onRunCreate?.(l)),await(this.onChainStart?.(l)),l}async handleChainEnd(e,t,r,a,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=n(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=n(i.inputs,"input")),await(this.onChainEnd?.(s)),await this._endTrace(s),s}async handleChainError(e,t,r,a,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=n(i.inputs,"input")),await(this.onChainError?.(s)),await this._endTrace(s),s}_createRunForToolStart(e,t,r,a,n,i,s){const o=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,r,a,n,i,s){const o=this.runMap.get(r)??this._createRunForToolStart(e,t,r,a,n,i,s);return await(this.onRunCreate?.(o)),await(this.onToolStart?.(o)),o}async handleToolEnd(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onToolEnd?.(r)),await this._endTrace(r),r}async handleToolError(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onToolError?.(r)),await this._endTrace(r),r}async handleAgentAction(e,t){const r=this.runMap.get(t);if(!r||"chain"!==r?.run_type)return;const a=r;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(r))}async handleAgentEnd(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(r)))}_createRunForRetrieverStart(e,t,r,a,n,i,s){const o=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,r,a,n,i,s){const o=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,a,n,i,s);return await(this.onRunCreate?.(o)),await(this.onRetrieverStart?.(o)),o}async handleRetrieverEnd(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverEnd?.(r)),await this._endTrace(r),r}async handleRetrieverError(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverError?.(r)),await this._endTrace(r),r}async handleText(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(r)))}async handleLLMNewToken(e,t,r,a,n,i){const s=this.runMap.get(r);if(!s||"llm"!==s?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await(this.onLLMNewToken?.(s,e,{chunk:i?.chunk})),s}}},1601:e=>{"use strict";e.exports=function(e){return e[1]}},1620:(e,t,r)=>{const a=r(995),n=r(4621);e.exports=(e,t,r)=>{const i=[];let s=null,o=null;const l=e.sort(((e,t)=>n(e,t,r)));for(const e of l)a(e,t,r)?(o=e,s||(s=e)):(o&&i.push([s,o]),o=null,s=null);s&&i.push([s,null]);const c=[];for(const[e,t]of i)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const u=c.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return u.length<d.length?u:t}},1673:(e,t,r)=>{"use strict";r.d(t,{Od:()=>a.Od,H:()=>a.H,XQ:()=>n.XQ,cM:()=>i.cM,xc:()=>o.xc,tn:()=>l.tn,K0:()=>c.K0,Sw:()=>c.Sw,KX:()=>a.KX,jm:()=>a.jm,ny:()=>n.ny});var a=r(7765),n=r(3490),i=r(4301),s=r(8675),o=r(5454),l=r(7974),c=r(6362);r(3230);n.XQ;var u=r(8009);o.xc,o.a7,a.Od,a.H,l.tn,l.uU,l.tn,l.uU,u.uf,u.dr,s.mg,s.FK,i.cM,i.XU},2153:(e,t,r)=>{const a=r(9558);e.exports=(e,t)=>{try{return new a(e,t).range||"*"}catch(e){return null}}},2366:(e,t,r)=>{"use strict";r.d(t,{Ik:()=>M});const a=Symbol("Let zodToJsonSchema decide on which parser to use"),n={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};var i=r(4476);function s(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function o(e,t,r,a,n){e[t]=r,s(e,t,a,n)}function l(e,t){return $(e.type._def,t)}function c(e,t,r){const a=r??t.dateStrategy;if(Array.isArray(a))return{anyOf:a.map(((r,a)=>c(e,t,r)))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return u(e,t)}}const u=(e,t)=>{const r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(const a of e.checks)switch(a.kind){case"min":o(r,"minimum",a.value,a.message,t);break;case"max":o(r,"maximum",a.value,a.message,t)}return r};let d;const h=/^[cC][^\s-]{8,}$/,p=/^[0-9a-z]+$/,m=/^[0-9A-HJKMNP-TV-Z]{26}$/,f=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,g=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,y=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,b=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,v=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,_=/^[a-zA-Z0-9_-]{21}$/,w=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function E(e,t){const r={type:"string"};if(e.checks)for(const a of e.checks)switch(a.kind){case"min":o(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":o(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":k(r,"email",a.message,t);break;case"format:idn-email":k(r,"idn-email",a.message,t);break;case"pattern:zod":T(r,f,a.message,t)}break;case"url":k(r,"uri",a.message,t);break;case"uuid":k(r,"uuid",a.message,t);break;case"regex":T(r,a.regex,a.message,t);break;case"cuid":T(r,h,a.message,t);break;case"cuid2":T(r,p,a.message,t);break;case"startsWith":T(r,RegExp(`^${O(a.value,t)}`),a.message,t);break;case"endsWith":T(r,RegExp(`${O(a.value,t)}$`),a.message,t);break;case"datetime":k(r,"date-time",a.message,t);break;case"date":k(r,"date",a.message,t);break;case"time":k(r,"time",a.message,t);break;case"duration":k(r,"duration",a.message,t);break;case"length":o(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),o(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":T(r,RegExp(O(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&k(r,"ipv4",a.message,t),"v4"!==a.version&&k(r,"ipv6",a.message,t);break;case"base64url":T(r,v,a.message,t);break;case"jwt":T(r,w,a.message,t);break;case"cidr":"v6"!==a.version&&T(r,g,a.message,t),"v4"!==a.version&&T(r,y,a.message,t);break;case"emoji":T(r,(void 0===d&&(d=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),d),a.message,t);break;case"ulid":T(r,m,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":k(r,"binary",a.message,t);break;case"contentEncoding:base64":o(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":T(r,b,a.message,t)}break;case"nanoid":T(r,_,a.message,t)}return r}function O(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)x.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}const x=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function k(e,t,r,a){e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):o(e,"format",t,r,a)}function T(e,t,r,a){e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:I(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):o(e,"pattern",I(t,a),r,a)}function I(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const r=e.flags.includes("i"),a=e.flags.includes("m"),n=e.flags.includes("s"),i=r?e.source.toLowerCase():e.source;let s="",o=!1,l=!1,c=!1;for(let e=0;e<i.length;e++)if(o)s+=i[e],o=!1;else{if(r)if(l){if(i[e].match(/[a-z]/)){c?(s+=i[e],s+=`${i[e-2]}-${i[e]}`.toUpperCase(),c=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(s+=i[e],c=!0):s+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){s+=`[${i[e]}${i[e].toUpperCase()}]`;continue}if(a){if("^"===i[e]){s+="(^|(?<=[\r\n]))";continue}if("$"===i[e]){s+="($|(?=[\r\n]))";continue}}n&&"."===i[e]?s+=l?`${i[e]}\r\n`:`[${i[e]}\r\n]`:(s+=i[e],"\\"===i[e]?o=!0:l&&"]"===i[e]?l=!1:l||"["!==i[e]||(l=!0))}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function S(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===i.kY.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((r,a)=>({...r,[a]:$(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}})),{}),additionalProperties:!1};const r={type:"object",additionalProperties:$(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===i.kY.ZodString&&e.keyType._def.checks?.length){const{type:a,...n}=E(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===i.kY.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===i.kY.ZodBranded&&e.keyType._def.type._def.typeName===i.kY.ZodString&&e.keyType._def.type._def.checks?.length){const{type:a,...n}=l(e.keyType._def,t);return{...r,propertyNames:n}}return r}const P={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},A=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,r)=>$(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return r.length?{anyOf:r}:void 0};function j(e,t){return"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:$(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:$(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}const C=(e,t,r)=>{switch(t){case i.kY.ZodString:return E(e,r);case i.kY.ZodNumber:return function(e,t){const r={type:"number"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"int":r.type="integer",s(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?o(r,"minimum",a.value,a.message,t):o(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),o(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?o(r,"maximum",a.value,a.message,t):o(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),o(r,"maximum",a.value,a.message,t));break;case"multipleOf":o(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case i.kY.ZodObject:return function(e,t){const r="openAi"===t.target,a={type:"object",...Object.entries(e.shape()).reduce(((e,[a,n])=>{if(void 0===n||void 0===n._def)return e;let s=n.isOptional();s&&r&&(n instanceof i.Ii&&(n=n._def.innerType),n.isNullable()||(n=n.nullable()),s=!1);const o=$(n._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return void 0===o?e:{properties:{...e.properties,[a]:o},required:s?e.required:[...e.required,a]}}),{properties:{},required:[]}),additionalProperties:j(e,t)};return a.required.length||delete a.required,a}(e,r);case i.kY.ZodBigInt:return function(e,t){const r={type:"integer",format:"int64"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?o(r,"minimum",a.value,a.message,t):o(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),o(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?o(r,"maximum",a.value,a.message,t):o(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),o(r,"maximum",a.value,a.message,t));break;case"multipleOf":o(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case i.kY.ZodBoolean:return{type:"boolean"};case i.kY.ZodDate:return c(e,r);case i.kY.ZodUndefined:return{not:{}};case i.kY.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(r);case i.kY.ZodArray:return function(e,t){const r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==i.kY.ZodAny&&(r.items=$(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&o(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&o(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(o(r,"minItems",e.exactLength.value,e.exactLength.message,t),o(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case i.kY.ZodUnion:case i.kY.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return A(e,t);const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every((e=>e._def.typeName in P&&(!e._def.checks||!e._def.checks.length)))){const e=r.reduce(((e,t)=>{const r=P[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e}),[]);return{type:e.length>1?e:e[0]}}if(r.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=r.reduce(((e,t)=>{const r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===r.length){const t=e.filter(((e,t,r)=>r.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:r.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(r.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:r.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return A(e,t)}(e,r);case i.kY.ZodIntersection:return function(e,t){const r=[$(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),$(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const n=[];return r.forEach((e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:r,...a}=e;t=a}else a=void 0;n.push(t)}else n.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);var t})),n.length?{allOf:n,...a}:void 0}(e,r);case i.kY.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,r)=>$(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:$(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,r)=>$(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}(e,r);case i.kY.ZodRecord:return S(e,r);case i.kY.ZodLiteral:return function(e,t){const r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case i.kY.ZodEnum:return function(e){return{type:"string",enum:Array.from(e.values)}}(e);case i.kY.ZodNativeEnum:return function(e){const t=e.values,r=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),a=Array.from(new Set(r.map((e=>typeof e))));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case i.kY.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:P[e.innerType._def.typeName],nullable:!0}:{type:[P[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const r=$(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const r=$(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case i.kY.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return $(e.innerType._def,t);const r=$(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}})(e,r);case i.kY.ZodMap:return function(e,t){return"record"===t.mapStrategy?S(e,t):{type:"array",maxItems:125,items:{type:"array",items:[$(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},$(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case i.kY.ZodSet:return function(e,t){const r={type:"array",uniqueItems:!0,items:$(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&o(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&o(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case i.kY.ZodLazy:return()=>e.getter()._def;case i.kY.ZodPromise:return function(e,t){return $(e.type._def,t)}(e,r);case i.kY.ZodNaN:case i.kY.ZodNever:return{not:{}};case i.kY.ZodEffects:return function(e,t){return"input"===t.effectStrategy?$(e.schema._def,t):{}}(e,r);case i.kY.ZodAny:case i.kY.ZodUnknown:return{};case i.kY.ZodDefault:return function(e,t){return{...$(e.innerType._def,t),default:e.defaultValue()}}(e,r);case i.kY.ZodBranded:return l(e,r);case i.kY.ZodReadonly:case i.kY.ZodCatch:return((e,t)=>$(e.innerType._def,t))(e,r);case i.kY.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return $(e.in._def,t);if("output"===t.pipeStrategy)return $(e.out._def,t);const r=$(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[r,$(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]})].filter((e=>void 0!==e))}})(e,r);case i.kY.ZodFunction:case i.kY.ZodVoid:case i.kY.ZodSymbol:default:return}};function $(e,t,r=!1){const n=t.seen.get(e);if(t.override){const i=t.override?.(e,t,n,r);if(i!==a)return i}if(n&&!r){const e=N(n,t);if(void 0!==e)return e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const s=C(e,e.typeName,t),o="function"==typeof s?$(s(),t):s;if(o&&L(e,t,o),t.postProcess){const r=t.postProcess(o,e,t);return i.jsonSchema=o,r}return i.jsonSchema=o,o}const N=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:R(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,r)=>t.currentPath[r]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},R=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},L=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),M=(e,t)=>{const r=(e=>{const t=(e=>"string"==typeof e?{...n,name:e}:{...n,...e})(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map((([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}})(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,a])=>({...e,[t]:$(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}})),{}):void 0,i="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,s=$(e._def,void 0===i?r:{...r,currentPath:[...r.basePath,r.definitionPath,i]},!1)??{},o="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==o&&(s.title=o);const l=void 0===i?a?{...s,[r.definitionPath]:a}:s:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:{...a,[i]:s}};return"jsonSchema7"===r.target?l.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"!==r.target&&"openAi"!==r.target||(l.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in l||"oneOf"in l||"allOf"in l||"type"in l&&Array.isArray(l.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),l}},2469:(e,t,r)=>{const a=r(4621);e.exports=(e,t,r)=>a(t,e,r)},2559:(e,t,r)=>{const a=r(4621);e.exports=(e,t,r)=>a(e,t,r)>0},2729:e=>{"use strict";const t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,a=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,i=/[_.\- ]+/,s=new RegExp("^"+i.source),o=new RegExp(i.source+n.source,"gu"),l=new RegExp("\\d+"+n.source,"gu"),c=(e,n)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(n={pascalCase:!1,preserveConsecutiveUppercase:!1,...n},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const i=!1===n.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(n.locale),c=!1===n.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(n.locale);return 1===e.length?n.pascalCase?c(e):i(e):(e!==i(e)&&(e=((e,a,n)=>{let i=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){const c=e[l];i&&t.test(c)?(e=e.slice(0,l)+"-"+e.slice(l),i=!1,o=s,s=!0,l++):s&&o&&r.test(c)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,i=!0):(i=a(c)===c&&n(c)!==c,o=s,s=n(c)===c&&a(c)!==c)}return e})(e,i,c)),e=e.replace(s,""),e=n.preserveConsecutiveUppercase?((e,t)=>(a.lastIndex=0,e.replace(a,(e=>t(e)))))(e,i):i(e),n.pascalCase&&(e=c(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,((e,r)=>t(r))).replace(l,(e=>t(e)))))(e,c))};e.exports=c,e.exports.default=c},2738:(e,t,r)=>{"use strict";r.d(t,{Kj:()=>$});var a=r(3829),n=r(4116),i=r(3290),s=r(747);const o=[400,401,403,404,405,406,407,408],l=[409];class c{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.queue=new i.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add((()=>n((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response,a=t?.status;if(a){if(o.includes(+a))throw e;if(l.includes(+a))return;r&&await r(t)}},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>(0,s.Y)()(...e).then((e=>e.ok?e:Promise.reject(e)))))}}function u(e){return"function"==typeof e?._getType}function d(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}var h=r(4785),p=r(6928),m=r(8227);function f(e,t){if(!m.A(e))throw new Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}var g=r(6232);function y(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw new Error(`Invalid identifier format: ${e}`);const[t,r]=e.split(":"),a=r||"latest";if(t.includes("/")){const[r,n]=t.split("/",2);if(!r||!n)throw new Error(`Invalid identifier format: ${e}`);return[r,n,a]}if(!t)throw new Error(`Invalid identifier format: ${e}`);return["-",t,a]}r(7280);class b extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function v(e,t,r){let a;if(e.ok)return void(r&&(a=await e.text()));a=await e.text();const n=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Server response: ${a}`;if(409===e.status)throw new b(n);throw new Error(n)}var _="[...]",w={result:"[Circular]"},E=[],O=[];const x=new TextEncoder;function k(e){return x.encode(e)}function T(e,t,r,a){try{return k(JSON.stringify(e,t,r))}catch(n){if(!n.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."),k("[Unserializable]");let i;console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),void 0===a&&(a={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),S(e,"",0,[],void 0,0,a);try{i=0===O.length?JSON.stringify(e,t,r):JSON.stringify(e,function(e){return e=void 0!==e?e:function(e,t){return t},function(t,r){if(O.length>0)for(var a=0;a<O.length;a++){var n=O[a];if(n[1]===t&&n[0]===r){r=n[2],O.splice(a,1);break}}return e.call(this,t,r)}}(t),r)}catch(e){return k("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==E.length;){const e=E.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return k(i)}}function I(e,t,r,a){var n=Object.getOwnPropertyDescriptor(a,r);void 0!==n.get?n.configurable?(Object.defineProperty(a,r,{value:e}),E.push([a,r,t,n])):O.push([t,r,e]):(a[r]=e,E.push([a,r,t]))}function S(e,t,r,a,n,i,s){var o;if(i+=1,"object"==typeof e&&null!==e){for(o=0;o<a.length;o++)if(a[o]===e)return void I(w,e,t,n);if(void 0!==s.depthLimit&&i>s.depthLimit)return void I(_,e,t,n);if(void 0!==s.edgesLimit&&r+1>s.edgesLimit)return void I(_,e,t,n);if(a.push(e),Array.isArray(e))for(o=0;o<e.length;o++)S(e[o],o,o,a,e,i,s);else{var l=Object.keys(e);for(o=0;o<l.length;o++){var c=l[o];S(e[c],c,o,a,e,i,s)}}a.pop()}}function P(e){const t=(0,h.Ec)(),r=(0,h.yk)(),a=e.extra??{},n=a.metadata;return e.extra={...a,runtime:{...t,...a?.runtime},metadata:{...r,...r.revision_id||e.revision_id?{revision_id:e.revision_id??r.revision_id}:{},...n}},e}function A(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const j=async e=>{if(429===e?.status){const t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise((e=>setTimeout(e,t))),!0}return!1};class C{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise((e=>{t=e})),a=T(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:a}),this.sizeBytes+=a,r}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){const e=this.items.shift();e&&(t.push(e),r+=e.size,this.sizeBytes-=e.size)}if(0===t.length&&this.items.length>0){const e=this.items.shift();t.push(e),r+=e.size,this.sizeBytes-=e.size}return[t.map((e=>({action:e.action,item:e.payload}))),()=>t.forEach((e=>e.itemPromiseResolve()))]}}class ${constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new C}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===(0,h.Az)("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=$.getDefaultClientConfig();if(this.tracingSampleRate=(()=>{const e=(0,h.Jz)("TRACING_SAMPLING_RATE");if(void 0===e)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t})(),this.apiUrl=A(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=A(e.apiKey??t.apiKey),this.webUrl=A(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new c(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new c({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:j}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=(0,h.Jz)("API_KEY");return{apiUrl:(0,h.Jz)("ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===(0,h.Jz)("HIDE_INPUTS"),hideOutputs:"true"===(0,h.Jz)("HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:(()=>{const e=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===e||"127.0.0.1"===e||"::1"===e})()?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${p.Ls}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,n=await this.caller.call((0,s.Y)(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(n,`Failed to fetch ${e}`),n}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let a=Number(t.get("offset"))||0;const n=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(n));const i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call((0,s.Y)(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(o,`Failed to fetch ${e}`);const l=r?r(await o.json()):await o.json();if(0===l.length)break;if(yield l,l.length<n)break;a+=l.length}}async*_getCursorPaginatedList(e,t=null,r="POST",a="runs"){const n=t?{...t}:{};for(;;){const t=await this.caller.call((0,s.Y)(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(n)}),i=await t.json();if(!i)break;if(!i[a])break;yield i[a];const o=i.cursors;if(!o)break;if(!o.next)break;n.cursor=o.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){const t=[];for(const r of e)this.filteredPostUuids.has(r.id)?this.filteredPostUuids.delete(r.id):t.push(r);return t}{const t=[];for(const r of e)r.id!==r.trace_id&&!this.filteredPostUuids.has(r.trace_id)||Math.random()<this.tracingSampleRate?t.push(r):this.filteredPostUuids.add(r.id);return t}}async _getBatchSizeLimitBytes(){const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??20971520}async _getMultiPartSupport(){const e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[r,a]=this.autoBatchQueue.pop(e);if(!r.length){a();break}const n=this._processBatch(r,a).catch(console.error);t.push(n)}return Promise.all(t)}async _processBatch(e,t){if(e.length)try{const t={runCreates:e.filter((e=>"create"===e.action)).map((e=>e.item)),runUpdates:e.filter((e=>"update"===e.action)).map((e=>e.item))},r=await this._ensureServerInfo();r?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(t):await this.batchIngestRuns(t)}finally{t()}else t()}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,"create"===e.action&&(e.item=P(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout((()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)}),this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await(0,s.Y)()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(2500),...this.fetchOptions});return await v(e,"get server info"),e.json()}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then((e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e)))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const a=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order)return void this.processRunOperation({action:"create",item:a}).catch(console.error);const n=P(a),i=await this.caller.call((0,s.Y)(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:T(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let r=e?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[],a=t?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[];if(r.length>0&&a.length>0){const e=r.reduce(((e,t)=>t.id?(e[t.id]=t,e):e),{}),t=[];for(const r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);r=Object.values(e),a=t}const n={post:this._filterForSampling(r),patch:this._filterForSampling(a,!0)};if(!n.post.length&&!n.patch.length)return;const i={post:[],patch:[]};for(const e of["post","patch"]){const t=e,r=n[t].reverse();let a=r.pop();for(;void 0!==a;)i[t].push(a),a=r.pop()}(i.post.length>0||i.patch.length>0)&&await this._postBatchIngestRuns(T(i))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call((0,s.Y)(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;const r={};let a=[];for(const t of e??[]){const e=this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(r[e.id]=e.attachments),delete e.attachments,a.push(e)}let n=[];for(const e of t??[])n.push(this.prepareRunCreateOrUpdateInputs(e));if(void 0!==a.find((e=>void 0===e.trace_id||void 0===e.dotted_order)))throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==n.find((e=>void 0===e.trace_id||void 0===e.dotted_order)))throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&n.length>0){const e=a.reduce(((e,t)=>t.id?(e[t.id]=t,e):e),{}),t=[];for(const r of n)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);a=Object.values(e),n=t}if(0===a.length&&0===n.length)return;const i=[],s=[];for(const[e,t]of[["post",a],["patch",n]])for(const a of t){const{inputs:t,outputs:n,events:o,attachments:l,...c}=a,u={inputs:t,outputs:n,events:o},d=T(c);s.push({name:`${e}.${c.id}`,payload:new Blob([d],{type:`application/json; length=${d.length}`})});for(const[t,r]of Object.entries(u)){if(void 0===r)continue;const a=T(r);s.push({name:`${e}.${c.id}.${t}`,payload:new Blob([a],{type:`application/json; length=${a.length}`})})}if(void 0!==c.id){const e=r[c.id];if(e){delete r[c.id];for(const[t,r]of Object.entries(e)){let e,a;Array.isArray(r)?[e,a]=r:(e=r.mimeType,a=r.data),t.includes(".")?console.warn(`Skipping attachment '${t}' for run ${c.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`):s.push({name:`attachment.${c.id}.${t}`,payload:new Blob([a],{type:`${e}; length=${a.byteLength}`})})}}}i.push(`trace=${c.trace_id},id=${c.id}`)}await this._sendMultipartRequest(s,i.join("; "))}async _sendMultipartRequest(e,t){try{const t="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),r=[];for(const a of e)r.push(new Blob([`--${t}\r\n`])),r.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r\n`,`Content-Type: ${a.payload.type}\r\n\r\n`])),r.push(a.payload),r.push(new Blob(["\r\n"]));r.push(new Blob([`--${t}--\r\n`]));const a=new Blob(r),n=await a.arrayBuffer(),i=await this.batchIngestCaller.call((0,s.Y)(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${t}`},body:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(i,"ingest multipart runs",!0)}catch(e){console.warn(`${e.message.trim()}\n\nContext: ${t}`)}}async updateRun(e,t){f(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order)return void 0!==t.end_time&&void 0===r.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?void await this.processRunOperation({action:"update",item:r}).catch(console.error):void this.processRunOperation({action:"update",item:r}).catch(console.error);const a={...this.headers,"Content-Type":"application/json"},n=await this.caller.call((0,s.Y)(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:T(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(n,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){f(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:(0,h.Jz)("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(this.listRuns({id:e.child_run_ids})),r={},a={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),a[e.id]=e}e.child_runs=r[e.id]||[];for(const t in r)t!==e.id&&(a[t].child_runs=r[t]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:a,traceId:n,referenceExampleId:i,startTime:s,executionOrder:o,isRoot:l,runType:c,error:u,id:d,query:h,filter:p,traceFilter:m,treeFilter:f,limit:g,select:y}=e;let b=[];if(t&&(b=Array.isArray(t)?t:[t]),r){const e=Array.isArray(r)?r:[r],t=await Promise.all(e.map((e=>this.readProject({projectName:e}).then((e=>e.id)))));b.push(...t)}const v={session:b.length?b:null,run_type:c,reference_example:i,query:h,filter:p,trace_filter:m,tree_filter:f,execution_order:o,parent_run:a,start_time:s?s.toISOString():null,error:u,id:d,limit:g,trace:n,select:y||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l};let _=0;for await(const e of this._getCursorPaginatedList("/runs/query",v))if(g){if(_>=g)break;if(e.length+_>g){const t=e.slice(0,g-_);yield*t;break}_+=e.length,yield*e}else yield*e}async getRunStats({id:e,trace:t,parentRun:r,runType:a,projectNames:n,projectIds:i,referenceExampleIds:o,startTime:l,endTime:c,error:u,query:d,filter:h,traceFilter:p,treeFilter:m,isRoot:f,dataSourceType:g}){let y=i||[];n&&(y=[...i||[],...await Promise.all(n.map((e=>this.readProject({projectName:e}).then((e=>e.id)))))]);const b={id:e,trace:t,parent_run:r,run_type:a,session:y,reference_example:o,start_time:l,end_time:c,error:u,query:d,filter:h,trace_filter:p,tree_filter:m,is_root:f,data_source_type:g},v=Object.fromEntries(Object.entries(b).filter((([e,t])=>void 0!==t))),_=await this.caller.call((0,s.Y)(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(v),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _.json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||a.A()};f(e);const n=await this.caller.call((0,s.Y)(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await n.json();if(null===i||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){f(e);const t=await this.caller.call((0,s.Y)(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(t,"unshare run",!0)}async readRunSharedLink(e){f(e);const t=await this.caller.call((0,s.Y)(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)r.append("id",e);f(e);const a=await this.caller.call((0,s.Y)(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await a.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),f(e);const r=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};f(e);const a=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await a.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async unshareDataset(e){f(e);const t=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(t,"unshare dataset",!0)}async readSharedDataset(e){f(e);const t=await this.caller.call((0,s.Y)(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async listSharedExamples(e,t){const r={};t?.exampleIds&&(r.id=t.exampleIds);const a=new URLSearchParams;Object.entries(r).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>a.append(e,t))):a.append(e,t)}));const n=await this.caller.call((0,s.Y)(),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await n.json();if(!n.ok){if("detail"in i)throw new Error(`Failed to list shared examples.\nStatus: ${n.status}\nMessage: ${i.detail.join("\n")}`);throw new Error(`Failed to list shared examples: ${n.status} ${n.statusText}`)}return i.map((e=>({...e,_hostUrl:this.getHostUrl()})))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:n=null,referenceDatasetId:i=null}){const o=a?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,c=n||{};r&&(c.metadata=r);const u={name:e,extra:c,description:t};null!==i&&(u.reference_dataset_id=i);const d=await this.caller.call((0,s.Y)(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:n=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=n;a&&(l={...l||{},metadata:a});const c={name:t,extra:l,description:r,end_time:i?new Date(i).toISOString():null},u=await this.caller.call((0,s.Y)(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(u,"update project"),await u.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)f(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");a.append("name",t)}const n=await this.caller.call((0,s.Y)(),`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const e=await n.json();return!!n.ok&&(!Array.isArray(e)||e.length>0)}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a="/sessions";const n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)f(e),a+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");n.append("name",t)}void 0!==r&&n.append("include_stats",r.toString());const i=await this._get(a,n);let s;if(Array.isArray(i)){if(0===i.length)throw new Error(`Project[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:n,referenceFree:i,metadata:s}={}){const o=new URLSearchParams;if(void 0!==e)for(const t of e)o.append("id",t);if(void 0!==t&&o.append("name",t),void 0!==r&&o.append("name_contains",r),void 0!==a)o.append("reference_dataset",a);else if(void 0!==n){const e=await this.readDataset({datasetName:n});o.append("reference_dataset",e.id)}void 0!==i&&o.append("reference_free",i.toString()),void 0!==s&&o.append("metadata",JSON.stringify(s));for await(const e of this._getPaginated("/sessions",o))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");r=void 0===e?(await this.readProject({projectName:t})).id:e,f(r);const a=await this.caller.call((0,s.Y)(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(a,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:n,dataType:i,name:o}){const l=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),r.forEach((e=>{c.append("input_keys",e)})),a.forEach((e=>{c.append("output_keys",e)})),n&&c.append("description",n),i&&c.append("data_type",i),o&&c.append("name",o);const u=await this.caller.call((0,s.Y)(),l,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(u,"upload CSV"),await u.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:a,outputsSchema:n,metadata:i}={}){const o={name:e,description:t,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),a&&(o.inputs_schema_definition=a),n&&(o.outputs_schema_definition=n);const l=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const a=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)f(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");a.append("name",t)}const n=await this._get(r,a);let i;if(Array.isArray(n)){if(0===n.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=n[0]}else i=n;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:a}){let n=e;if(void 0===n&&void 0===t)throw new Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:t})).id);const i=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof a?a:a.toISOString()});return await this._get(`/datasets/${n}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:n,metadata:i}={}){const s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(const e of r)s.append("id",e);void 0!==a&&s.append("name",a),void 0!==n&&s.append("name_contains",n),void 0!==i&&s.append("metadata",JSON.stringify(i));for await(const e of this._getPaginated("/datasets",s))yield*e}async updateDataset(e){const{datasetId:t,datasetName:r,...a}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const n=t??(await this.readDataset({datasetName:r})).id;f(n);const i=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/${n}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(i,"update dataset"),await i.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:r,asOf:a,tag:n}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:r})).id;f(i);const o=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:"string"==typeof a?a:a.toISOString(),tag:n}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(a=(await this.readDataset({datasetName:t})).id),void 0===a)throw new Error("Must provide datasetName or datasetId");f(a),r+=`/${a}`;const n=await this.caller.call((0,s.Y)(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(n,`delete ${r}`),await n.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let a=e;if(!a&&!t)throw new Error("Must provide either datasetName or datasetId");if(a&&t)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:t})).id),f(a);const n={tag:r},i=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(i,"index dataset"),await i.json()}async similarExamples(e,t,r,{filter:a}={}){const n={limit:r,inputs:e};void 0!==a&&(n.filter=a),f(t);const i=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:n,exampleId:i,metadata:o,split:l,sourceRunId:c}){let u=r;if(void 0===u&&void 0===a)throw new Error("Must provide either datasetName or datasetId");if(void 0!==u&&void 0!==a)throw new Error("Must provide either datasetName or datasetId, not both");void 0===u&&(u=(await this.readDataset({datasetName:a})).id);const d=n||new Date,h={dataset_id:u,inputs:e,outputs:t,created_at:d?.toISOString(),id:i,metadata:o,split:l,source_run_id:c},p=await this.caller.call((0,s.Y)(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(p,"create example"),await p.json()}async createExamples(e){const{inputs:t,outputs:r,metadata:a,sourceRunIds:n,exampleIds:i,datasetId:o,datasetName:l}=e;let c=o;if(void 0===c&&void 0===l)throw new Error("Must provide either datasetName or datasetId");if(void 0!==c&&void 0!==l)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===c){const e=await this.readDataset({datasetName:l});c=e.id}const u=t.map(((t,s)=>({dataset_id:c,inputs:t,outputs:r?r[s]:void 0,metadata:a?a[s]:void 0,split:e.splits?e.splits[s]:void 0,id:i?i[s]:void 0,source_run_id:n?n[s]:void 0}))),d=await this.caller.call((0,s.Y)(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(d,"create examples"),await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const a=e.map((e=>u(e)?d(e):e)),n=u(t)?d(t):t;return this.createExample({input:a},{output:n},r)}async readExample(e){f(e);const t=`/examples/${e}`,r=await this._get(t),{attachment_urls:a,...n}=r,i=n;return a&&(i.attachments=Object.entries(a).reduce(((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type},e)),{})),i}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:a,splits:n,inlineS3Urls:i,metadata:s,limit:o,offset:l,filter:c,includeAttachments:u}={}){let d;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)d=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");d=(await this.readDataset({datasetName:t})).id}const h=new URLSearchParams({dataset:d}),p=a?"string"==typeof a?a:a?.toISOString():void 0;p&&h.append("as_of",p);const m=i??!0;if(h.append("inline_s3_urls",m.toString()),void 0!==r)for(const e of r)h.append("id",e);if(void 0!==n)for(const e of n)h.append("splits",e);if(void 0!==s){const e=JSON.stringify(s);h.append("metadata",e)}void 0!==o&&h.append("limit",o.toString()),void 0!==l&&h.append("offset",l.toString()),void 0!==c&&h.append("filter",c),!0===u&&["attachment_urls","outputs","metadata"].forEach((e=>h.append("select",e)));let f=0;for await(const e of this._getPaginated("/examples",h)){for(const t of e){const{attachment_urls:e,...r}=t,a=r;e&&(a.attachments=Object.entries(e).reduce(((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type||void 0},e)),{})),yield a,f++}if(void 0!==o&&f>=o)break}}async deleteExample(e){f(e);const t=`/examples/${e}`,r=await this.caller.call((0,s.Y)(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(r,`delete ${t}`),await r.json()}async updateExample(e,t){f(e);const r=await this.caller.call((0,s.Y)(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(r,"update example"),await r.json()}async updateExamples(e){const t=await this.caller.call((0,s.Y)(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(t,"update examples"),await t.json()}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:a}){let n;if(n=e||(await this.readDataset({datasetName:t})).id,f(n),r&&a||!r&&!a)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;void 0!==r&&i.append("as_of","string"==typeof r?r:r.toISOString()),void 0!==a&&i.append("tag",a);const o=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/${n}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let a;if(void 0===e&&void 0===t)throw new Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");a=void 0===e?(await this.readDataset({datasetName:t})).id:e,f(a);const n=new URLSearchParams,i=r?"string"==typeof r?r:r?.toISOString():void 0;return i&&n.append("as_of",i),await this._get(`/datasets/${a}/splits`,n)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:a,remove:n=!1}){let i;if(void 0===e&&void 0===t)throw new Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");i=void 0===e?(await this.readDataset({datasetName:t})).id:e,f(i);const o={split_name:r,examples:a.map((e=>(f(e),e))),remove:n},l=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:n}={loadChildRuns:!1}){let i;if((0,g.m)("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)i=await this.readRun(e,{loadChildRuns:a});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);i=e}null!==i.reference_example_id&&void 0!==i.reference_example_id&&(n=await this.readExample(i.reference_example_id));const s=await t.evaluateRun(i,n),[o,l]=await this._logEvaluationFeedback(s,i,r);return l[0]}async createFeedback(e,t,{score:r,value:n,correction:i,comment:o,sourceInfo:l,feedbackSourceType:c="api",sourceRunId:u,feedbackId:d,feedbackConfig:h,projectId:p,comparativeExperimentId:m}){if(!e&&!p)throw new Error("One of runId or projectId must be provided");if(e&&p)throw new Error("Only one of runId or projectId can be provided");const g={type:c??"api",metadata:l??{}};void 0===u||void 0===g?.metadata||g.metadata.__run||(g.metadata.__run={run_id:u}),void 0!==g?.metadata&&void 0!==g.metadata.__run?.run_id&&f(g.metadata.__run.run_id);const y={id:d??a.A(),run_id:e,key:t,score:r,value:n,correction:i,comment:o,feedback_source:g,comparative_experiment_id:m,feedbackConfig:h,session_id:p},b=`${this.apiUrl}/feedback`,_=await this.caller.call((0,s.Y)(),b,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(_,"create feedback",!0),y}async updateFeedback(e,{score:t,value:r,correction:a,comment:n}){const i={};null!=t&&(i.score=t),null!=r&&(i.value=r),null!=a&&(i.correction=a),null!=n&&(i.comment=n),f(e);const o=await this.caller.call((0,s.Y)(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(o,"update feedback",!0)}async readFeedback(e){f(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){f(e);const t=`/feedback/${e}`,r=await this.caller.call((0,s.Y)(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(const e of t)a.append("key",e);if(r)for(const e of r)a.append("source",e);for await(const e of this._getPaginated("/feedback",a))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:a}={}){const n={run_id:e,feedback_key:t,feedback_config:a};r?"string"==typeof r?n.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(n.expires_in=r):n.expires_in={hours:3};const i=await this.caller.call((0,s.Y)(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await i.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:a,description:n,metadata:i,id:o}){if(0===t.length)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!r)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:n,created_at:(a??new Date)?.toISOString(),extra:{}};i&&(l.extra.metadata=i);const c=await this.caller.call((0,s.Y)(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await c.json()}async*listPresignedFeedbackTokens(e){f(e);const t=new URLSearchParams({run_id:e});for await(const e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){let t;return t="results"in e?e.results:Array.isArray(e)?e:[e],t}async _logEvaluationFeedback(e,t,r){const a=this._selectEvalResults(e),n=[];for(const e of a){let a=r||{};e.evaluatorInfo&&(a={...e.evaluatorInfo,...a});let i=null;e.targetRunId?i=e.targetRunId:t&&(i=t.id),n.push(await this.createFeedback(i,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:a,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[a,n]}async logEvaluationFeedback(e,t,r){const[a]=await this._logEvaluationFeedback(e,t,r);return a}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:a,limit:n}=e,i=new URLSearchParams;t&&t.forEach(((e,t)=>{f(e,`queueIds[${t}]`),i.append("ids",e)})),r&&i.append("name",r),a&&i.append("name_contains",a),i.append("limit",(void 0!==n?Math.min(n,100):100).toString());let s=0;for await(const e of this._getPaginated("/annotation-queues",i))if(yield*e,s++,void 0!==n&&s>=n)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:n}=e,i={name:t,description:r,id:n||a.A()},o=await this.caller.call((0,s.Y)(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter((([e,t])=>void 0!==t)))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(o,"create annotation queue"),await o.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:r,description:a}=t,n=await this.caller.call((0,s.Y)(),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(n,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call((0,s.Y)(),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call((0,s.Y)(),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map(((e,t)=>f(e,`runIds[${t}]`).toString()))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${f(e,"queueId")}/run`,a=await this.caller.call((0,s.Y)(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(a,"get run from annotation queue"),await a.json()}async deleteRunFromAnnotationQueue(e,t){const r=await this.caller.call((0,s.Y)(),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}/runs/${f(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call((0,s.Y)(),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.\n\n      Current tenant: ${r.tenant_handle}\n\n      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call((0,s.Y)(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const e="string"==typeof r.detail?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${t.status}: ${t.statusText}\n${e}`);throw a.statusCode=t.status,a}if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,a,n]=y(e),i=await this.caller.call((0,s.Y)(),`${this.apiUrl}/likes/${r}/${a}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(i,(t?"like":"unlike")+" prompt"),await i.json()}async _getPromptUrl(e){const[t,r,a]=y(e);if(await this._currentTenantIsOwner(t)){const e=await this._getSettings();return"latest"!==a?`${this.getHostUrl()}/prompts/${r}/${a.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${e.id}`}return"latest"!==a?`${this.getHostUrl()}/hub/${t}/${r}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,(e=>e.commits)))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),void 0!==e?.isPublic&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(const e of this._getPaginated("/repos",t,(e=>e.repos)))yield*e}async getPrompt(e){const[t,r,a]=y(e),n=await this.caller.call((0,s.Y)(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(404===n.status)return null;await v(n,"get prompt");const i=await n.json();return i.repo?i.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw new Error("Cannot create a public prompt without first\n\n        creating a LangChain Hub handle. \n        You can add a handle by creating a public prompt at:\n\n        https://smith.langchain.com/prompts");const[a,n,i]=y(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);const o={repo_handle:n,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},l=await this.caller.call((0,s.Y)(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(l,"create prompt");const{repo:c}=await l.json();return c}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[a,n,i]=y(e),o="latest"!==r?.parentCommitHash&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${a}/${n}`),l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=await this.caller.call((0,s.Y)(),`${this.apiUrl}/commits/${a}/${n}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(c,"create commit");const u=await c.json();return this._getPromptUrl(`${a}/${n}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const e of t){const t=e.id,a=T({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}}),n=new Blob([a],{type:"application/json"});if(r.append(t,n),e.inputs){const a=T(e.inputs),n=new Blob([a],{type:"application/json"});r.append(`${t}.inputs`,n)}if(e.outputs){const a=T(e.outputs),n=new Blob([a],{type:"application/json"});r.append(`${t}.outputs`,n)}if(e.attachments)for(const[a,n]of Object.entries(e.attachments)){let e,i;Array.isArray(n)?[e,i]=n:(e=n.mimeType,i=n.data);const s=new Blob([i],{type:`${e}; length=${i.byteLength}`});r.append(`${t}.attachment.${a}`,s)}if(e.attachments_operations){const a=T(e.attachments_operations),n=new Blob([a],{type:"application/json"});r.append(`${t}.attachments_operations`,n)}}const a=await this.caller.call((0,s.Y)(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"PATCH",headers:this.headers,body:r});return await a.json()}async uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const e of t){const t=(e.id??a.A()).toString(),n=T({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}}),i=new Blob([n],{type:"application/json"});r.append(t,i);const s=T(e.inputs),o=new Blob([s],{type:"application/json"});if(r.append(`${t}.inputs`,o),e.outputs){const a=T(e.outputs),n=new Blob([a],{type:"application/json"});r.append(`${t}.outputs`,n)}if(e.attachments)for(const[a,n]of Object.entries(e.attachments)){let e,i;Array.isArray(n)?[e,i]=n:(e=n.mimeType,i=n.data);const s=new Blob([i],{type:`${e}; length=${i.byteLength}`});r.append(`${t}.attachment.${a}`,s)}}const n=await this.caller.call((0,s.Y)(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r});return await n.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,a]=y(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const n={};if(void 0!==t?.description&&(n.description=t.description),void 0!==t?.readme&&(n.readme=t.readme),void 0!==t?.tags&&(n.tags=t.tags),void 0!==t?.isPublic&&(n.is_public=t.isPublic),void 0!==t?.isArchived&&(n.is_archived=t.isArchived),0===Object.keys(n).length)throw new Error("No valid update options provided");const i=await this.caller.call((0,s.Y)(),`${this.apiUrl}/repos/${r}/${a}`,{method:"PATCH",body:JSON.stringify(n),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await v(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,a]=y(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);const n=await this.caller.call((0,s.Y)(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await n.json()}async pullPromptCommit(e,t){const[r,a,n]=y(e),i=await this.caller.call((0,s.Y)(),`${this.apiUrl}/commits/${r}/${a}/${n}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await v(i,"pull prompt commit");const o=await i.json();return{owner:r,repo:a,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some((e=>"object"!==e))&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:a}=t,[n,i]=this.parseTokenOrUrl(e,r),s=new $({apiUrl:n,apiKey:"placeholder"}),o=await s.readSharedDataset(i),l=a||o.name;try{if(await this.hasDataset({datasetId:l}))return void console.log(`Dataset ${l} already exists in your tenant. Skipping.`)}catch(e){}const c=await s.listSharedExamples(i),u=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map((e=>e.inputs)),outputs:c.flatMap((e=>e.outputs?[e.outputs]:[])),datasetId:u.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,r=2,a="dataset"){try{return f(e),[t,e]}catch(e){}try{const n=new URL(e).pathname.split("/").filter((e=>""!==e));if(n.length>=r)return[t,n[n.length-r]];throw new Error(`Invalid public ${a} URL: ${e}`)}catch(t){throw new Error(`Invalid public ${a} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map((({itemPromise:e})=>e)),this.batchIngestCaller.queue.onIdle()])}}},2771:(e,t,r)=>{"use strict";r.d(t,{FewShotPromptTemplate:()=>o});var a=r(329),n=r(9849),i=r(3650),s=r(3766);class o extends a.L{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,n.Ns)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new o(a)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=await Promise.all(r.map((e=>this.examplePrompt.format(e)))),i=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return(0,n.Xm)(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await i.PromptTemplate.deserialize(t);let a;if(!Array.isArray(e.examples))throw new Error("Invalid examples format. Only list or string are supported.");return a=e.examples,new o({inputVariables:e.input_variables,examplePrompt:r,examples:a,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}s.qF},3042:(e,t,r)=>{const a=r(4621);e.exports=(e,t)=>a(e,t,!0)},3230:(e,t,r)=>{"use strict";r.d(t,{YN:()=>H,B2:()=>ee,fJ:()=>V,jY:()=>K,ck:()=>J,zZ:()=>Y,GH:()=>B,Bp:()=>Q});var a=r(4476),n=r(4116),i=r(3829),s=r(3389),o=r(6150),l=r(1590),c=r(58),u=r(7765);class d{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=(0,o.X6)({},t);return new h({ops:t,state:r[r.length-1].newDocument})}}class h extends d{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=(0,o.X6)(this.state,e.ops);return new h({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=(0,o.X6)({},e.ops);return new h({ops:e.ops,state:t[t.length-1].newDocument})}}const p=e=>"log_stream_tracer"===e.name;async function m(e,t){if("original"===t)throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||""!==r?.input?r.input:void 0}async function f(e,t){const{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&void 0!==r?.output?r.output:r}class g extends l.J{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=c.bO.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every((e=>!this.excludeTags?.includes(e)))),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new d({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new d({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await m(e,this._schemaFormat)),await this.writer.write(new d({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await m(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await f(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const a=new d({ops:r});await this.writer.write(a)}finally{if(e.id===this.rootId){const t=new d({ops:[{op:"replace",path:"/final_output",value:await f(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const a=this.keyMapByRunId[e.id];if(void 0===a)return;let n;var i;void 0!==e.inputs.messages?(i=r?.chunk,n=void 0!==i&&void 0!==i.message?r?.chunk:new u.H({id:`run-${e.id}`,content:t})):n=t;const s=new d({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${a}/streamed_output/-`,value:n}]});await this.writer.write(s)}}var y=r(8028);function b({name:e,serialized:t}){return void 0!==e?e:void 0!==t?.name?t.name:void 0!==t?.id&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}const v=e=>"event_stream_tracer"===e.name;class _ extends l.J{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=c.bO.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(r=r||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(r=r&&t.every((e=>!this.excludeTags?.includes(e)))),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const a=this.runInfoMap.get(e);if(void 0===a)return void(yield r.value);function n(e,t){return"llm"===e&&"string"==typeof t?new y.mu({text:t}):t}let i=this.tappedPromises.get(e);if(void 0===i){let s;i=new Promise((e=>{s=e})),this.tappedPromises.set(e,i);try{const i={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...i,data:{chunk:n(a.runType,r.value)}},a),yield r.value;for await(const e of t)"tool"!==a.runType&&"retriever"!==a.runType&&await this.send({...i,data:{chunk:n(a.runType,e)}},a),yield e}finally{s()}}else{yield r.value;for await(const e of t)yield e}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);void 0!==r?r.then((()=>{this.send(e,t)})):await this.send(e,t)}async onLLMStart(e){const t=b(e),r=void 0!==e.inputs.messages?"chat_model":"llm",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,a);const n=`on_${r}_start`;await this.send({event:n,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)}async onLLMNewToken(e,t,r){const a=this.runInfoMap.get(e.id);let n,i;if(void 0===a)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===a.runType)i="on_chat_model_stream",n=void 0===r?.chunk?new u.H({content:t,id:`run-${e.id}`}):r.chunk.message;else{if("llm"!==a.runType)throw new Error(`Unexpected run type ${a.runType}`);i="on_llm_stream",n=void 0===r?.chunk?new y.mu({text:t}):r.chunk}await this.send({event:i,data:{chunk:n},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){const t=this.runInfoMap.get(e.id);let r;if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const a=e.outputs?.generations;let n;if("chat_model"===t.runType){for(const e of a??[]){if(void 0!==n)break;n=e[0]?.message}r="on_chat_model_end"}else{if("llm"!==t.runType)throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);n={generations:a?.map((e=>e.map((e=>({text:e.text,generationInfo:e.generationInfo}))))),llmOutput:e.outputs?.llmOutput??{}},r="on_llm_end"}await this.sendEndEvent({event:r,data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){const t=b(e),r=e.run_type??"chain",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type};let n={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(n={},a.inputs={}):void 0!==e.inputs.input?(n.input=e.inputs.input,a.inputs=e.inputs.input):(n.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${r}_start`,data:n,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)}async onChainEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,a=e.inputs??t.inputs??{},n={output:e.outputs?.output??e.outputs,input:a};a.input&&1===Object.keys(a).length&&(n.input=a.input,t.inputs=a.input),await this.sendEndEvent({event:r,data:n,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){const t=b(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=void 0===e.outputs?.output?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){const t=b(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const a=this.runInfoMap.get(r);if(void 0===a)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:a.tags,metadata:a.metadata,data:t},a)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally((()=>{this.writer.close()}))}}var w=r(8999),E=r(9830),O=r(765),x=r(9624);class k extends l.J{constructor({config:e,onStart:t,onEnd:r,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function T(e){return!!e&&e.lc_runnable}class I{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags;const a=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||a.some((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&a.every((e=>!this.excludeTags?.includes(e)))),r}}var S=r(4350),P=r(2366),A=r(8227);function j(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}const C=["*","_","`"];function $(e,t){if(void 0!==e&&!(0,A.A)(e))return e;if(!T(t))return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e}catch(e){return t.getName()}}function N(e){return T(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...(0,P.Ik)(e.data.schema),title:e.data.name}}}class R{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach(((t,r)=>{e[t.id]=(0,A.A)(t.id)?r:t.id})),{nodes:Object.values(this.nodes).map((t=>({id:e[t.id],...N(t)}))),edges:this.edges.map((t=>{const r={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(r.data=t.data),void 0!==t.conditional&&(r.conditional=t.conditional),r}))}}addNode(e,t,r){if(void 0!==t&&void 0!==this.nodes[t])throw new Error(`Node with id ${t} already exists`);const a=t??(0,i.A)(),n={id:a,data:e,name:$(t,e),metadata:r};return this.nodes[a]=n,n}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter((t=>t.source!==e.id&&t.target!==e.id))}addEdge(e,t,r,a){if(void 0===this.nodes[e.id])throw new Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw new Error(`Target node ${t.id} not in graph`);const n={source:e.id,target:t.id,data:r,conditional:a};return this.edges.push(n),n}firstNode(){return L(this)}lastNode(){return M(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map((e=>e.id)).every(A.A)&&(r="");const a=e=>r?`${r}:${e}`:e;Object.entries(e.nodes).forEach((([e,t])=>{this.nodes[a(e)]={...t,id:a(e)}}));const n=e.edges.map((e=>({...e,source:a(e.source),target:a(e.target)})));this.edges=[...this.edges,...n];const i=e.firstNode(),s=e.lastNode();return[i?{id:a(i.id),data:i.data}:void 0,s?{id:a(s.id),data:s.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&L(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&M(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map((e=>[e.id,e.name]))),t=new Map;Object.values(e).forEach((e=>{t.set(e,(t.get(e)||0)+1)}));const r=r=>{const a=e[r];return(0,A.A)(r)&&1===t.get(a)?a:r};return new R({nodes:Object.fromEntries(Object.entries(this.nodes).map((([e,t])=>[r(e),{...t,id:r(e)}]))),edges:this.edges.map((e=>({...e,source:r(e.source),target:r(e.target)})))})}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:n}=e??{},i=this.reid(),s=i.firstNode(),o=i.lastNode();return function(e,t,r){const{firstNode:a,lastNode:n,nodeColors:i,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=r??{};let c=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%\ngraph TD;\n`:"graph TD;\n";if(s){const t="default",r={[t]:"{0}({1})"};void 0!==a&&(r[a]="{0}([{1}]):::first"),void 0!==n&&(r[n]="{0}([{1}]):::last");for(const[a,n]of Object.entries(e)){const e=n.name.split(":").pop()??"";let i=C.some((t=>e.startsWith(t)&&e.endsWith(t)))?`<p>${e}</p>`:e;Object.keys(n.metadata??{}).length&&(i+=`<hr/><small><em>${Object.entries(n.metadata??{}).map((([e,t])=>`${e} = ${t}`)).join("\n")}</em></small>`);const s=(r[a]??r[t]).replace("{0}",j(a)).replace("{1}",i);c+=`\t${s}\n`}}const u={};for(const e of t){const t=e.source.split(":"),r=e.target.split(":"),a=t.filter(((e,t)=>e===r[t])).join(":");u[a]||(u[a]=[]),u[a].push(e)}const d=new Set;function h(e,t){const r=1===e.length&&e[0].source===e[0].target;if(t&&!r){const e=t.split(":").pop();if(d.has(e))throw new Error(`Found duplicate subgraph '${e}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(e),c+=`\tsubgraph ${e}\n`}for(const t of e){const{source:e,target:r,data:a,conditional:n}=t;let i="";if(void 0!==a){let e=a;const t=e.split(" ");t.length>l&&(e=Array.from({length:Math.ceil(t.length/l)},((e,r)=>t.slice(r*l,(r+1)*l).join(" "))).join("&nbsp;<br>&nbsp;")),i=n?` -. &nbsp;${e}&nbsp; .-> `:` -- &nbsp;${e}&nbsp; --\x3e `}else i=n?" -.-> ":" --\x3e ";c+=`\t${j(e)}${i}${j(r)};\n`}for(const e in u)e.startsWith(`${t}:`)&&e!==t&&h(u[e],e);t&&!r&&(c+="\tend\n")}h(u[""]??[],"");for(const e in u)e.includes(":")||""===e||h(u[e],e);return s&&(c+=function(e){let t="";for(const[r,a]of Object.entries(e))t+=`\tclassDef ${r} ${a};\n`;return t}(i??{})),c}(i.nodes,i.edges,{firstNode:s?.id,lastNode:o?.id,withStyles:t,curveStyle:r,nodeColors:a,wrapLabelNWords:n})}async drawMermaidPng(e){return async function(e,t){let{backgroundColor:r="white"}=t??{};const a=btoa(e);void 0!==r&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));const n=`https://mermaid.ink/img/${a}?bgColor=${r}`,i=await fetch(n);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join("\n"));return await i.blob()}(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}}function L(e,t=[]){const r=new Set(e.edges.filter((e=>!t.includes(e.source))).map((e=>e.target))),a=[];for(const n of Object.values(e.nodes))t.includes(n.id)||r.has(n.id)||a.push(n);return 1===a.length?a[0]:void 0}function M(e,t=[]){const r=new Set(e.edges.filter((e=>!t.includes(e.target))).map((e=>e.source))),a=[];for(const n of Object.values(e.nodes))t.includes(n.id)||r.has(n.id)||a.push(n);return 1===a.length?a[0]:void 0}function U(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function F(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*D(e,t){for(;;){const{value:r,done:a}=S.Nx.runWithConfig((0,O.DY)(e),t.next.bind(t),!0);if(a)break;yield r}}async function*Z(e,t){const r=t[Symbol.asyncIterator]();for(;;){const{value:a,done:n}=await S.Nx.runWithConfig((0,O.DY)(e),r.next.bind(t),!0);if(n)break;yield a}}var z=r(199);function B(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class H extends w.y{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new V({bound:this,kwargs:e,config:{}})}map(){return new G({bound:this})}withRetry(e){return new q({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new V({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new X({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(O.ZI);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter((([e])=>"runId"!==e)));return Array.from({length:t},((t,a)=>(0,O.ZI)(0===a?e:r)))}return Array.from({length:t},(()=>(0,O.ZI)(e)))}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),n=a[0]?.maxConcurrency??r?.maxConcurrency,i=new x.g({maxConcurrency:n,onFailedAttempt:e=>{throw e}}),s=e.map(((e,t)=>i.call((async()=>{try{return await this.invoke(e,a[t])}catch(e){if(r?.returnExceptions)return e;throw e}}))));return Promise.all(s)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=(0,O.ZI)(t),a=new c.Tr({generator:this._streamIterator(e,r),config:r});return await a.setup,c.bO.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?(0,O.ZI)(e):(0,O.ZI)({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const a=(0,O.ZI)(r),n=await(0,O.kJ)(a),i=await(n?.handleChainStart(this.toJSON(),B(t,"input"),a.runId,a?.runType,void 0,void 0,a?.runName??this.getName()));let s;delete a.runId;try{const n=e.call(this,t,a,i);s=await(0,E.o)(n,r?.signal)}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(B(s,"output"))),s}async _batchWithConfig(e,t,r,a){const n=this._getOptionsList(r??{},t.length),i=await Promise.all(n.map(O.kJ)),s=await Promise.all(i.map((async(e,r)=>{const a=await(e?.handleChainStart(this.toJSON(),B(t[r],"input"),n[r].runId,n[r].runType,void 0,void 0,n[r].runName??this.getName()));return delete n[r].runId,a})));let o;try{const r=e.call(this,t,n,s,a);o=await(0,E.o)(r,n?.[0]?.signal)}catch(e){throw await Promise.all(s.map((t=>t?.handleChainError(e)))),e}return await Promise.all(s.map((e=>e?.handleChainEnd(B(o,"output"))))),o}async*_transformStreamWithConfig(e,t,r){let a,n,i=!0,s=!0;const o=(0,O.ZI)(r),l=await(0,O.kJ)(o);let u;try{const d=await(0,c.DS)(t.bind(this),async function*(){for await(const t of e){if(i)if(void 0===a)a=t;else try{a=(0,c.xW)(a,t)}catch{a=void 0,i=!1}yield t}}(),(async()=>l?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName())),r?.signal,o);delete o.runId,u=d.setup;const h=u?.handlers.find(v);let m=d.output;void 0!==h&&void 0!==u&&(m=h.tapOutputIterable(u.runId,m));const f=u?.handlers.find(p);void 0!==f&&void 0!==u&&(m=f.tapOutputIterable(u.runId,m));for await(const e of m)if(yield e,s)if(void 0===n)n=e;else try{n=(0,c.xW)(n,e)}catch{n=void 0,s=!1}}catch(e){throw await(u?.handleChainError(e,void 0,void 0,void 0,{inputs:B(a,"input")})),e}await(u?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:B(a,"input")}))}getGraph(e){const t=new R,r=t.addNode({name:`${this.getName()}Input`,schema:a.z.any()}),n=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:a.z.any()});return t.addEdge(r,n),t.addEdge(n,i),t}pipe(e){return new Y({first:this,last:Q(e)})}pick(e){return this.pipe(new te(e))}assign(e){return this.pipe(new ee(new J({steps:e})))}async*transform(e,t){let r;for await(const t of e)r=void 0===r?t:(0,c.xW)(r,t);yield*this._streamIterator(r,(0,O.ZI)(t))}async*streamLog(e,t,r){const a=new g({...r,autoClose:!1,_schemaFormat:"original"}),n=(0,O.ZI)(t);yield*this._streamLog(e,a,n)}async*_streamLog(e,t,r){const{callbacks:a}=r;if(void 0===a)r.callbacks=[t];else if(Array.isArray(a))r.callbacks=a.concat([t]);else{const e=a.copy();e.addHandler(t,!0),r.callbacks=e}const n=this.stream(e,r),i=async function(){try{const e=await n;for await(const r of e){const e=new d({ops:[{op:"add",path:"/streamed_output/-",value:r}]});await t.writer.write(e)}}finally{await t.writer.close()}}();try{for await(const e of t)yield e}finally{await i}}streamEvents(e,t,r){let a;if("v1"===t.version)a=this._streamEventsV1(e,t,r);else{if("v2"!==t.version)throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');a=this._streamEventsV2(e,t,r)}return"text/event-stream"===t.encoding?function(e){const t=new TextEncoder,r=new ReadableStream({async start(r){for await(const a of e)r.enqueue(t.encode(`event: data\ndata: ${JSON.stringify(a)}\n\n`));r.enqueue(t.encode("event: end\n\n")),r.close()}});return c.bO.fromReadableStream(r)}(a):c.bO.fromAsyncGenerator(a)}async*_streamEventsV2(e,t,r){const a=new _({...r,autoClose:!1}),n=(0,O.ZI)(t),s=n.runId??(0,i.A)();n.runId=s;const o=n.callbacks;if(void 0===o)n.callbacks=[a];else if(Array.isArray(o))n.callbacks=o.concat(a);else{const e=o.copy();e.addHandler(a,!0),n.callbacks=e}const l=new AbortController,c=this,u=async function(){try{let r;t?.signal?"any"in AbortSignal?r=AbortSignal.any([l.signal,t.signal]):(r=t.signal,t.signal.addEventListener("abort",(()=>{l.abort()}),{once:!0})):r=l.signal;const i=await c.stream(e,{...n,signal:r}),o=a.tapOutputIterable(s,i);for await(const e of o)if(l.signal.aborted)break}finally{await a.finish()}}();let d,h=!1;try{for await(const t of a)h?(t.run_id===d&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t):(t.data.input=e,h=!0,d=t.run_id,yield t)}finally{l.abort(),await u}}async*_streamEventsV1(e,t,r){let a,n=!1;const i=(0,O.ZI)(t),s=i.tags??[],o=i.metadata??{},l=i.runName??this.getName(),c=new g({...r,autoClose:!1,_schemaFormat:"streaming_events"}),u=new I({...r}),d=this._streamLog(e,c,i);for await(const t of d){if(a=a?a.concat(t):h.fromRunLogPatch(t),void 0===a.state)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!n){n=!0;const t={...a.state},r={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};u.includeEvent(r,t.type)&&(yield r)}const r=t.ops.filter((e=>e.path.startsWith("/logs/"))).map((e=>e.path.split("/")[2])),i=[...new Set(r)];for(const e of i){let t,r={};const n=a.state.logs[e];if(t=void 0===n.end_time?n.streamed_output.length>0?"stream":"start":"end","start"===t)void 0!==n.inputs&&(r.input=n.inputs);else if("end"===t)void 0!==n.inputs&&(r.input=n.inputs),r.output=n.final_output;else if("stream"===t){const e=n.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${n.name}"`);r={chunk:n.streamed_output[0]},n.streamed_output=[]}yield{event:`on_${n.type}_${t}`,name:n.name,run_id:n.id,tags:n.tags,metadata:n.metadata,data:r}}const{state:c}=a;if(c.streamed_output.length>0){const e=c.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${c.name}"`);const t={chunk:c.streamed_output[0]};c.streamed_output=[];const r={event:`on_${c.type}_stream`,run_id:c.id,tags:s,metadata:o,name:l,data:t};u.includeEvent(r,c.type)&&(yield r)}}const p=a?.state;if(void 0!==p){const e={event:`on_${p.type}_end`,name:l,run_id:p.id,tags:s,metadata:o,data:{output:p.final_output}};u.includeEvent(e,p.type)&&(yield e)}}static isRunnable(e){return T(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new V({bound:this,config:{},configFactories:[a=>({callbacks:[new k({config:a,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return function(e,t){const r=t.name??e.getName(),n=t.description??t.schema?.description;return t.schema.constructor===a.z.ZodString?new re({name:r,description:n,schema:a.z.object({input:a.z.string()}).transform((e=>e.input)),bound:e}):new re({name:r,description:n,schema:t.schema,bound:e})}(this,e)}}class V extends H{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=(0,O.SV)(this.config,...e);return(0,O.SV)(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig((0,O.ZI)(t),this.kwargs))}async batch(e,t,r){const a=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig((0,O.ZI)(e),this.kwargs)))):await this._mergeConfig((0,O.ZI)(t),this.kwargs);return this.bound.batch(e,a,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig((0,O.ZI)(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig((0,O.ZI)(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig((0,O.ZI)(t),this.kwargs))}streamEvents(e,t,r){const a=this;return c.bO.fromAsyncGenerator(async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig((0,O.ZI)(t),a.kwargs),version:t.version},r)}())}static isRunnableBinding(e){return e.bound&&H.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new V({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new k({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class G extends H{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new G({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,(0,O.tn)(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new G({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class q extends V{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const a=e>1?`retry:attempt:${e}`:void 0;return(0,O.tn)(t,{callbacks:r?.getChild(a)})}async _invoke(e,t,r){return n((a=>super.invoke(e,this._patchConfigForRetry(a,t,r))),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,a){const i={};try{await n((async n=>{const s=e.map(((e,t)=>t)).filter((e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error)),o=s.map((t=>e[t])),l=s.map((e=>this._patchConfigForRetry(n,t?.[e],r?.[e]))),c=await super.batch(o,l,{...a,returnExceptions:!0});let u;for(let e=0;e<c.length;e+=1){const t=c[e],r=s[e];t instanceof Error&&void 0===u&&(u=t,u.input=o[e]),i[r.toString()]=t}if(u)throw u;return c}),{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==a?.returnExceptions)throw e}return Object.keys(i).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>i[parseInt(e,10)]))}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class Y extends H{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=(0,O.ZI)(t),a=await(0,O.kJ)(r),n=await(a?.handleChainStart(this.toJSON(),B(e,"input"),r.runId,void 0,void 0,void 0,r?.runName));delete r.runId;let i,s=e;try{const e=[this.first,...this.middle];for(let a=0;a<e.length;a+=1){const i=e[a].invoke(s,(0,O.tn)(r,{callbacks:n?.getChild(this.omitSequenceTags?void 0:`seq:step:${a+1}`)}));s=await(0,E.o)(i,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");i=await this.last.invoke(s,(0,O.tn)(r,{callbacks:n?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(e){throw await(n?.handleChainError(e)),e}return await(n?.handleChainEnd(B(i,"output"))),i}async batch(e,t,r){const a=this._getOptionsList(t??{},e.length),n=await Promise.all(a.map(O.kJ)),i=await Promise.all(n.map((async(t,r)=>{const n=await(t?.handleChainStart(this.toJSON(),B(e[r],"input"),a[r].runId,void 0,void 0,void 0,a[r].runName));return delete a[r].runId,n})));let s=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e].batch(s,i.map(((t,r)=>{const n=t?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`);return(0,O.tn)(a[r],{callbacks:n})})),r);s=await(0,E.o)(t,a[0]?.signal)}}catch(e){throw await Promise.all(i.map((t=>t?.handleChainError(e)))),e}return await Promise.all(i.map((e=>e?.handleChainEnd(B(s,"output"))))),s}async*_streamIterator(e,t){const r=await(0,O.kJ)(t),{runId:a,...n}=t??{},i=await(r?.handleChainStart(this.toJSON(),B(e,"input"),a,void 0,void 0,void 0,n?.runName)),s=[this.first,...this.middle,this.last];let o,l=!0;try{let r=s[0].transform(async function*(){yield e}(),(0,O.tn)(n,{callbacks:i?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let e=1;e<s.length;e+=1){const t=s[e];r=await t.transform(r,(0,O.tn)(n,{callbacks:i?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`)}))}for await(const e of r)if(t?.signal?.throwIfAborted(),yield e,l)if(void 0===o)o=e;else try{o=(0,c.xW)(o,e)}catch(e){o=void 0,l=!1}}catch(e){throw await(i?.handleChainError(e)),e}await(i?.handleChainEnd(B(o,"output")))}getGraph(e){const t=new R;let r=null;return this.steps.forEach(((a,n)=>{const i=a.getGraph(e);0!==n&&i.trimFirstNode(),n!==this.steps.length-1&&i.trimLastNode(),t.extend(i);const s=i.firstNode();if(!s)throw new Error(`Runnable ${a} has no first node`);r&&t.addEdge(r,s),r=i.lastNode()})),t}pipe(e){return Y.isRunnableSequence(e)?new Y({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Y({first:this.first,middle:[...this.middle,this.last],last:Q(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&H.isRunnable(e)}static from([e,...t],r){let a={};return"string"==typeof r?a.name=r:void 0!==r&&(a=r),new Y({...a,first:Q(e),middle:t.slice(0,-1).map(Q),last:Q(t[t.length-1])})}}class J extends H{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Q(r)}static from(e){return new J({steps:e})}async invoke(e,t){const r=(0,O.ZI)(t),a=await(0,O.kJ)(r),n=await(a?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName));delete r.runId;const i={};try{const a=Object.entries(this.steps).map((async([t,a])=>{i[t]=await a.invoke(e,(0,O.tn)(r,{callbacks:n?.getChild(`map:key:${t}`)}))}));await(0,E.o)(Promise.all(a),t?.signal)}catch(e){throw await(n?.handleChainError(e)),e}return await(n?.handleChainEnd(i)),i}async*_transform(e,t,r){const a={...this.steps},n=(0,c.gI)(e,Object.keys(a).length),i=new Map(Object.entries(a).map((([e,a],i)=>{const s=a.transform(n[i],(0,O.tn)(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then((t=>({key:e,gen:s,result:t})))]})));for(;i.size;){const e=Promise.race(i.values()),{key:t,result:a,gen:n}=await(0,E.o)(e,r?.signal);i.delete(t),a.done||(yield{[t]:a.value},i.set(t,n.next().then((e=>({key:t,gen:n,result:e})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=(0,O.ZI)(t),a=new c.Tr({generator:this.transform(async function*(){yield e}(),r),config:r});return await a.setup,c.bO.fromAsyncGenerator(a)}}class W extends H{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!(0,s.GZ)(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),a=await(0,O.kJ)(r),n=this.func((0,O.tn)(r,{callbacks:a}),e);return(0,E.o)(n,r?.signal)}async*_streamIterator(e,t){const[r]=this._getOptionsList(t??{},1),a=await this.invoke(e,t);var n;if(F(a))for await(const e of a)r?.signal?.throwIfAborted(),yield e;else if(null!=(n=a)&&"object"==typeof n&&"next"in n&&"function"==typeof n.next)for(;;){r?.signal?.throwIfAborted();const e=a.next();if(e.done)break;yield e.value}else yield a}static from(e){return new W({func:e})}}class K extends H{static lc_name(){return"RunnableLambda"}constructor(e){if((0,s.GZ)(e.func))return W.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){if((0,s.GZ)(e))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}(e.func),this.func=e.func}static from(e){return new K({func:e})}async _invoke(e,t,r){return new Promise(((a,n)=>{const i=(0,O.tn)(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??O.p_)-1});S.Nx.runWithConfig((0,O.DY)(i),(async()=>{try{let r=await this.func(e,{...i});if(r&&H.isRunnable(r)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");r=await r.invoke(e,{...i,recursionLimit:(i.recursionLimit??O.p_)-1})}else if(F(r)){let e;for await(const a of Z(i,r))if(t?.signal?.throwIfAborted(),void 0===e)e=a;else try{e=(0,c.xW)(e,a)}catch(t){e=a}r=e}else if(U(r)){let e;for(const a of D(i,r))if(t?.signal?.throwIfAborted(),void 0===e)e=a;else try{e=(0,c.xW)(e,a)}catch(t){e=a}r=e}a(r)}catch(e){n(e)}}))}))}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,r){let a;for await(const t of e)if(void 0===a)a=t;else try{a=(0,c.xW)(a,t)}catch(e){a=t}const n=(0,O.tn)(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??O.p_)-1}),i=await new Promise(((e,t)=>{S.Nx.runWithConfig((0,O.DY)(n),(async()=>{try{const t=await this.func(a,{...n,config:n});e(t)}catch(e){t(e)}}))}));if(i&&H.isRunnable(i)){if(0===r?.recursionLimit)throw new Error("Recursion limit reached.");const e=await i.stream(a,n);for await(const t of e)yield t}else if(F(i))for await(const e of Z(n,i))r?.signal?.throwIfAborted(),yield e;else if(U(i))for(const e of D(n,i))r?.signal?.throwIfAborted(),yield e;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=(0,O.ZI)(t),a=new c.Tr({generator:this.transform(async function*(){yield e}(),r),config:r});return await a.setup,c.bO.fromAsyncGenerator(a)}}class X extends H{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=(0,O.ZI)(t),a=await(0,O.kJ)(r),{runId:n,...i}=r,s=await(a?.handleChainStart(this.toJSON(),B(e,"input"),n,void 0,void 0,void 0,i?.runName)),o=(0,O.tn)(i,{callbacks:s?.getChild()});return await S.Nx.runWithConfig(o,(async()=>{let t;for(const a of this.runnables()){r?.signal?.throwIfAborted();try{const t=await a.invoke(e,o);return await(s?.handleChainEnd(B(t,"output"))),t}catch(e){void 0===t&&(t=e)}}if(void 0===t)throw new Error("No error stored at end of fallback.");throw await(s?.handleChainError(t)),t}))}async*_streamIterator(e,t){const r=(0,O.ZI)(t),a=await(0,O.kJ)(r),{runId:n,...i}=r,s=await(a?.handleChainStart(this.toJSON(),B(e,"input"),n,void 0,void 0,void 0,i?.runName));let o,l,u;for(const t of this.runnables()){r?.signal?.throwIfAborted();const a=(0,O.tn)(i,{callbacks:s?.getChild()});try{l=Z(a,await t.stream(e,a));break}catch(e){void 0===o&&(o=e)}}if(void 0===l){const e=o??new Error("No error stored at end of fallback.");throw await(s?.handleChainError(e)),e}try{for await(const e of l){yield e;try{u=void 0===u?u:(0,c.xW)(u,e)}catch(e){u=void 0}}}catch(e){throw await(s?.handleChainError(e)),e}await(s?.handleChainEnd(B(u,"output")))}async batch(e,t,r){if(r?.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(t??{},e.length),n=await Promise.all(a.map((e=>(0,O.kJ)(e)))),i=await Promise.all(n.map((async(t,r)=>{const n=await(t?.handleChainStart(this.toJSON(),B(e[r],"input"),a[r].runId,void 0,void 0,void 0,a[r].runName));return delete a[r].runId,n})));let s;for(const t of this.runnables()){a[0].signal?.throwIfAborted();try{const n=await t.batch(e,i.map(((e,t)=>(0,O.tn)(a[t],{callbacks:e?.getChild()}))),r);return await Promise.all(i.map(((e,t)=>e?.handleChainEnd(B(n[t],"output"))))),n}catch(e){void 0===s&&(s=e)}}if(!s)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(i.map((e=>e?.handleChainError(s)))),s}}function Q(e){if("function"==typeof e)return new K({func:e});if(H.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[r,a]of Object.entries(e))t[r]=Q(a);return new J({steps:t})}}class ee extends H{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof J&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const a=this.mapper.getStepsKeys(),[n,i]=(0,c.gI)(e),s=this.mapper.transform(i,(0,O.tn)(r,{callbacks:t?.getChild()})),o=s.next();for await(const e of n){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!a.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of s)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=(0,O.ZI)(t),a=new c.Tr({generator:this.transform(async function*(){yield e}(),r),config:r});return await a.setup,c.bO.fromAsyncGenerator(a)}}class te extends H{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=(0,O.ZI)(t),a=new c.Tr({generator:this.transform(async function*(){yield e}(),r),config:r});return await a.setup,c.bO.fromAsyncGenerator(a)}}class re extends V{constructor(e){super({bound:Y.from([K.from((async e=>{let t;if((0,z.K)(e))try{t=await this.schema.parseAsync(e.args)}catch(t){throw new z.q("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t})).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}},3246:(e,t,r)=>{"use strict";r.d(t,{gk:()=>c,m5:()=>u});var a=r(3829),n=r(4785),i=r(2738),s=r(6232);const o=Symbol.for("lc:context_variables");class l{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let r={},a=[];for(const e of t){const[t,n]=e.split("="),i=decodeURIComponent(n);"langsmith-metadata"===t?r=JSON.parse(i):"langsmith-tags"===t&&(a=i.split(","))}return new l(r,a)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class c{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),u(e))return void Object.assign(this,{...e});const t=c.getDefaultConfig(),{metadata:r,...a}=e,n=a.client??c.getSharedClient(),i={...r,...a?.extra?.metadata};if(a.extra={...a.extra,metadata:i},Object.assign(this,{...t,...a,client:n}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){const e=function(e,t,r=1){const a=r.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${a}Z`.replace(/[-:.]/g,"")+t}(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}static getDefaultConfig(){return{id:a.A(),run_type:"chain",project_name:(0,n.Jz)("PROJECT")??(0,n.Az)("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:(0,n.Az)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,n.Az)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return c.sharedClient||(c.sharedClient=new i.Kj),c.sharedClient}createChild(e){const t=this.child_execution_order+1,r=new c({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});o in this&&(r[o]=this[o]);const a=Symbol.for("lc:child_config"),n=e.extra?.[a]??this.extra[a];if(void 0!==(i=n)&&"object"==typeof i.callbacks&&(h(i.callbacks?.handlers)||h(i.callbacks))){const e={...n},t=function(e){return"object"==typeof e&&null!=e&&Array.isArray(e.handlers)}(e.callbacks)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:r.id}),t.handlers?.find(d)?.updateFromRunTree?.(r),e.callbacks=t),r.extra[a]=e}var i;const s=new Set;let l=this;for(;null!=l&&!s.has(l.id);)s.add(l.id),l.child_execution_order=Math.max(l.child_execution_order,t),l=l.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,t,r=!0){const a=e.extra??{};if(a.runtime||(a.runtime={}),t)for(const[e,r]of Object.entries(t))a.runtime[e]||(a.runtime[e]=r);let n,i;return r?(i=e.parent_run?.id,n=[]):(n=e.child_runs.map((e=>this._convertToCreate(e,t,r))),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:n,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=(0,n.Ec)(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){(0,s.m)("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const e of this.child_runs)await e.postRun(!1)}}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(){try{const e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:(new Date).toISOString(),message:e}):this.events.push({...e,time:e.time??(new Date).toISOString()})}static fromRunnableConfig(e,t){const r=e?.callbacks;let a,i,s,o=!!["TRACING_V2","TRACING"].find((e=>"true"===(0,n.Jz)(e)));if(r){const e=r?.getParentRunId?.()??"",t=r?.handlers?.find((e=>"langchain_tracer"==e?.name));a=t?.getRun?.(e),i=t?.projectName,s=t?.client,o=o||!!t}return a?new c({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:s,tracingEnabled:o,project_name:i,tags:[...new Set((a?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...a?.extra?.metadata,...e?.metadata}}}).createChild(t):new c({...t,client:s,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){const r="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=r["langsmith-trace"];if(!a||"string"!=typeof a)return;const n=a.trim(),i=n.split(".").map((e=>{const[t,r]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:r}})),s=i[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:s,dotted_order:n};if(r.baggage&&"string"==typeof r.baggage){const e=l.fromHeader(r.baggage);o.metadata=e.metadata,o.tags=e.tags}return new c(o)}toHeaders(e){const t={"langsmith-trace":this.dotted_order,baggage:new l(this.extra?.metadata,this.tags).toHeader()};if(e)for(const[r,a]of Object.entries(t))e.set(r,a);return t}}function u(e){return void 0!==e&&"function"==typeof e.createChild&&"function"==typeof e.postRun}function d(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function h(e){return Array.isArray(e)&&e.some((e=>d(e)))}Object.defineProperty(c,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null})},3290:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(228),n=r(6641),i=r(4774),s=()=>{},o=new n.TimeoutError;t.default=class extends a{constructor(e){var t,r,a,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(n=null===(a=e.interval)||void 0===a?void 0:a.toString())&&void 0!==n?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((r,a)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const i=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&a(o)}));r(await i)}catch(e){a(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},3389:(e,t,r)=>{"use strict";r.d(t,{vR:()=>o,GZ:()=>l});var a=r(3246);const n=Symbol.for("ls:tracing_async_local_storage"),i=new class{getStore(){}run(e,t){return t()}},s=new class{getInstance(){return globalThis[n]??i}initializeGlobalInstance(e){void 0===globalThis[n]&&(globalThis[n]=e)}},o=()=>{const e=s.getInstance().getStore();if(!(0,a.m5)(e))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join("\n"));return e};function l(e){return"function"==typeof e&&"langsmith:traceable"in e}Symbol.for("langsmith:traceable:root")},3490:(e,t,r)=>{"use strict";r.d(t,{AJ:()=>p,F7:()=>c,Iv:()=>i,Vt:()=>l,XQ:()=>s,_I:()=>n,dp:()=>d,gj:()=>u,ns:()=>o,ny:()=>h});var a=r(8999);function n(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?l(e,t)??[...e,...t]:[...e,{type:"text",text:t}]}function i(e,t){return"error"===e||"error"===t?"error":"success"}class s extends a.y{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}getType(){return this._getType()}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(null===e)return this;const t=(r=this._printableFields,a=Math.max(4,e),JSON.stringify(function e(t,r){if("object"!=typeof t||null==t)return t;if(r>=a)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map((t=>e(t,r+1)));const n={};for(const a of Object.keys(t))n[a]=e(t[a],r+1);return n}(r,0),null,2));var r,a;return`${this.constructor.lc_name()} ${t}`}}function o(e,t){const r={...e};for(const[e,a]of Object.entries(t))if(null==r[e])r[e]=a;else{if(null==a)continue;if(typeof r[e]!=typeof a||Array.isArray(r[e])!==Array.isArray(a))throw new Error(`field[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof r[e]){if("type"===e)continue;r[e]+=a}else if("object"!=typeof r[e]||Array.isArray(r[e]))if(Array.isArray(r[e]))r[e]=l(r[e],a);else{if(r[e]===a)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else r[e]=o(r[e],a)}return r}function l(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{const r=[...e];for(const e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){const t=r.findIndex((t=>t.index===e.index));-1!==t?r[t]=o(r[t],e):r.push(e)}else{if("object"==typeof e&&"text"in e&&""===e.text)continue;r.push(e)}return r}}}function c(e,t){if(!e&&!t)throw new Error("Cannot merge two undefined objects.");if(e&&t){if(typeof e!=typeof t)throw new Error(`Cannot merge objects of different types.\nLeft ${typeof e}\nRight ${typeof t}`);if("string"==typeof e&&"string"==typeof t)return e+t;if(Array.isArray(e)&&Array.isArray(t))return l(e,t);if("object"==typeof e&&"object"==typeof t)return o(e,t);if(e===t)return e;throw new Error(`Can not merge objects of different types.\nLeft ${e}\nRight ${t}`)}return e||t}class u extends s{}function d(e){return"string"==typeof e.role}function h(e){return"function"==typeof e?._getType}function p(e){return h(e)&&"function"==typeof e.concat}},3602:(e,t,r)=>{const a=r(4899),n=r(9558),i=r(2559);e.exports=(e,t)=>{e=new n(e,t);let r=new a("0.0.0");if(e.test(r))return r;if(r=new a("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const n=e.set[t];let s=null;n.forEach((e=>{const t=new a(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":s&&!i(t,s)||(s=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!s||r&&!i(r,s)||(r=s)}return r&&e.test(r)?r:null}},3650:(e,t,r)=>{"use strict";r.d(t,{PromptTemplate:()=>i});var a=r(329),n=r(9849);class i extends a.L{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if("mustache"===this.templateFormat)throw new Error("Mustache templates cannot be validated.");let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,n.Ns)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return(0,n.Xm)(this.template,this.templateFormat,t)}static fromExamples(e,t,r,a="\n\n",n=""){const s=[n,...e,t].join(a);return new i({inputVariables:r,template:s})}static fromTemplate(e,t){const{templateFormat:r="f-string",...a}=t??{},s=new Set;return(0,n.QC)(e,r).forEach((e=>{"variable"===e.type&&s.add(e.name)})),new i({inputVariables:[...s],templateFormat:r,template:e,...a})}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new i(a)}serialize(){if(void 0!==this.outputParser)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new i({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}},3690:(e,t,r)=>{const a=r(7737);e.exports=(e,t)=>{const r=a(e,t);return r&&r.prerelease.length?r.prerelease:null}},3766:(e,t,r)=>{"use strict";r.d(t,{RZ:()=>E,qF:()=>f});var a=r(1673),n=r(5311),i=r(3230),s=r(329),o=r(6993),l=r(3650),c=r(6279),u=r(9849),d=r(1368);class h extends i.YN{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig((e=>this.formatMessages(e)),e,{...t,runType:"prompt"})}}class p extends h{static lc_name(){return"MessagesPlaceholder"}constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){const t=e[this.variableName];if(this.optional&&!t)return[];if(!t){const e=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw e.name="InputFormatError",e}let r;try{r=Array.isArray(t)?t.map(a.K0):[(0,a.K0)(t)]}catch(e){const r="string"==typeof t?t:JSON.stringify(t,null,2),a=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${r}`,`Additional message: ${e.message}`].join("\n\n"));throw a.name="InputFormatError",a.lc_error_code=e.lc_error_code,a}return r}}class m extends h{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class f extends o.m{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new n.aB(t)}}class g extends m{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new a.cM(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(l.PromptTemplate.fromTemplate(e,{templateFormat:r?.templateFormat}),t)}}class y extends h{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let e=[];this.prompt.forEach((t=>{"inputVariables"in t&&(e=e.concat(t.inputVariables))})),this.inputVariables=e}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){const t=this.constructor;if(t._messageClass())return new(t._messageClass())({content:e});if(t.chatMessageClass){const r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if("string"==typeof e)return new this(l.PromptTemplate.fromTemplate(e,t));const r=[];for(const a of e)if("string"==typeof a||"object"==typeof a&&"text"in a){let e="";"string"==typeof a?e=a:"string"==typeof a.text&&(e=a.text??"");const n={...t,..."string"!=typeof a?{additionalContentFields:a}:{}};r.push(l.PromptTemplate.fromTemplate(e,n))}else if("object"==typeof a&&"image_url"in a){let e,n=a.image_url??"",i=[];if("string"==typeof n){let r;r="mustache"===t?.templateFormat?(0,u.g2)(n):(0,u.D4)(n);const s=r.flatMap((e=>"variable"===e.type?[e.name]:[]));if((s?.length??0)>0){if(s.length>1)throw new Error(`Only one format variable allowed per image template.\nGot: ${s}\nFrom: ${n}`);i=[s[0]]}else i=[];n={url:n},e=new c.C({template:n,inputVariables:i,templateFormat:t?.templateFormat,additionalContentFields:a})}else{if("object"!=typeof n)throw new Error("Invalid image template");if("url"in n){let e;e="mustache"===t?.templateFormat?(0,u.g2)(n.url):(0,u.D4)(n.url),i=e.flatMap((e=>"variable"===e.type?[e.name]:[]))}else i=[];e=new c.C({template:n,inputVariables:i,templateFormat:t?.templateFormat,additionalContentFields:a})}r.push(e)}return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof s.L){const t=await this.prompt.format(e);return this.createMessage(t)}{const t=[];for(const r of this.prompt){let a={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(const t of r.inputVariables)a||(a={[t]:e[t]}),a={...a,[t]:e[t]};if(r instanceof s.L){const e=await r.format(a);let n;"additionalContentFields"in r&&(n=r.additionalContentFields),t.push({...n,type:"text",text:e})}else if(r instanceof c.C){const e=await r.format(a);let n;"additionalContentFields"in r&&(n=r.additionalContentFields),t.push({...n,type:"image_url",image_url:e})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}}class b extends y{static _messageClass(){return a.xc}static lc_name(){return"HumanMessagePromptTemplate"}}class v extends y{static _messageClass(){return a.Od}static lc_name(){return"AIMessagePromptTemplate"}}class _ extends y{static _messageClass(){return a.tn}static lc_name(){return"SystemMessagePromptTemplate"}}function w(e,t){if("function"==typeof e.formatMessages||(0,a.ny)(e))return e;if(Array.isArray(e)&&"placeholder"===e[0]){const r=e[1];if("mustache"===t?.templateFormat&&"string"==typeof r&&"{{"===r.slice(0,2)&&"}}"===r.slice(-2)){const e=r.slice(2,-2);return new p({variableName:e,optional:!0})}if("string"==typeof r&&"{"===r[0]&&"}"===r[r.length-1]){const e=r.slice(1,-1);return new p({variableName:e,optional:!0})}throw new Error(`Invalid placeholder template for format ${t?.templateFormat??'"f-string"'}: "${e[1]}". Expected a variable name surrounded by ${"mustache"===t?.templateFormat?"double":"single"} curly braces.`)}const r=(0,a.K0)(e);let n;if(n="string"==typeof r.content?r.content:r.content.map((e=>"text"in e?{...e,text:e.text}:"image_url"in e?{...e,image_url:e.image_url}:e)),"human"===r._getType())return b.fromTemplate(n,t);if("ai"===r._getType())return v.fromTemplate(n,t);if("system"===r._getType())return _.fromTemplate(n,t);if(a.cM.isInstance(r))return g.fromTemplate(r.content,r.role,t);throw new Error(`Could not coerce message prompt template from input. Received message type: "${r._getType()}".`)}class E extends f{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const e=new Set;for(const t of this.promptMessages)if(!(t instanceof a.XQ))for(const r of t.inputVariables)e.add(r);const t=this.inputVariables,r=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),n=new Set([...r].filter((t=>!e.has(t))));if(n.size>0)throw new Error(`Input variables \`${[...n]}\` are not used in any of the prompt messages.`);const i=new Set([...e].filter((e=>!r.has(e))));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;const r=await Promise.all(e.content.map((async e=>{if("image_url"!==e.type)return e;let r="";r="string"==typeof e.image_url?e.image_url:e.image_url.url;const a=l.PromptTemplate.fromTemplate(r,{templateFormat:this.templateFormat}),n=await a.format(t);return"string"!=typeof e.image_url&&"url"in e.image_url?e.image_url.url=n:e.image_url=n,e})));return e.content=r,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const e of this.promptMessages)if(e instanceof a.XQ)r.push(await this._parseImagePrompts(e,t));else{const a=e.inputVariables.reduce(((r,a)=>{if(!(a in t||"MessagesPlaceholder"===e.constructor.lc_name()&&e.optional))throw(0,d.Y)(new Error(`Missing value for input variable \`${a.toString()}\``),"INVALID_PROMPT_INPUT");return r[a]=t[a],r}),{}),n=await e.formatMessages(a);r=r.concat(n)}return r}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new E(a)}static fromTemplate(e,t){const r=l.PromptTemplate.fromTemplate(e,t),a=new b({prompt:r});return this.fromMessages([a])}static fromMessages(e,t){const r=e.reduce(((e,r)=>e.concat(r instanceof E?r.promptMessages:[w(r,t)])),[]),n=e.reduce(((e,t)=>t instanceof E?Object.assign(e,t.partialVariables):e),Object.create(null)),i=new Set;for(const e of r)if(!(e instanceof a.XQ))for(const t of e.inputVariables)t in n||i.add(t);return new this({...t,inputVariables:[...i],promptMessages:r,partialVariables:n,templateFormat:t?.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}},3767:(e,t,r)=>{const a=r(4899);e.exports=(e,t)=>new a(e,t).major},3829:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});const a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var n,i=new Uint8Array(16);function s(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)}for(var o=[],l=0;l<256;++l)o.push((l+256).toString(16).slice(1));const c=function(e,t,r){if(a.randomUUID&&!t&&!e)return a.randomUUID();var n=(e=e||{}).random||(e.rng||s)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return function(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}(n)}},3961:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var a=this;return this._timer=setTimeout((function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout((function(){a._operationTimeoutCb(a._attempts)}),a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)}),r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var n=this._errors[a],i=n.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=n,r=s)}return t}},4004:(e,t,r)=>{const a=r(7737);e.exports=(e,t)=>{const r=a(e,t);return r?r.version:null}},4056:(e,t,r)=>{const a=r(4621);e.exports=(e,t,r)=>a(e,t,r)<0},4076:(e,t,r)=>{const a=r(6592);e.exports=(e,t,r)=>a(e,t,">",r)},4083:(e,t,r)=>{"use strict";e=r.nmd(e);const a=(e=0)=>t=>`[${38+e};5;${t}m`,n=(e=0)=>(t,r,a)=>`[${38+e};2;${t};${r};${a}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[r,a]of Object.entries(t)){for(const[r,n]of Object.entries(a))t[r]={open:`[${n[0]}m`,close:`[${n[1]}m`},a[r]=t[r],e.set(n[0],n[1]);Object.defineProperty(t,r,{value:a,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=a(),t.color.ansi16m=n(),t.bgColor.ansi256=a(10),t.bgColor.ansi16m=n(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map((e=>e+e)).join(""));const a=Number.parseInt(r,16);return[a>>16&255,a>>8&255,255&a]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},4106:(e,t,r)=>{const a=r(4899);e.exports=(e,t,r,n,i)=>{"string"==typeof r&&(i=n,n=r,r=void 0);try{return new a(e instanceof a?e.version:e,r).inc(t,n,i).version}catch(e){return null}}},4116:(e,t,r)=>{"use strict";const a=r(5617),n=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class i extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const s=(e,t)=>new Promise(((r,s)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=a.operation(t);o.attempt((async a=>{try{r(await e(a))}catch(e){if(!(e instanceof Error))return void s(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof i)o.stop(),s(e.originalError);else if(e instanceof TypeError&&(l=e.message,!n.includes(l)))o.stop(),s(e);else{((e,t,r)=>{const a=r.retries-(t-1);e.attemptNumber=t,e.retriesLeft=a})(e,a,t);try{await t.onFailedAttempt(e)}catch(e){return void s(e)}o.retry(e)||s(o.mainError())}}var l}))}));e.exports=s,e.exports.default=s,e.exports.AbortError=i},4301:(e,t,r)=>{"use strict";r.d(t,{XU:()=>i,cM:()=>n});var a=r(3490);class n extends a.XQ{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return n}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}get _printableFields(){return{...super._printableFields,role:this.role}}}class i extends a.gj{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new i({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}},4350:(e,t,r)=>{"use strict";r.d(t,{Nx:()=>l});var a=r(1259),n=r(6968),i=r(5780);const s=new class{getStore(){}run(e,t){return t()}enterWith(e){}},o=Symbol.for("lc:child_config"),l=new class{getInstance(){return(0,n.X0)()??s}getRunnableConfig(){const e=this.getInstance();return e.getStore()?.extra?.[o]}runWithConfig(e,t,r){const s=i.Td._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),l=this.getInstance(),c=l.getStore(),u=s?.getParentRunId(),d=s?.handlers?.find((e=>"langchain_tracer"===e?.name));let h;return d&&u?h=d.convertToRunTree(u):r||(h=new a.gk({name:"<runnable_lambda>",tracingEnabled:!1})),h&&(h.extra={...h.extra,[o]:e}),void 0!==c&&void 0!==c[n.hr]&&(h[n.hr]=c[n.hr]),l.run(h,t)}initializeGlobalInstance(e){void 0===(0,n.X0)()&&(0,n.pH)(e)}}},4453:(e,t,r)=>{const a=r(6592);e.exports=(e,t,r)=>a(e,t,"<",r)},4476:(e,t,r)=>{"use strict";var a,n;r.d(t,{Ii:()=>je,kY:()=>Be,z:()=>Tt}),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),a={};for(const e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(a||(a={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(n||(n={}));const i=a.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),s=e=>{switch(typeof e){case"undefined":return i.undefined;case"string":return i.string;case"number":return isNaN(e)?i.nan:i.number;case"boolean":return i.boolean;case"function":return i.function;case"bigint":return i.bigint;case"symbol":return i.symbol;case"object":return Array.isArray(e)?i.array:null===e?i.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?i.promise:"undefined"!=typeof Map&&e instanceof Map?i.map:"undefined"!=typeof Set&&e instanceof Set?i.set:"undefined"!=typeof Date&&e instanceof Date?i.date:i.object;default:return i.unknown}},o=a.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class l extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(a);else if("invalid_return_type"===n.code)a(n.returnTypeError);else if("invalid_arguments"===n.code)a(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,a=0;for(;a<n.path.length;){const r=n.path[a];a===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof l))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,a.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},r=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}l.create=e=>new l(e);const c=(e,t)=>{let r;switch(e.code){case o.invalid_type:r=e.received===i.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case o.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,a.jsonStringifyReplacer)}`;break;case o.unrecognized_keys:r=`Unrecognized key(s) in object: ${a.joinValues(e.keys,", ")}`;break;case o.invalid_union:r="Invalid input";break;case o.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${a.joinValues(e.options)}`;break;case o.invalid_enum_value:r=`Invalid enum value. Expected ${a.joinValues(e.options)}, received '${e.received}'`;break;case o.invalid_arguments:r="Invalid function arguments";break;case o.invalid_return_type:r="Invalid function return type";break;case o.invalid_date:r="Invalid date";break;case o.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:a.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case o.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case o.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case o.custom:r="Invalid input";break;case o.invalid_intersection_types:r="Intersection results could not be merged";break;case o.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case o.not_finite:r="Number must be finite";break;default:r=t.defaultError,a.assertNever(e)}return{message:r}};let u=c;function d(){return u}const h=e=>{const{data:t,path:r,errorMaps:a,issueData:n}=e,i=[...r,...n.path||[]],s={...n,path:i};if(void 0!==n.message)return{...n,path:i,message:n.message};let o="";const l=a.filter((e=>!!e)).slice().reverse();for(const e of l)o=e(s,{data:t,defaultError:o}).message;return{...n,path:i,message:o}};function p(e,t){const r=d(),a=h({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===c?void 0:c].filter((e=>!!e))});e.common.issues.push(a)}class m{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const a of t){if("aborted"===a.status)return f;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t){const t=await e.key,a=await e.value;r.push({key:t,value:a})}return m.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const a of t){const{key:t,value:n}=a;if("aborted"===t.status)return f;if("aborted"===n.status)return f;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"===t.value||void 0===n.value&&!a.alwaysSet||(r[t.value]=n.value)}return{status:e.value,value:r}}}const f=Object.freeze({status:"aborted"}),g=e=>({status:"dirty",value:e}),y=e=>({status:"valid",value:e}),b=e=>"aborted"===e.status,v=e=>"dirty"===e.status,_=e=>"valid"===e.status,w=e=>"undefined"!=typeof Promise&&e instanceof Promise;function E(e,t,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function O(e,t,r,a,n){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?n.call(e,r):n?n.value=r:t.set(e,r),r}var x,k,T;"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(x||(x={}));class I{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const S=(e,t)=>{if(_(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new l(e.common.issues);return this._error=t,this._error}}};function P(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:a,description:n}=e;if(t&&(r||a))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{var i,s;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:n.defaultError}:void 0===n.data?{message:null!==(i=null!=o?o:a)&&void 0!==i?i:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(s=null!=o?o:r)&&void 0!==s?s:n.defaultError}},description:n}}class A{get description(){return this._def.description}_getType(e){return s(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:s(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new m,ctx:{common:e.parent.common,data:e.data,parsedType:s(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(w(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:s(e)},n=this._parseSync({data:e,path:a.path,parent:a});return S(a,n)}"~validate"(e){var t,r;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:s(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:a});return _(t)?{value:t.value}:{issues:a.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then((e=>_(e)?{value:e.value}:{issues:a.common.issues}))}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:s(e)},a=this._parse({data:e,path:r.path,parent:r}),n=await(w(a)?a:Promise.resolve(a));return S(r,n)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,a)=>{const n=e(t),i=()=>a.addIssue({code:o.custom,...r(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then((e=>!!e||(i(),!1))):!!n||(i(),!1)}))}refinement(e,t){return this._refinement(((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1)))}_refinement(e){return new Ae({schema:this,typeName:Be.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return je.create(this,this._def)}nullable(){return Ce.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return de.create(this)}promise(){return Pe.create(this,this._def)}or(e){return me.create([this,e],this._def)}and(e){return be.create(this,e,this._def)}transform(e){return new Ae({...P(this._def),schema:this,typeName:Be.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new $e({...P(this._def),innerType:this,defaultValue:t,typeName:Be.ZodDefault})}brand(){return new Me({typeName:Be.ZodBranded,type:this,...P(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Ne({...P(this._def),innerType:this,catchValue:t,typeName:Be.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Ue.create(this,e)}readonly(){return Fe.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const j=/^c[^\s-]{8,}$/i,C=/^[0-9a-z]+$/,$=/^[0-9A-HJKMNP-TV-Z]{26}$/i,N=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,R=/^[a-z0-9_-]{21}$/i,L=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,M=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,U=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let F;const D=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Z=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,z=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,B=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,H=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,V=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,G="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",q=new RegExp(`^${G}$`);function Y(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function J(e){let t=`${G}T${Y(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function W(e,t){if(!L.test(e))return!1;try{const[r]=e.split("."),a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(a));return!("object"!=typeof n||null===n||!n.typ||!n.alg||t&&n.alg!==t)}catch(e){return!1}}function K(e,t){return!("v4"!==t&&t||!Z.test(e))||!("v6"!==t&&t||!B.test(e))}class X extends A{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==i.string){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.string,received:t.parsedType}),f}const t=new m;let r;for(const i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(r=this._getOrReturnCtx(e,r),p(r,{code:o.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("max"===i.kind)e.data.length>i.value&&(r=this._getOrReturnCtx(e,r),p(r,{code:o.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("length"===i.kind){const a=e.data.length>i.value,n=e.data.length<i.value;(a||n)&&(r=this._getOrReturnCtx(e,r),a?p(r,{code:o.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):n&&p(r,{code:o.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),t.dirty())}else if("email"===i.kind)U.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"email",code:o.invalid_string,message:i.message}),t.dirty());else if("emoji"===i.kind)F||(F=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),F.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"emoji",code:o.invalid_string,message:i.message}),t.dirty());else if("uuid"===i.kind)N.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"uuid",code:o.invalid_string,message:i.message}),t.dirty());else if("nanoid"===i.kind)R.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"nanoid",code:o.invalid_string,message:i.message}),t.dirty());else if("cuid"===i.kind)j.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"cuid",code:o.invalid_string,message:i.message}),t.dirty());else if("cuid2"===i.kind)C.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"cuid2",code:o.invalid_string,message:i.message}),t.dirty());else if("ulid"===i.kind)$.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"ulid",code:o.invalid_string,message:i.message}),t.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(a){r=this._getOrReturnCtx(e,r),p(r,{validation:"url",code:o.invalid_string,message:i.message}),t.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"regex",code:o.invalid_string,message:i.message}),t.dirty())):"trim"===i.kind?e.data=e.data.trim():"includes"===i.kind?e.data.includes(i.value,i.position)||(r=this._getOrReturnCtx(e,r),p(r,{code:o.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),t.dirty()):"toLowerCase"===i.kind?e.data=e.data.toLowerCase():"toUpperCase"===i.kind?e.data=e.data.toUpperCase():"startsWith"===i.kind?e.data.startsWith(i.value)||(r=this._getOrReturnCtx(e,r),p(r,{code:o.invalid_string,validation:{startsWith:i.value},message:i.message}),t.dirty()):"endsWith"===i.kind?e.data.endsWith(i.value)||(r=this._getOrReturnCtx(e,r),p(r,{code:o.invalid_string,validation:{endsWith:i.value},message:i.message}),t.dirty()):"datetime"===i.kind?J(i).test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{code:o.invalid_string,validation:"datetime",message:i.message}),t.dirty()):"date"===i.kind?q.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{code:o.invalid_string,validation:"date",message:i.message}),t.dirty()):"time"===i.kind?new RegExp(`^${Y(i)}$`).test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{code:o.invalid_string,validation:"time",message:i.message}),t.dirty()):"duration"===i.kind?M.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"duration",code:o.invalid_string,message:i.message}),t.dirty()):"ip"===i.kind?(n=e.data,("v4"!==(s=i.version)&&s||!D.test(n))&&("v6"!==s&&s||!z.test(n))&&(r=this._getOrReturnCtx(e,r),p(r,{validation:"ip",code:o.invalid_string,message:i.message}),t.dirty())):"jwt"===i.kind?W(e.data,i.alg)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"jwt",code:o.invalid_string,message:i.message}),t.dirty()):"cidr"===i.kind?K(e.data,i.version)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"cidr",code:o.invalid_string,message:i.message}),t.dirty()):"base64"===i.kind?H.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"base64",code:o.invalid_string,message:i.message}),t.dirty()):"base64url"===i.kind?V.test(e.data)||(r=this._getOrReturnCtx(e,r),p(r,{validation:"base64url",code:o.invalid_string,message:i.message}),t.dirty()):a.assertNever(i);var n,s;return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:o.invalid_string,...x.errToObj(r)})}_addCheck(e){return new X({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...x.errToObj(e)})}url(e){return this._addCheck({kind:"url",...x.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...x.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...x.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...x.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...x.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...x.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...x.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...x.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...x.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...x.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...x.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...x.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...x.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...x.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...x.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...x.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...x.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...x.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...x.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...x.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...x.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...x.errToObj(t)})}nonempty(e){return this.min(1,x.errToObj(e))}trim(){return new X({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new X({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new X({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Q(e,t){const r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=r>a?r:a;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}X.create=e=>{var t;return new X({checks:[],typeName:Be.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...P(e)})};class ee extends A{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==i.number){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.number,received:t.parsedType}),f}let t;const r=new m;for(const n of this._def.checks)"int"===n.kind?a.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),p(t,{code:o.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==Q(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),p(t,{code:o.not_finite,message:n.message}),r.dirty()):a.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,x.toString(t))}gt(e,t){return this.setLimit("min",e,!1,x.toString(t))}lte(e,t){return this.setLimit("max",e,!0,x.toString(t))}lt(e,t){return this.setLimit("max",e,!1,x.toString(t))}setLimit(e,t,r,a){return new ee({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:x.toString(a)}]})}_addCheck(e){return new ee({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:x.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:x.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:x.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:x.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:x.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&a.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ee.create=e=>new ee({checks:[],typeName:Be.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...P(e)});class te extends A{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==i.bigint)return this._getInvalidInput(e);let t;const r=new m;for(const n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),p(t,{code:o.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):a.assertNever(n);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.bigint,received:t.parsedType}),f}gte(e,t){return this.setLimit("min",e,!0,x.toString(t))}gt(e,t){return this.setLimit("min",e,!1,x.toString(t))}lte(e,t){return this.setLimit("max",e,!0,x.toString(t))}lt(e,t){return this.setLimit("max",e,!1,x.toString(t))}setLimit(e,t,r,a){return new te({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:x.toString(a)}]})}_addCheck(e){return new te({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:x.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}te.create=e=>{var t;return new te({checks:[],typeName:Be.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...P(e)})};class re extends A{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==i.boolean){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.boolean,received:t.parsedType}),f}return y(e.data)}}re.create=e=>new re({typeName:Be.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...P(e)});class ae extends A{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==i.date){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.date,received:t.parsedType}),f}if(isNaN(e.data.getTime()))return p(this._getOrReturnCtx(e),{code:o.invalid_date}),f;const t=new m;let r;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(r=this._getOrReturnCtx(e,r),p(r,{code:o.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(r=this._getOrReturnCtx(e,r),p(r,{code:o.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):a.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ae({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:x.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:x.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ae.create=e=>new ae({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:Be.ZodDate,...P(e)});class ne extends A{_parse(e){if(this._getType(e)!==i.symbol){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.symbol,received:t.parsedType}),f}return y(e.data)}}ne.create=e=>new ne({typeName:Be.ZodSymbol,...P(e)});class ie extends A{_parse(e){if(this._getType(e)!==i.undefined){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.undefined,received:t.parsedType}),f}return y(e.data)}}ie.create=e=>new ie({typeName:Be.ZodUndefined,...P(e)});class se extends A{_parse(e){if(this._getType(e)!==i.null){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.null,received:t.parsedType}),f}return y(e.data)}}se.create=e=>new se({typeName:Be.ZodNull,...P(e)});class oe extends A{constructor(){super(...arguments),this._any=!0}_parse(e){return y(e.data)}}oe.create=e=>new oe({typeName:Be.ZodAny,...P(e)});class le extends A{constructor(){super(...arguments),this._unknown=!0}_parse(e){return y(e.data)}}le.create=e=>new le({typeName:Be.ZodUnknown,...P(e)});class ce extends A{_parse(e){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.never,received:t.parsedType}),f}}ce.create=e=>new ce({typeName:Be.ZodNever,...P(e)});class ue extends A{_parse(e){if(this._getType(e)!==i.undefined){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.void,received:t.parsedType}),f}return y(e.data)}}ue.create=e=>new ue({typeName:Be.ZodVoid,...P(e)});class de extends A{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==i.array)return p(t,{code:o.invalid_type,expected:i.array,received:t.parsedType}),f;if(null!==a.exactLength){const e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(p(t,{code:e?o.too_big:o.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(p(t,{code:o.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(p(t,{code:o.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>a.type._parseAsync(new I(t,e,t.path,r))))).then((e=>m.mergeArray(r,e)));const n=[...t.data].map(((e,r)=>a.type._parseSync(new I(t,e,t.path,r))));return m.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new de({...this._def,minLength:{value:e,message:x.toString(t)}})}max(e,t){return new de({...this._def,maxLength:{value:e,message:x.toString(t)}})}length(e,t){return new de({...this._def,exactLength:{value:e,message:x.toString(t)}})}nonempty(e){return this.min(1,e)}}function he(e){if(e instanceof pe){const t={};for(const r in e.shape){const a=e.shape[r];t[r]=je.create(he(a))}return new pe({...e._def,shape:()=>t})}return e instanceof de?new de({...e._def,type:he(e.element)}):e instanceof je?je.create(he(e.unwrap())):e instanceof Ce?Ce.create(he(e.unwrap())):e instanceof ve?ve.create(e.items.map((e=>he(e)))):e}de.create=(e,t)=>new de({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Be.ZodArray,...P(t)});class pe extends A{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=a.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==i.object){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.object,received:t.parsedType}),f}const{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof ce&&"strip"===this._def.unknownKeys))for(const e in r.data)n.includes(e)||s.push(e);const l=[];for(const e of n){const t=a[e],n=r.data[e];l.push({key:{status:"valid",value:e},value:t._parse(new I(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof ce){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of s)l.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(p(r,{code:o.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of s){const a=r.data[t];l.push({key:{status:"valid",value:t},value:e._parse(new I(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of l){const r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e})).then((e=>m.mergeObjectSync(t,e))):m.mergeObjectSync(t,l)}get shape(){return this._def.shape()}strict(e){return x.errToObj,new pe({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,n,i,s;const o=null!==(i=null===(n=(a=this._def).errorMap)||void 0===n?void 0:n.call(a,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=x.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new pe({...this._def,unknownKeys:"strip"})}passthrough(){return new pe({...this._def,unknownKeys:"passthrough"})}extend(e){return new pe({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new pe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Be.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new pe({...this._def,catchall:e})}pick(e){const t={};return a.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new pe({...this._def,shape:()=>t})}omit(e){const t={};return a.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new pe({...this._def,shape:()=>t})}deepPartial(){return he(this)}partial(e){const t={};return a.objectKeys(this.shape).forEach((r=>{const a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()})),new pe({...this._def,shape:()=>t})}required(e){const t={};return a.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof je;)e=e._def.innerType;t[r]=e}})),new pe({...this._def,shape:()=>t})}keyof(){return Te(a.objectKeys(this.shape))}}pe.create=(e,t)=>new pe({shape:()=>e,unknownKeys:"strip",catchall:ce.create(),typeName:Be.ZodObject,...P(t)}),pe.strictCreate=(e,t)=>new pe({shape:()=>e,unknownKeys:"strict",catchall:ce.create(),typeName:Be.ZodObject,...P(t)}),pe.lazycreate=(e,t)=>new pe({shape:e,unknownKeys:"strip",catchall:ce.create(),typeName:Be.ZodObject,...P(t)});class me extends A{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new l(e.ctx.common.issues)));return p(t,{code:o.invalid_union,unionErrors:r}),f}));{let e;const a=[];for(const n of r){const r={...t,common:{...t.common,issues:[]},parent:null},i=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=a.map((e=>new l(e)));return p(t,{code:o.invalid_union,unionErrors:n}),f}}get options(){return this._def.options}}me.create=(e,t)=>new me({options:e,typeName:Be.ZodUnion,...P(t)});const fe=e=>e instanceof xe?fe(e.schema):e instanceof Ae?fe(e.innerType()):e instanceof ke?[e.value]:e instanceof Ie?e.options:e instanceof Se?a.objectValues(e.enum):e instanceof $e?fe(e._def.innerType):e instanceof ie?[void 0]:e instanceof se?[null]:e instanceof je?[void 0,...fe(e.unwrap())]:e instanceof Ce?[null,...fe(e.unwrap())]:e instanceof Me||e instanceof Fe?fe(e.unwrap()):e instanceof Ne?fe(e._def.innerType):[];class ge extends A{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.object)return p(t,{code:o.invalid_type,expected:i.object,received:t.parsedType}),f;const r=this.discriminator,a=t.data[r],n=this.optionsMap.get(a);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(p(t,{code:o.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),f)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const a=new Map;for(const r of t){const t=fe(r.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const n of t){if(a.has(n))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);a.set(n,r)}}return new ge({typeName:Be.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...P(r)})}}function ye(e,t){const r=s(e),n=s(t);if(e===t)return{valid:!0,data:e};if(r===i.object&&n===i.object){const r=a.objectKeys(t),n=a.objectKeys(e).filter((e=>-1!==r.indexOf(e))),i={...e,...t};for(const r of n){const a=ye(e[r],t[r]);if(!a.valid)return{valid:!1};i[r]=a.data}return{valid:!0,data:i}}if(r===i.array&&n===i.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let a=0;a<e.length;a++){const n=ye(e[a],t[a]);if(!n.valid)return{valid:!1};r.push(n.data)}return{valid:!0,data:r}}return r===i.date&&n===i.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class be extends A{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(b(e)||b(a))return f;const n=ye(e.value,a.value);return n.valid?((v(e)||v(a))&&t.dirty(),{status:t.value,value:n.data}):(p(r,{code:o.invalid_intersection_types}),f)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>a(e,t))):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}be.create=(e,t,r)=>new be({left:e,right:t,typeName:Be.ZodIntersection,...P(r)});class ve extends A{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.array)return p(r,{code:o.invalid_type,expected:i.array,received:r.parsedType}),f;if(r.data.length<this._def.items.length)return p(r,{code:o.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),f;!this._def.rest&&r.data.length>this._def.items.length&&(p(r,{code:o.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...r.data].map(((e,t)=>{const a=this._def.items[t]||this._def.rest;return a?a._parse(new I(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(a).then((e=>m.mergeArray(t,e))):m.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new ve({...this._def,rest:e})}}ve.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ve({items:e,typeName:Be.ZodTuple,rest:null,...P(t)})};class _e extends A{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.object)return p(r,{code:o.invalid_type,expected:i.object,received:r.parsedType}),f;const a=[],n=this._def.keyType,s=this._def.valueType;for(const e in r.data)a.push({key:n._parse(new I(r,e,r.path,e)),value:s._parse(new I(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?m.mergeObjectAsync(t,a):m.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new _e(t instanceof A?{keyType:e,valueType:t,typeName:Be.ZodRecord,...P(r)}:{keyType:X.create(),valueType:e,typeName:Be.ZodRecord,...P(t)})}}class we extends A{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.map)return p(r,{code:o.invalid_type,expected:i.map,received:r.parsedType}),f;const a=this._def.keyType,n=this._def.valueType,s=[...r.data.entries()].map((([e,t],i)=>({key:a._parse(new I(r,e,r.path,[i,"key"])),value:n._parse(new I(r,t,r.path,[i,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of s){const a=await r.key,n=await r.value;if("aborted"===a.status||"aborted"===n.status)return f;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of s){const a=r.key,n=r.value;if("aborted"===a.status||"aborted"===n.status)return f;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}}we.create=(e,t,r)=>new we({valueType:t,keyType:e,typeName:Be.ZodMap,...P(r)});class Ee extends A{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.set)return p(r,{code:o.invalid_type,expected:i.set,received:r.parsedType}),f;const a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(p(r,{code:o.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(p(r,{code:o.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const n=this._def.valueType;function s(e){const r=new Set;for(const a of e){if("aborted"===a.status)return f;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}const l=[...r.data.values()].map(((e,t)=>n._parse(new I(r,e,r.path,t))));return r.common.async?Promise.all(l).then((e=>s(e))):s(l)}min(e,t){return new Ee({...this._def,minSize:{value:e,message:x.toString(t)}})}max(e,t){return new Ee({...this._def,maxSize:{value:e,message:x.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ee.create=(e,t)=>new Ee({valueType:e,minSize:null,maxSize:null,typeName:Be.ZodSet,...P(t)});class Oe extends A{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.function)return p(t,{code:o.invalid_type,expected:i.function,received:t.parsedType}),f;function r(e,r){return h({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,d(),c].filter((e=>!!e)),issueData:{code:o.invalid_arguments,argumentsError:r}})}function a(e,r){return h({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,d(),c].filter((e=>!!e)),issueData:{code:o.invalid_return_type,returnTypeError:r}})}const n={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Pe){const e=this;return y((async function(...t){const i=new l([]),o=await e._def.args.parseAsync(t,n).catch((e=>{throw i.addIssue(r(t,e)),i})),c=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(c,n).catch((e=>{throw i.addIssue(a(c,e)),i}))}))}{const e=this;return y((function(...t){const i=e._def.args.safeParse(t,n);if(!i.success)throw new l([r(t,i.error)]);const o=Reflect.apply(s,this,i.data),c=e._def.returns.safeParse(o,n);if(!c.success)throw new l([a(o,c.error)]);return c.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Oe({...this._def,args:ve.create(e).rest(le.create())})}returns(e){return new Oe({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Oe({args:e||ve.create([]).rest(le.create()),returns:t||le.create(),typeName:Be.ZodFunction,...P(r)})}}class xe extends A{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}xe.create=(e,t)=>new xe({getter:e,typeName:Be.ZodLazy,...P(t)});class ke extends A{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return p(t,{received:t.data,code:o.invalid_literal,expected:this._def.value}),f}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Te(e,t){return new Ie({values:e,typeName:Be.ZodEnum,...P(t)})}ke.create=(e,t)=>new ke({value:e,typeName:Be.ZodLiteral,...P(t)});class Ie extends A{constructor(){super(...arguments),k.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return p(t,{expected:a.joinValues(r),received:t.parsedType,code:o.invalid_type}),f}if(E(this,k,"f")||O(this,k,new Set(this._def.values),"f"),!E(this,k,"f").has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return p(t,{received:t.data,code:o.invalid_enum_value,options:r}),f}return y(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ie.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ie.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}k=new WeakMap,Ie.create=Te;class Se extends A{constructor(){super(...arguments),T.set(this,void 0)}_parse(e){const t=a.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==i.string&&r.parsedType!==i.number){const e=a.objectValues(t);return p(r,{expected:a.joinValues(e),received:r.parsedType,code:o.invalid_type}),f}if(E(this,T,"f")||O(this,T,new Set(a.getValidEnumValues(this._def.values)),"f"),!E(this,T,"f").has(e.data)){const e=a.objectValues(t);return p(r,{received:r.data,code:o.invalid_enum_value,options:e}),f}return y(e.data)}get enum(){return this._def.values}}T=new WeakMap,Se.create=(e,t)=>new Se({values:e,typeName:Be.ZodNativeEnum,...P(t)});class Pe extends A{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.promise&&!1===t.common.async)return p(t,{code:o.invalid_type,expected:i.promise,received:t.parsedType}),f;const r=t.parsedType===i.promise?t.data:Promise.resolve(t.data);return y(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Pe.create=(e,t)=>new Pe({type:e,typeName:Be.ZodPromise,...P(t)});class Ae extends A{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Be.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:e=>{p(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===n.type){const e=n.transform(r.data,i);if(r.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return f;const a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?f:"dirty"===a.status||"dirty"===t.value?g(a.value):a}));{if("aborted"===t.value)return f;const a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?f:"dirty"===a.status||"dirty"===t.value?g(a.value):a}}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?f:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?f:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===n.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!_(e))return e;const a=n.transform(e.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>_(e)?Promise.resolve(n.transform(e.value,i)).then((e=>({status:t.value,value:e}))):e))}a.assertNever(n)}}Ae.create=(e,t,r)=>new Ae({schema:e,typeName:Be.ZodEffects,effect:t,...P(r)}),Ae.createWithPreprocess=(e,t,r)=>new Ae({schema:t,effect:{type:"preprocess",transform:e},typeName:Be.ZodEffects,...P(r)});class je extends A{_parse(e){return this._getType(e)===i.undefined?y(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}je.create=(e,t)=>new je({innerType:e,typeName:Be.ZodOptional,...P(t)});class Ce extends A{_parse(e){return this._getType(e)===i.null?y(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ce.create=(e,t)=>new Ce({innerType:e,typeName:Be.ZodNullable,...P(t)});class $e extends A{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===i.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}$e.create=(e,t)=>new $e({innerType:e,typeName:Be.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...P(t)});class Ne extends A{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return w(a)?a.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new l(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new l(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Ne.create=(e,t)=>new Ne({innerType:e,typeName:Be.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...P(t)});class Re extends A{_parse(e){if(this._getType(e)!==i.nan){const t=this._getOrReturnCtx(e);return p(t,{code:o.invalid_type,expected:i.nan,received:t.parsedType}),f}return{status:"valid",value:e.data}}}Re.create=e=>new Re({typeName:Be.ZodNaN,...P(e)});const Le=Symbol("zod_brand");class Me extends A{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ue extends A{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?f:"dirty"===e.status?(t.dirty(),g(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?f:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new Ue({in:e,out:t,typeName:Be.ZodPipeline})}}class Fe extends A{_parse(e){const t=this._def.innerType._parse(e),r=e=>(_(e)&&(e.value=Object.freeze(e.value)),e);return w(t)?t.then((e=>r(e))):r(t)}unwrap(){return this._def.innerType}}function De(e,t){const r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function Ze(e,t={},r){return e?oe.create().superRefine(((a,n)=>{var i,s;const o=e(a);if(o instanceof Promise)return o.then((e=>{var i,s;if(!e){const e=De(t,a),o=null===(s=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===s||s;n.addIssue({code:"custom",...e,fatal:o})}}));if(!o){const e=De(t,a),o=null===(s=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===s||s;n.addIssue({code:"custom",...e,fatal:o})}})):oe.create()}Fe.create=(e,t)=>new Fe({innerType:e,typeName:Be.ZodReadonly,...P(t)});const ze={object:pe.lazycreate};var Be;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Be||(Be={}));const He=X.create,Ve=ee.create,Ge=Re.create,qe=te.create,Ye=re.create,Je=ae.create,We=ne.create,Ke=ie.create,Xe=se.create,Qe=oe.create,et=le.create,tt=ce.create,rt=ue.create,at=de.create,nt=pe.create,it=pe.strictCreate,st=me.create,ot=ge.create,lt=be.create,ct=ve.create,ut=_e.create,dt=we.create,ht=Ee.create,pt=Oe.create,mt=xe.create,ft=ke.create,gt=Ie.create,yt=Se.create,bt=Pe.create,vt=Ae.create,_t=je.create,wt=Ce.create,Et=Ae.createWithPreprocess,Ot=Ue.create,xt={string:e=>X.create({...e,coerce:!0}),number:e=>ee.create({...e,coerce:!0}),boolean:e=>re.create({...e,coerce:!0}),bigint:e=>te.create({...e,coerce:!0}),date:e=>ae.create({...e,coerce:!0})},kt=f;var Tt=Object.freeze({__proto__:null,defaultErrorMap:c,setErrorMap:function(e){u=e},getErrorMap:d,makeIssue:h,EMPTY_PATH:[],addIssueToContext:p,ParseStatus:m,INVALID:f,DIRTY:g,OK:y,isAborted:b,isDirty:v,isValid:_,isAsync:w,get util(){return a},get objectUtil(){return n},ZodParsedType:i,getParsedType:s,ZodType:A,datetimeRegex:J,ZodString:X,ZodNumber:ee,ZodBigInt:te,ZodBoolean:re,ZodDate:ae,ZodSymbol:ne,ZodUndefined:ie,ZodNull:se,ZodAny:oe,ZodUnknown:le,ZodNever:ce,ZodVoid:ue,ZodArray:de,ZodObject:pe,ZodUnion:me,ZodDiscriminatedUnion:ge,ZodIntersection:be,ZodTuple:ve,ZodRecord:_e,ZodMap:we,ZodSet:Ee,ZodFunction:Oe,ZodLazy:xe,ZodLiteral:ke,ZodEnum:Ie,ZodNativeEnum:Se,ZodPromise:Pe,ZodEffects:Ae,ZodTransformer:Ae,ZodOptional:je,ZodNullable:Ce,ZodDefault:$e,ZodCatch:Ne,ZodNaN:Re,BRAND:Le,ZodBranded:Me,ZodPipeline:Ue,ZodReadonly:Fe,custom:Ze,Schema:A,ZodSchema:A,late:ze,get ZodFirstPartyTypeKind(){return Be},coerce:xt,any:Qe,array:at,bigint:qe,boolean:Ye,date:Je,discriminatedUnion:ot,effect:vt,enum:gt,function:pt,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Ze((t=>t instanceof e),t),intersection:lt,lazy:mt,literal:ft,map:dt,nan:Ge,nativeEnum:yt,never:tt,null:Xe,nullable:wt,number:Ve,object:nt,oboolean:()=>Ye().optional(),onumber:()=>Ve().optional(),optional:_t,ostring:()=>He().optional(),pipeline:Ot,preprocess:Et,promise:bt,record:ut,set:ht,strictObject:it,string:He,symbol:We,transformer:vt,tuple:ct,undefined:Ke,union:st,unknown:et,void:rt,NEVER:kt,ZodIssueCode:o,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:l})},4617:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},4621:(e,t,r)=>{const a=r(4899);e.exports=(e,t,r)=>new a(e,r).compare(new a(t,r))},4774:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(9998);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);const n=a.default(this._queue,r,((e,t)=>t.priority-e.priority));this._queue.splice(n,0,r)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},4785:(e,t,r)=>{"use strict";r.d(t,{Az:()=>d,Ec:()=>c,Jz:()=>h,yk:()=>u});var a=r(6928);let n;const i=()=>"undefined"!=typeof Deno,s=()=>n||(n="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||i()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":i()?"deno":"other":"node",n);let o,l;function c(){if(void 0===o){const e=s(),t=function(){if(void 0!==l)return l;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const r of e){const e=d(r);void 0!==e&&(t[r]=e)}return l=t,t}();o={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:a.Ls,...t}}return o}function u(){const e=function(){try{return"undefined"!=typeof process&&process.env?Object.entries(process.env).reduce(((e,[t,r])=>(e[t]=String(r),e)),{}):void 0}catch(e){return}}()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[a,n]of Object.entries(e))!a.startsWith("LANGCHAIN_")&&!a.startsWith("LANGSMITH_")||"string"!=typeof n||r.includes(a)||a.toLowerCase().includes("key")||a.toLowerCase().includes("secret")||a.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===a?t.revision_id=n:t[a]=n);return t}function d(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function h(e){return d(`LANGSMITH_${e}`)||d(`LANGCHAIN_${e}`)}},4899:(e,t,r)=>{const a=r(6735),{MAX_LENGTH:n,MAX_SAFE_INTEGER:i}=r(6261),{safeRe:s,safeSrc:o,t:l}=r(487),c=r(6588),{compareIdentifiers:u}=r(204);class d{constructor(e,t){if(t=c(t),e instanceof d){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw new TypeError(`version is longer than ${n} characters`);a("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?s[l.LOOSE]:s[l.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<i)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(a("SemVer.compare",this.version,this.options,e),!(e instanceof d)){if("string"==typeof e&&e===this.version)return 0;e=new d(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof d||(e=new d(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof d||(e=new d(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],n=e.prerelease[t];if(a("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return u(r,n)}while(++t)}compareBuild(e){e instanceof d||(e=new d(e,this.options));let t=0;do{const r=this.build[t],n=e.build[t];if(a("build compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return u(r,n)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(t){const e=new RegExp(`^${this.options.loose?o[l.PRERELEASELOOSE]:o[l.PRERELEASE]}$`),r=`-${t}`.match(e);if(!r||r[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let a=this.prerelease.length;for(;--a>=0;)"number"==typeof this.prerelease[a]&&(this.prerelease[a]++,a=-2);if(-1===a){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let a=[t,e];!1===r&&(a=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=d},5056:(e,t,r)=>{"use strict";e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},5072:e=>{"use strict";var t=[];function r(e){for(var r=-1,a=0;a<t.length;a++)if(t[a].identifier===e){r=a;break}return r}function a(e,a){for(var i={},s=[],o=0;o<e.length;o++){var l=e[o],c=a.base?l[0]+a.base:l[0],u=i[c]||0,d="".concat(c," ").concat(u);i[c]=u+1;var h=r(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var m=n(p,a);a.byIndex=o,t.splice(o,0,{identifier:d,updater:m,references:1})}s.push(d)}return s}function n(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,n){var i=a(e=e||[],n=n||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var o=r(i[s]);t[o].references--}for(var l=a(e,n),c=0;c<i.length;c++){var u=r(i[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}i=l}}},5311:(e,t,r)=>{"use strict";r.d(t,{HY:()=>o,aB:()=>l,vX:()=>c});var a=r(8999),n=r(5454),i=r(6362);class s extends a.y{}class o extends s{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new n.xc(this.value)]}}class l extends s{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,i.Sw)(this.messages)}toChatMessages(){return this.messages}}class c extends s{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new n.xc({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}},5454:(e,t,r)=>{"use strict";r.d(t,{a7:()=>i,xc:()=>n});var a=r(3490);class n extends a.XQ{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class i extends a.gj{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new i({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),id:this.id??e.id})}}},5617:(e,t,r)=>{e.exports=r(8303)},5780:(e,t,r)=>{"use strict";r.d(t,{Td:()=>$,tW:()=>N});var a=r(3829),n=r(5960),i=r(4083),s=r(1590);function o(e,t){return`${e.open}${t}${e.close}`}function l(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function c(e){return"string"==typeof e?e.trim():null==e?e:l(e,e.toString())}function u(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:d}=i;class h extends s.J{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const e=this.runMap.get(r.parent_run_id);if(!e)break;t.push(e),r=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,r)=>{const a=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?o(i.bold,a):a})).join(" > ");return o(d.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.green,"[chain/start]")} [${t}] Entering Chain run with input: ${l(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.cyan,"[chain/end]")} [${t}] [${u(e)}] Exiting Chain run with output: ${l(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.red,"[chain/error]")} [${t}] [${u(e)}] Chain run errored with error: ${l(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${o(d.green,"[llm/start]")} [${t}] Entering LLM run with input: ${l(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.cyan,"[llm/end]")} [${t}] [${u(e)}] Exiting LLM run with output: ${l(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.red,"[llm/error]")} [${t}] [${u(e)}] LLM run errored with error: ${l(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.green,"[tool/start]")} [${t}] Entering Tool run with input: "${c(e.inputs.input)}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.cyan,"[tool/end]")} [${t}] [${u(e)}] Exiting Tool run with output: "${c(e.outputs?.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.red,"[tool/error]")} [${t}] [${u(e)}] Tool run errored with error: ${l(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${l(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.cyan,"[retriever/end]")} [${t}] [${u(e)}] Exiting Retriever run with output: ${l(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${o(d.red,"[retriever/error]")} [${t}] [${u(e)}] Retriever run errored with error: ${l(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${o(d.blue,"[agent/action]")} [${r}] Agent selected action: ${l(t.actions[t.actions.length-1],"[action]")}`)}}var p=r(6362),m=r(9583),f=r(3246),g=r(3389),y=r(1259);let b;const v=()=>{if(void 0===b){const e="false"===(0,m.Az)("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{};b=new y.Kj(e)}return b};class _ extends s.J{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:a}=e;this.projectName=r??(0,m.Az)("LANGCHAIN_PROJECT")??(0,m.Az)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??v();const n=_.getTraceableRunTree();n&&this.updateFromRunTree(n)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await(0,m.Ec)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!r.has(t.id)&&(r.add(t.id),t.parent_run);)t=t.parent_run;r.clear();const a=[t];for(;a.length>0;){const e=a.shift();e&&!r.has(e.id)&&(r.add(e.id),this.runMap.set(e.id,e),e.child_runs&&a.push(...e.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},r=[];for(const[e,a]of this.runMap){const n=new f.gk({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[e]=n,r.push([e,a.dotted_order])}r.sort(((e,t)=>e[1]&&t[1]?e[1].localeCompare(t[1]):0));for(const[e]of r){const r=this.runMap.get(e),a=t[e];if(r&&a&&r.parent_run_id){const e=t[r.parent_run_id];e&&(e.child_runs.push(a),a.parent_run=e)}}return t[e]}static getTraceableRunTree(){try{return(0,g.vR)()}catch{return}}}var w=r(3290),E=r(6968);let O;async function x(e,t){if(!0===t){const t=(0,E.X0)();void 0!==t?await t.run(void 0,(async()=>e())):await e()}else void 0===O&&(O=new(0,w.default)({autoStart:!0,concurrency:1})),O.add((async()=>{const t=(0,E.X0)();void 0!==t?await t.run(void 0,(async()=>e())):await e()}))}function k(e){const t=(0,E.X0)();if(void 0===t)return;const r=t.getStore();return r?.[E.hr]?.[e]}const T=Symbol("lc:configure_hooks");class I{setHandler(e){return this.setHandlers([e])}}class S{constructor(e,t,r,a,n,i,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map((t=>x((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleCustomEvent(e,t,r,a,n){await Promise.all(this.handlers.map((r=>x((async()=>{try{await(r.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata))}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}}),r.awaitHandlers))))}}class P extends S{getChild(e){const t=new $(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}}),t.awaitHandlers))))}}class A extends S{async handleLLMNewToken(e,t,r,a,n,i){await Promise.all(this.handlers.map((r=>x((async()=>{if(!r.ignoreLLM)try{await(r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`),r.raiseError)throw e}}),r.awaitHandlers))))}async handleLLMError(e,t,r,a,n){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleLLMEnd(e,t,r,a,n){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}}class j extends S{getChild(e){const t=new $(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,n){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleChainEnd(e,t,r,a,n){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}}class C extends S{getChild(e){const t=new $(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>x((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}}class $ extends I{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,n=void 0,i=void 0,o=void 0,l=void 0,c=void 0){return Promise.all(t.map((async(t,n)=>{const o=0===n&&r?r:(0,a.A)();return await Promise.all(this.handlers.map((r=>{if(!r.ignoreLLM)return(0,s.j)(r)&&r._createRunForLLMStart(e,[t],o,this._parentRunId,i,this.tags,this.metadata,c),x((async()=>{try{await(r.handleLLMStart?.(e,[t],o,this._parentRunId,i,this.tags,this.metadata,c))}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}}),r.awaitHandlers)}))),new A(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,r=void 0,n=void 0,i=void 0,o=void 0,l=void 0,c=void 0){return Promise.all(t.map((async(t,n)=>{const o=0===n&&r?r:(0,a.A)();return await Promise.all(this.handlers.map((r=>{if(!r.ignoreLLM)return(0,s.j)(r)&&r._createRunForChatModelStart(e,[t],o,this._parentRunId,i,this.tags,this.metadata,c),x((async()=>{try{if(r.handleChatModelStart)await(r.handleChatModelStart?.(e,[t],o,this._parentRunId,i,this.tags,this.metadata,c));else if(r.handleLLMStart){const a=(0,p.Sw)(t);await(r.handleLLMStart?.(e,[a],o,this._parentRunId,i,this.tags,this.metadata,c))}}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}}),r.awaitHandlers)}))),new A(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,r=(0,a.A)(),n=void 0,i=void 0,o=void 0,l=void 0){return await Promise.all(this.handlers.map((a=>{if(!a.ignoreChain)return(0,s.j)(a)&&a._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,n,l),x((async()=>{try{await(a.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,n,l))}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainStart: ${e}`),a.raiseError)throw e}}),a.awaitHandlers)}))),new j(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,a.A)(),n=void 0,i=void 0,o=void 0,l=void 0){return await Promise.all(this.handlers.map((a=>{if(!a.ignoreAgent)return(0,s.j)(a)&&a._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,l),x((async()=>{try{await(a.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,l))}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleToolStart: ${e}`),a.raiseError)throw e}}),a.awaitHandlers)}))),new C(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,a.A)(),n=void 0,i=void 0,o=void 0,l=void 0){return await Promise.all(this.handlers.map((a=>{if(!a.ignoreRetriever)return(0,s.j)(a)&&a._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,l),x((async()=>{try{await(a.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,l))}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${e}`),a.raiseError)throw e}}),a.awaitHandlers)}))),new P(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,a,n){await Promise.all(this.handlers.map((a=>x((async()=>{if(!a.ignoreCustomEvent)try{await(a.handleCustomEvent?.(e,t,r,this.tags,this.metadata))}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${e}`),a.raiseError)throw e}}),a.awaitHandlers))))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new $(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);r.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(const a of e)r.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===a.name))||r.addHandler(a,t);return r}static fromHandlers(e){class t extends n.NK{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,a.A)()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static configure(e,t,r,a,n,i,s){return this._configureSync(e,t,r,a,n,i,s)}static _configureSync(e,t,r,a,i,s,o){let l;(e||t)&&(Array.isArray(e)||!e?(l=new $,l.setHandlers(e?.map(N)??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(N):t?.handlers,!1));const c="true"===(0,m.Az)("LANGCHAIN_VERBOSE")||o?.verbose,u=_.getTraceableRunTree()?.tracingEnabled||!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find((e=>"true"===(0,m.Az)(e))),d=u||((0,m.Az)("LANGCHAIN_TRACING")??!1);if(c||d){if(l||(l=new $),c&&!l.handlers.some((e=>e.name===h.prototype.name))){const e=new h;l.addHandler(e,!0)}if(d&&!l.handlers.some((e=>"langchain_tracer"===e.name))&&u){const e=new _;l.addHandler(e,!0),l._parentRunId=_.getTraceableRunTree()?.id??l._parentRunId}}for(const{contextVar:e,inheritable:t=!0,handlerClass:r,envVar:a}of k(T)||[]){const i=a&&"true"===(0,m.Az)(a)&&r;let s;const o=void 0!==e?k(e):void 0;o&&(0,n.zr)(o)?s=o:i&&(s=new r({})),void 0!==s&&(l||(l=new $),l.handlers.some((e=>e.name===s.name))||l.addHandler(s,t))}return(r||a)&&l&&(l.addTags(r??[]),l.addTags(a??[],!1)),(i||s)&&l&&(l.addMetadata(i??{}),l.addMetadata(s??{},!1)),l}}function N(e){return"name"in e?e:n.NK.fromMethods(e)}},5960:(e,t,r)=>{"use strict";r.d(t,{NK:()=>l,xL:()=>o,zr:()=>c});var a=r(3829),n=r(8999),i=r(9583);class s{}function o(e){return"lc_prefer_streaming"in e&&e.lc_prefer_streaming}class l extends s{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,n.Z)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"false"===(0,i.Az)("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return n.y.prototype.toJSON.call(this)}toJSONNotImplemented(){return n.y.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends l{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:a.A()}),Object.assign(this,e)}}}}const c=e=>{const t=e;return void 0!==t&&"function"==typeof t.copy&&"string"==typeof t.name&&"boolean"==typeof t.awaitHandlers}},5985:(e,t,r)=>{const a=r(4899),n=r(9558);e.exports=(e,t,r)=>{let i=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(i&&-1!==s.compare(e)||(i=e,s=new a(i,r)))})),i}},6133:(e,t,r)=>{const a=r(4621);e.exports=(e,t,r)=>a(e,t,r)<=0},6150:(e,t,r)=>{"use strict";r.d(t,{X6:()=>v,UD:()=>k});var a={};r.r(a),r.d(a,{JsonPatchError:()=>p,_areEquals:()=>O,applyOperation:()=>b,applyPatch:()=>v,applyReducer:()=>_,deepClone:()=>m,getValueByPointer:()=>y,validate:()=>E,validator:()=>w});const n=Object.prototype.hasOwnProperty;function i(e,t){return n.call(e,t)}function s(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)i(e,r)&&t.push(r);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t=0;const r=e.length;let a;for(;t<r;){if(a=e.charCodeAt(t),!(a>=48&&a<=57))return!1;t++}return!0}function c(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function u(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(u(e[t]))return!0}else if("object"==typeof e){const r=s(e),a=r.length;for(var t=0;t<a;t++)if(u(e[r[t]]))return!0}return!1}function d(e,t){const r=[e];for(const e in t){const a="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==a&&r.push(`${e}: ${a}`)}return r.join("\n")}class h extends Error{constructor(e,t,r,a,n){super(d(e,{name:t,index:r,operation:a,tree:n})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.setPrototypeOf(this,new.target.prototype),this.message=d(e,{name:t,index:r,operation:a,tree:n})}}const p=h,m=o,f={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){let a=y(r,this.path);a&&(a=o(a));const n=b(r,{op:"remove",path:this.from}).removed;return b(r,{op:"add",path:this.path,value:n}),{newDocument:r,removed:a}},copy:function(e,t,r){const a=y(r,this.from);return b(r,{op:"add",path:this.path,value:o(a)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:O(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var g={add:function(e,t,r){return l(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:f.move,copy:f.copy,test:f.test,_get:f._get};function y(e,t){if(""==t)return e;var r={op:"_get",path:t};return b(e,r),r.value}function b(e,t,r=!1,a=!0,n=!0,i=0){if(r&&("function"==typeof r?r(t,0,e,t.path):w(t,0)),""===t.path){let a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=y(e,t.from),"move"===t.op&&(a.removed=e),a;if("test"===t.op){if(a.test=O(e,t.value),!1===a.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return a.newDocument=e,a}if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(r)throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e);return a}{a||(e=o(e));const s=(t.path||"").split("/");let c,u,d,h=e,m=1,y=s.length;for(d="function"==typeof r?r:w;;){if(u=s[m],u&&-1!=u.indexOf("~")&&(u=u.replace(/~1/g,"/").replace(/~0/g,"~")),n&&("__proto__"==u||"prototype"==u&&m>0&&"constructor"==s[m-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===c&&(void 0===h[u]?c=s.slice(0,m).join("/"):m==y-1&&(c=t.path),void 0!==c&&d(t,0,e,c)),m++,Array.isArray(h)){if("-"===u)u=h.length;else{if(r&&!l(u))throw new p("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);l(u)&&(u=~~u)}if(m>=y){if(r&&"add"===t.op&&u>h.length)throw new p("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);const a=g[t.op].call(t,h,u,e);if(!1===a.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return a}}else if(m>=y){const r=f[t.op].call(t,h,u,e);if(!1===r.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return r}if(h=h[u],r&&m<y&&(!h||"object"!=typeof h))throw new p("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,e)}}}function v(e,t,r,a=!0,n=!0){if(r&&!Array.isArray(t))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=o(e));const i=new Array(t.length);for(let a=0,s=t.length;a<s;a++)i[a]=b(e,t[a],r,!0,n,a),e=i[a].newDocument;return i.newDocument=e,i}function _(e,t,r){const a=b(e,t);if(!1===a.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return a.newDocument}function w(e,t,r,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new p("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(!f[e.op])throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r);if("string"!=typeof e.path)throw new p("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new p('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new p("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&u(e.value))throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r)if("add"==e.op){var n=e.path.split("/").length,i=a.split("/").length;if(n!==i+1&&n!==i)throw new p("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new p("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var s=E([{op:"_get",path:e.from,value:void 0}],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new p("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}function E(e,t,r){try{if(!Array.isArray(e))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)v(o(t),o(e),r||!0);else{r=r||w;for(var a=0;a<e.length;a++)r(e[a],a,t,void 0)}}catch(e){if(e instanceof p)return e;throw e}}function O(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,n,i=Array.isArray(e),s=Array.isArray(t);if(i&&s){if((a=e.length)!=t.length)return!1;for(r=a;0!=r--;)if(!O(e[r],t[r]))return!1;return!0}if(i!=s)return!1;var o=Object.keys(e);if((a=o.length)!==Object.keys(t).length)return!1;for(r=a;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=a;0!=r--;)if(!O(e[n=o[r]],t[n]))return!1;return!0}return e!=e&&t!=t}function x(e,t,r,a,n){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var l=s(t),u=s(e),d=!1,h=u.length-1;h>=0;h--){var p=e[f=u[h]];if(!i(t,f)||void 0===t[f]&&void 0!==p&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(n&&r.push({op:"test",path:a+"/"+c(f),value:o(p)}),r.push({op:"remove",path:a+"/"+c(f)}),d=!0):(n&&r.push({op:"test",path:a,value:e}),r.push({op:"replace",path:a,value:t}));else{var m=t[f];"object"==typeof p&&null!=p&&"object"==typeof m&&null!=m&&Array.isArray(p)===Array.isArray(m)?x(p,m,r,a+"/"+c(f),n):p!==m&&(n&&r.push({op:"test",path:a+"/"+c(f),value:o(p)}),r.push({op:"replace",path:a+"/"+c(f),value:o(m)}))}}if(d||l.length!=u.length)for(h=0;h<l.length;h++){var f;i(e,f=l[h])||void 0===t[f]||r.push({op:"add",path:a+"/"+c(f),value:o(t[f])})}}}function k(e,t,r=!1){var a=[];return x(e,t,a,"",r),a}new WeakMap},6232:(e,t,r)=>{"use strict";r.d(t,{m:()=>n});const a={};function n(e){a[e]||(console.warn(e),a[e]=!0)}},6261:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},6279:(e,t,r)=>{"use strict";r.d(t,{C:()=>s});var a=r(5311),n=r(6993),i=r(9849);class s extends n.m{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,i.Ns)([{type:"image_url",image_url:this.template}],this.templateFormat,e)}}_getPromptType(){return"prompt"}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new s(a)}async format(e){const t={};for(const[r,a]of Object.entries(this.template))t[r]="string"==typeof a?(0,i.Xm)(a,this.templateFormat,e):a;const r=e.url||t.url,a=e.detail||t.detail;if(!r)throw new Error("Must provide either an image URL.");if("string"!=typeof r)throw new Error("url must be a string.");const n={url:r};return a&&(n.detail=a),n}async formatPromptValue(e){const t=await this.format(e);return new a.vX(t)}}},6314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",a=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),a&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),a&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,a,n,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(a)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);a&&s[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),r&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=r):u[2]=r),n&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=n):u[4]="".concat(n)),t.push(u))}},t}},6362:(e,t,r)=>{"use strict";r.d(t,{K0:()=>m,Sw:()=>f,ih:()=>g});var a=r(1368),n=r(199),i=r(7765),s=r(3490),o=r(4301),l=r(8675),c=r(5454),u=r(7974),d=r(8009);function h(e){return(0,n.K)(e)?e:"string"==typeof e.id&&"function"===e.type&&"object"==typeof e.function&&null!==e.function&&"arguments"in e.function&&"string"==typeof e.function.arguments&&"name"in e.function&&"string"==typeof e.function.name?{id:e.id,args:JSON.parse(e.function.arguments),name:e.function.name,type:"tool_call"}:e}function p(e){let t,r;if("object"==typeof(n=e)&&null!=n&&1===n.lc&&Array.isArray(n.id)&&null!=n.kwargs&&"object"==typeof n.kwargs){const a=e.id.at(-1);t="HumanMessage"===a||"HumanMessageChunk"===a?"user":"AIMessage"===a||"AIMessageChunk"===a?"assistant":"SystemMessage"===a||"SystemMessageChunk"===a?"system":"FunctionMessage"===a||"FunctionMessageChunk"===a?"function":"ToolMessage"===a||"ToolMessageChunk"===a?"tool":"unknown",r=e.kwargs}else{const{type:a,...n}=e;t=a,r=n}var n;if("human"===t||"user"===t)return new c.xc(r);if("ai"===t||"assistant"===t){const{tool_calls:e,...t}=r;if(!Array.isArray(e))return new i.Od(r);const a=e.map(h);return new i.Od({...t,tool_calls:a})}if("system"===t)return new u.tn(r);if("developer"===t)return new u.tn({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if("tool"===t&&"tool_call_id"in r)return new d.uf({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});throw(0,a.Y)(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.\n\nReceived: ${JSON.stringify(e,null,2)}`),"MESSAGE_COERCION_FAILURE")}function m(e){if("string"==typeof e)return new c.xc(e);if((0,s.ny)(e))return e;if(Array.isArray(e)){const[t,r]=e;return p({type:t,content:r})}if((0,s.dp)(e)){const{role:t,...r}=e;return p({...r,type:t})}return p(e)}function f(e,t="Human",r="AI"){const a=[];for(const n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=r;else if("system"===n._getType())e="System";else if("function"===n._getType())e="Function";else if("tool"===n._getType())e="Tool";else{if("generic"!==n._getType())throw new Error(`Got unsupported message type: ${n._getType()}`);e=n.role}const i=n.name?`${n.name}, `:"",s="string"==typeof n.content?n.content:JSON.stringify(n.content,null,2);a.push(`${e}: ${i}${s}`)}return a.join("\n")}function g(e){const t=e._getType();if("human"===t)return new c.a7({...e});if("ai"===t){let t={...e};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map((e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)})))}),new i.H({...t})}if("system"===t)return new u.uU({...e});if("function"===t)return new l.FK({...e});if(o.cM.isInstance(e))return new o.XU({...e});throw new Error("Unknown message type.")}},6588:e=>{const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},6592:(e,t,r)=>{const a=r(4899),n=r(6635),{ANY:i}=n,s=r(9558),o=r(995),l=r(2559),c=r(4056),u=r(6133),d=r(7372);e.exports=(e,t,r,h)=>{let p,m,f,g,y;switch(e=new a(e,h),t=new s(t,h),r){case">":p=l,m=u,f=c,g=">",y=">=";break;case"<":p=c,m=d,f=l,g="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let r=0;r<t.set.length;++r){const a=t.set[r];let s=null,o=null;if(a.forEach((e=>{e.semver===i&&(e=new n(">=0.0.0")),s=s||e,o=o||e,p(e.semver,s.semver,h)?s=e:f(e.semver,o.semver,h)&&(o=e)})),s.operator===g||s.operator===y)return!1;if((!o.operator||o.operator===g)&&m(e,o.semver))return!1;if(o.operator===y&&f(e,o.semver))return!1}return!0}},6635:(e,t,r)=>{const a=Symbol("SemVer ANY");class n{static get ANY(){return a}constructor(e,t){if(t=i(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===a?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new u(r[2],this.options.loose):this.semver=a}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===a||e===a)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=i(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=n;const i=r(6588),{safeRe:s,t:o}=r(487),l=r(1534),c=r(6735),u=r(4899),d=r(9558)},6641:(e,t,r)=>{"use strict";const a=r(4617);class n extends Error{constructor(e){super(e),this.name="TimeoutError"}}const i=(e,t,r)=>new Promise(((i,s)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void i(e);const o=setTimeout((()=>{if("function"==typeof r){try{i(r())}catch(e){s(e)}return}const a=r instanceof Error?r:new n("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),s(a)}),t);a(e.then(i,s),(()=>{clearTimeout(o)}))}));e.exports=i,e.exports.default=i,e.exports.TimeoutError=n},6735:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},6856:(e,t,r)=>{const a=r(8136);e.exports=(e,t)=>e.sort(((e,r)=>a(e,r,t)))},6928:(e,t,r)=>{"use strict";r.d(t,{Kj:()=>a.Kj,Ls:()=>i,gk:()=>n.gk});var a=r(2738),n=r(3246);r(747);const i="0.3.11"},6945:(e,t,r)=>{const a=r(4899),n=r(7737),{safeRe:i,t:s}=r(487);e.exports=(e,t)=>{if(e instanceof a)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const a=t.includePrerelease?i[s.COERCERTLFULL]:i[s.COERCERTL];let n;for(;(n=a.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&n.index+n[0].length===r.index+r[0].length||(r=n),a.lastIndex=n.index+n[1].length+n[2].length;a.lastIndex=-1}else r=e.match(t.includePrerelease?i[s.COERCEFULL]:i[s.COERCE]);if(null===r)return null;const o=r[2],l=r[3]||"0",c=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return n(`${o}.${l}.${c}${u}${d}`,t)}},6968:(e,t,r)=>{"use strict";r.d(t,{X0:()=>s,hr:()=>n,pH:()=>i});const a=Symbol.for("ls:tracing_async_local_storage"),n=Symbol.for("lc:context_variables"),i=e=>{globalThis[a]=e},s=()=>globalThis[a]},6993:(e,t,r)=>{"use strict";r.d(t,{m:()=>n});var a=r(3230);class n extends a.YN{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[e,a]of Object.entries(t))r[e]="string"==typeof a?a:await a();return{...r,...e}}async invoke(e,t){const r={...this.metadata,...t?.metadata},a=[...this.tags??[],...t?.tags??[]];return this._callWithConfig((e=>this.formatPromptValue(e)),e,{...t,tags:a,metadata:r,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,3650));return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,3650));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(r.bind(r,2771));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}},7119:(e,t,r)=>{const a=r(7737);e.exports=(e,t)=>{const r=a(e,null,!0),n=a(t,null,!0),i=r.compare(n);if(0===i)return null;const s=i>0,o=s?r:n,l=s?n:r,c=!!o.prerelease.length;if(l.prerelease.length&&!c){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}const u=c?"pre":"";return r.major!==n.major?u+"major":r.minor!==n.minor?u+"minor":r.patch!==n.patch?u+"patch":"prerelease"}},7280:(e,t,r)=>{const a=r(487),n=r(6261),i=r(4899),s=r(204),o=r(7737),l=r(4004),c=r(9855),u=r(4106),d=r(7119),h=r(3767),p=r(547),m=r(9196),f=r(3690),g=r(4621),y=r(2469),b=r(3042),v=r(8136),_=r(6856),w=r(9056),E=r(2559),O=r(4056),x=r(818),k=r(9606),T=r(7372),I=r(6133),S=r(1534),P=r(6945),A=r(6635),j=r(9558),C=r(995),$=r(534),N=r(5985),R=r(9499),L=r(3602),M=r(2153),U=r(6592),F=r(4076),D=r(4453),Z=r(753),z=r(1620),B=r(9881);e.exports={parse:o,valid:l,clean:c,inc:u,diff:d,major:h,minor:p,patch:m,prerelease:f,compare:g,rcompare:y,compareLoose:b,compareBuild:v,sort:_,rsort:w,gt:E,lt:O,eq:x,neq:k,gte:T,lte:I,cmp:S,coerce:P,Comparator:A,Range:j,satisfies:C,toComparators:$,maxSatisfying:N,minSatisfying:R,minVersion:L,validRange:M,outside:U,gtr:F,ltr:D,intersects:Z,simplifyRange:z,subset:B,SemVer:i,re:a.re,src:a.src,tokens:a.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},7372:(e,t,r)=>{const a=r(4621);e.exports=(e,t,r)=>a(e,t,r)>=0},7526:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),r=t[0],a=t[1];return 3*(r+a)/4-a},t.toByteArray=function(e){var t,r,i=o(e),s=i[0],l=i[1],c=new n(function(e,t,r){return 3*(t+r)/4-r}(0,s,l)),u=0,d=l>0?s-4:s;for(r=0;r<d;r+=4)t=a[e.charCodeAt(r)]<<18|a[e.charCodeAt(r+1)]<<12|a[e.charCodeAt(r+2)]<<6|a[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===l&&(t=a[e.charCodeAt(r)]<<2|a[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===l&&(t=a[e.charCodeAt(r)]<<10|a[e.charCodeAt(r+1)]<<4|a[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,a=e.length,n=a%3,i=[],s=16383,o=0,c=a-n;o<c;o+=s)i.push(l(e,o,o+s>c?c:o+s));return 1===n?(t=e[a-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===n&&(t=(e[a-2]<<8)+e[a-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),i.join("")};for(var r=[],a=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)r[s]=i[s],a[i.charCodeAt(s)]=s;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,a){for(var n,i,s=[],o=t;o<a;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(r[(i=n)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},7659:e=>{"use strict";var t={};e.exports=function(e,r){var a=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(r)}},7737:(e,t,r)=>{const a=r(4899);e.exports=(e,t,r=!1)=>{if(e instanceof a)return e;try{return new a(e,t)}catch(e){if(!r)return null;throw e}}},7765:(e,t,r)=>{"use strict";r.d(t,{H:()=>c,KX:()=>o,Od:()=>s,jm:()=>l});var a=r(780),n=r(3490),i=r(8009);class s extends n.XQ{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if("string"==typeof e)r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const t=r.additional_kwargs?.tool_calls,a=r.tool_calls;null!=t&&t.length>0&&(void 0===a||0===a.length)&&console.warn(["New LangChain packages are available that more efficiently handle","tool calling.\n\nPlease upgrade your packages to versions that set","message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(null!=t&&void 0===a){const[e,a]=(0,i.p1)(t);r.tool_calls=e??[],r.invalid_tool_calls=a??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch(e){r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"string"!=typeof r&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function o(e){return"ai"===e._getType()}function l(e){return"ai"===e._getType()}class c extends n.gj{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0};else{const r=[],n=[];for(const t of e.tool_call_chunks){let e={};try{if(e=(0,a.d)(t.args||"{}"),null===e||"object"!=typeof e||Array.isArray(e))throw new Error("Malformed tool call chunk args.");r.push({name:t.name??"",args:e,id:t.id,type:"tool_call"})}catch(e){n.push({name:t.name,args:t.args,id:t.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:n,usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const t={content:(0,n._I)(this.content,e.content),additional_kwargs:(0,n.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,n.ns)(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){const r=(0,n.Vt)(this.tool_call_chunks,e.tool_call_chunks);void 0!==r&&r.length>0&&(t.tool_call_chunks=r)}if(void 0!==this.usage_metadata||void 0!==e.usage_metadata){const r={...(void 0!==this.usage_metadata?.input_token_details?.audio||void 0!==e.usage_metadata?.input_token_details?.audio)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(void 0!==this.usage_metadata?.input_token_details?.cache_read||void 0!==e.usage_metadata?.input_token_details?.cache_read)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(void 0!==this.usage_metadata?.input_token_details?.cache_creation||void 0!==e.usage_metadata?.input_token_details?.cache_creation)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},a={...(void 0!==this.usage_metadata?.output_token_details?.audio||void 0!==e.usage_metadata?.output_token_details?.audio)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(void 0!==this.usage_metadata?.output_token_details?.reasoning||void 0!==e.usage_metadata?.output_token_details?.reasoning)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},n=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s={input_tokens:n.input_tokens+i.input_tokens,output_tokens:n.output_tokens+i.output_tokens,total_tokens:n.total_tokens+i.total_tokens,...Object.keys(r).length>0&&{input_token_details:r},...Object.keys(a).length>0&&{output_token_details:a}};t.usage_metadata=s}return new c(t)}}},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var a="";r.supports&&(a+="@supports (".concat(r.supports,") {")),r.media&&(a+="@media ".concat(r.media," {"));var n=void 0!==r.layer;n&&(a+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),a+=r.css,n&&(a+="}"),r.media&&(a+="}"),r.supports&&(a+="}");var i=r.sourceMap;i&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},7974:(e,t,r)=>{"use strict";r.d(t,{tn:()=>n,uU:()=>i});var a=r(3490);class n extends a.XQ{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class i extends a.gj{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new i({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),id:this.id??e.id})}}},8009:(e,t,r)=>{"use strict";r.d(t,{dr:()=>i,p1:()=>s,uf:()=>n});var a=r(3490);class n extends a.XQ{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){"string"==typeof e&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return"tool"===e._getType()}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class i extends a.gj{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new i({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),artifact:(0,a.F7)(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:(0,a.Iv)(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function s(e){const t=[],r=[];for(const a of e)if(a.function){const e=a.function.name;try{const r={name:e||"",args:JSON.parse(a.function.arguments)||{},id:a.id};t.push(r)}catch(t){r.push({name:e,args:a.function.arguments,id:a.id,error:"Malformed args."})}}return[t,r]}},8028:(e,t,r)=>{"use strict";r.d(t,{Cf:()=>i,SP:()=>a,mu:()=>n});const a="__run";class n{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class i extends n{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new i({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}},8136:(e,t,r)=>{const a=r(4899);e.exports=(e,t,r)=>{const n=new a(e,r),i=new a(t,r);return n.compare(i)||n.compareBuild(i)}},8227:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,n=function(e){return"string"==typeof e&&a.test(e)}},8303:(e,t,r)=>{var a=r(3961);t.operation=function(e){var r=t.timeouts(e);return new a(r,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],n=0;n<t.retries;n++)a.push(this.createTimeout(n,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(n,t)),a.sort((function(e,t){return e-t})),a},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,a=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(a,t.maxTimeout)},t.wrap=function(e,r,a){if(r instanceof Array&&(a=r,r=null),!a)for(var n in a=[],e)"function"==typeof e[n]&&a.push(n);for(var i=0;i<a.length;i++){var s=a[i],o=e[s];e[s]=function(a){var n=t.operation(r),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push((function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))})),n.attempt((function(){a.apply(e,i)}))}.bind(e,o),e[s].options=r}}},8675:(e,t,r)=>{"use strict";r.d(t,{FK:()=>i,mg:()=>n});var a=r(3490);class n extends a.XQ{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class i extends a.gj{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new i({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}},8999:(e,t,r)=>{"use strict";r.d(t,{y:()=>c,Z:()=>l});var a=r(9478);function n(e,t){return t?.[e]||a(e)}function i(e,t,r){const a={};for(const n in e)Object.hasOwn(e,n)&&(a[t(n,r)]=e[n]);return a}function s(e){return Array.isArray(e)?[...e]:{...e}}function o(e,t){const r=s(e);for(const[e,a]of Object.entries(t)){const[t,...n]=e.split(".").reverse();let i=r;for(const e of n.reverse()){if(void 0===i[e])break;i[e]=s(i[e]),i=i[e]}void 0!==i[t]&&(i[t]={lc:1,type:"secret",id:[a]})}return r}function l(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}r(2729);class c{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,l(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter((([e])=>this.lc_serializable_keys?.includes(e)))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof c||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,a=r;const[n,...i]=e.split(".").reverse();for(const e of i.reverse()){if(!(e in t)||void 0===t[e])return;e in a&&void 0!==a[e]||("object"==typeof t[e]&&null!=t[e]?a[e]={}:Array.isArray(t[e])&&(a[e]=[])),t=t[e],a=a[e]}n in t&&void 0!==t[n]&&(a[n]=a[n]||t[n])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:i(Object.keys(t).length?o(r,t):r,n,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},9056:(e,t,r)=>{const a=r(8136);e.exports=(e,t)=>e.sort(((e,r)=>a(r,e,t)))},9196:(e,t,r)=>{const a=r(4899);e.exports=(e,t)=>new a(e,t).patch},9478:e=>{"use strict";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},9499:(e,t,r)=>{const a=r(4899),n=r(9558);e.exports=(e,t,r)=>{let i=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(i&&1!==s.compare(e)||(i=e,s=new a(i,r)))})),i}},9558:(e,t,r)=>{const a=/\s+/g;class n{constructor(e,t){if(t=s(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(a," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!y(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&b(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&f)|(this.options.loose&&g))+":"+e,r=i.get(t);if(r)return r;const a=this.options.loose,n=a?u[d.HYPHENRANGELOOSE]:u[d.HYPHENRANGE];e=e.replace(n,A(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(u[d.COMPARATORTRIM],h),l("comparator trim",e),e=e.replace(u[d.TILDETRIM],p),l("tilde trim",e),e=e.replace(u[d.CARETTRIM],m),l("caret trim",e);let s=e.split(" ").map((e=>_(e,this.options))).join(" ").split(/\s+/).map((e=>P(e,this.options)));a&&(s=s.filter((e=>(l("loose invalid filter",e,this.options),!!e.match(u[d.COMPARATORLOOSE]))))),l("range list",s);const c=new Map,b=s.map((e=>new o(e,this.options)));for(const e of b){if(y(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");const v=[...c.values()];return i.set(t,v),v}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some((r=>v(r,t)&&e.set.some((e=>v(e,t)&&r.every((r=>e.every((e=>r.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(j(this.set[t],e,this.options))return!0;return!1}}e.exports=n;const i=new(r(639)),s=r(6588),o=r(6635),l=r(6735),c=r(4899),{safeRe:u,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:m}=r(487),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:g}=r(6261),y=e=>"<0.0.0-0"===e.value,b=e=>""===e.value,v=(e,t)=>{let r=!0;const a=e.slice();let n=a.pop();for(;r&&a.length;)r=a.every((e=>n.intersects(e,t))),n=a.pop();return r},_=(e,t)=>(l("comp",e,t),e=x(e,t),l("caret",e),e=E(e,t),l("tildes",e),e=T(e,t),l("xrange",e),e=S(e,t),l("stars",e),e),w=e=>!e||"x"===e.toLowerCase()||"*"===e,E=(e,t)=>e.trim().split(/\s+/).map((e=>O(e,t))).join(" "),O=(e,t)=>{const r=t.loose?u[d.TILDELOOSE]:u[d.TILDE];return e.replace(r,((t,r,a,n,i)=>{let s;return l("tilde",e,t,r,a,n,i),w(r)?s="":w(a)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:w(n)?s=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:i?(l("replaceTilde pr",i),s=`>=${r}.${a}.${n}-${i} <${r}.${+a+1}.0-0`):s=`>=${r}.${a}.${n} <${r}.${+a+1}.0-0`,l("tilde return",s),s}))},x=(e,t)=>e.trim().split(/\s+/).map((e=>k(e,t))).join(" "),k=(e,t)=>{l("caret",e,t);const r=t.loose?u[d.CARETLOOSE]:u[d.CARET],a=t.includePrerelease?"-0":"";return e.replace(r,((t,r,n,i,s)=>{let o;return l("caret",e,t,r,n,i,s),w(r)?o="":w(n)?o=`>=${r}.0.0${a} <${+r+1}.0.0-0`:w(i)?o="0"===r?`>=${r}.${n}.0${a} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${a} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),o="0"===r?"0"===n?`>=${r}.${n}.${i}-${s} <${r}.${n}.${+i+1}-0`:`>=${r}.${n}.${i}-${s} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${i}-${s} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===n?`>=${r}.${n}.${i}${a} <${r}.${n}.${+i+1}-0`:`>=${r}.${n}.${i}${a} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${i} <${+r+1}.0.0-0`),l("caret return",o),o}))},T=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>I(e,t))).join(" ")),I=(e,t)=>{e=e.trim();const r=t.loose?u[d.XRANGELOOSE]:u[d.XRANGE];return e.replace(r,((r,a,n,i,s,o)=>{l("xRange",e,r,a,n,i,s,o);const c=w(n),u=c||w(i),d=u||w(s),h=d;return"="===a&&h&&(a=""),o=t.includePrerelease?"-0":"",c?r=">"===a||"<"===a?"<0.0.0-0":"*":a&&h?(u&&(i=0),s=0,">"===a?(a=">=",u?(n=+n+1,i=0,s=0):(i=+i+1,s=0)):"<="===a&&(a="<",u?n=+n+1:i=+i+1),"<"===a&&(o="-0"),r=`${a+n}.${i}.${s}${o}`):u?r=`>=${n}.0.0${o} <${+n+1}.0.0-0`:d&&(r=`>=${n}.${i}.0${o} <${n}.${+i+1}.0-0`),l("xRange return",r),r}))},S=(e,t)=>(l("replaceStars",e,t),e.trim().replace(u[d.STAR],"")),P=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),A=e=>(t,r,a,n,i,s,o,l,c,u,d,h)=>`${r=w(a)?"":w(n)?`>=${a}.0.0${e?"-0":""}`:w(i)?`>=${a}.${n}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`} ${l=w(c)?"":w(u)?`<${+c+1}.0.0-0`:w(d)?`<${c}.${+u+1}.0-0`:h?`<=${c}.${u}.${d}-${h}`:e?`<${c}.${u}.${+d+1}-0`:`<=${l}`}`.trim(),j=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){const a=e[r].semver;if(a.major===t.major&&a.minor===t.minor&&a.patch===t.patch)return!0}return!1}return!0}},9583:(e,t,r)=>{"use strict";r.d(t,{Az:()=>o,Ec:()=>s});const a=()=>"undefined"!=typeof Deno,n=()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||a()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":a()?"deno":"other":"node",e};let i;async function s(){if(void 0===i){const e=n();i={library:"langchain-js",runtime:e}}return i}function o(e){try{return"undefined"!=typeof process?process.env?.[e]:a()?Deno?.env.get(e):void 0}catch(e){return}}},9606:(e,t,r)=>{const a=r(4621);e.exports=(e,t,r)=>0!==a(e,t,r)},9624:(e,t,r)=>{"use strict";r.d(t,{g:()=>o});var a=r(4116),n=r(3290);const i=[400,401,402,403,404,405,406,407,409],s=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&i.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class o{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??s;const t=n.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>a((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},9830:(e,t,r)=>{"use strict";async function a(e,t){if(void 0===t)return e;let r;return Promise.race([e.catch((e=>{if(!t?.aborted)throw e})),new Promise(((e,a)=>{r=()=>{a(new Error("Aborted"))},t.addEventListener("abort",r),t.aborted&&a(new Error("Aborted"))}))]).finally((()=>t.removeEventListener("abort",r)))}r.d(t,{o:()=>a})},9849:(e,t,r)=>{"use strict";r.d(t,{Ns:()=>A,D4:()=>x,g2:()=>k,QC:()=>P,Xm:()=>S});var a=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===a.call(e)};function i(e){return"function"==typeof e}function s(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"==typeof e&&t in e}var l=RegExp.prototype.test,c=/\S/;var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},d=/\s*/,h=/\s+/,p=/\s*=/,m=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function g(e){this.string=e,this.tail=e,this.pos=0}function y(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function b(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}g.prototype.eos=function(){return""===this.tail},g.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},g.prototype.scanUntil=function(e){var t,r=this.tail.search(e);switch(r){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=t.length,t},y.prototype.push=function(e){return new y(e,this)},y.prototype.lookup=function(e){var t,r,a,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var s,l,c,u=this,d=!1;u;){if(e.indexOf(".")>0)for(s=u.view,l=e.split("."),c=0;null!=s&&c<l.length;)c===l.length-1&&(d=o(s,l[c])||(r=s,a=l[c],null!=r&&"object"!=typeof r&&r.hasOwnProperty&&r.hasOwnProperty(a))),s=s[l[c++]];else s=u.view[e],d=o(u.view,e);if(d){t=s;break}u=u.parent}n[e]=t}return i(t)&&(t=t.call(this.view)),t},b.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},b.prototype.parse=function(e,t){var r=this.templateCache,a=e+":"+(t||v.tags).join(":"),i=void 0!==r,o=i?r.get(a):void 0;return null==o&&(o=function(e,t){if(!e)return[];var r,a,i,o,u=!1,y=[],b=[],_=[],w=!1,E=!1,O="",x=0;function k(){if(w&&!E)for(;_.length;)delete b[_.pop()];else _=[];w=!1,E=!1}function T(e){if("string"==typeof e&&(e=e.split(h,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);r=new RegExp(s(e[0])+"\\s*"),a=new RegExp("\\s*"+s(e[1])),i=new RegExp("\\s*"+s("}"+e[1]))}T(t||v.tags);for(var I,S,P,A,j,C,$=new g(e);!$.eos();){if(I=$.pos,P=$.scanUntil(r))for(var N=0,R=P.length;N<R;++N)o=A=P.charAt(N),function(e,t){return l.call(e,t)}(c,o)?(E=!0,u=!0,O+=" "):(_.push(b.length),O+=A),b.push(["text",A,I,I+1]),I+=1,"\n"===A&&(k(),O="",x=0,u=!1);if(!$.scan(r))break;if(w=!0,S=$.scan(f)||"name",$.scan(d),"="===S?(P=$.scanUntil(p),$.scan(p),$.scanUntil(a)):"{"===S?(P=$.scanUntil(i),$.scan(m),$.scanUntil(a),S="&"):P=$.scanUntil(a),!$.scan(a))throw new Error("Unclosed tag at "+$.pos);if(j=">"==S?[S,P,I,$.pos,O,x,u]:[S,P,I,$.pos],x++,b.push(j),"#"===S||"^"===S)y.push(j);else if("/"===S){if(!(C=y.pop()))throw new Error('Unopened section "'+P+'" at '+I);if(C[1]!==P)throw new Error('Unclosed section "'+C[1]+'" at '+I)}else"name"===S||"{"===S||"&"===S?E=!0:"="===S&&T(P)}if(k(),C=y.pop())throw new Error('Unclosed section "'+C[1]+'" at '+$.pos);return function(e){for(var t,r=[],a=r,n=[],i=0,s=e.length;i<s;++i)switch((t=e[i])[0]){case"#":case"^":a.push(t),n.push(t),a=t[4]=[];break;case"/":n.pop()[5]=t[2],a=n.length>0?n[n.length-1][4]:r;break;default:a.push(t)}return r}(function(e){for(var t,r,a=[],n=0,i=e.length;n<i;++n)(t=e[n])&&("text"===t[0]&&r&&"text"===r[0]?(r[1]+=t[1],r[3]=t[3]):(a.push(t),r=t));return a}(b))}(e,t),i&&r.set(a,o)),o},b.prototype.render=function(e,t,r,a){var n=this.getConfigTags(a),i=this.parse(e,n),s=t instanceof y?t:new y(t,void 0);return this.renderTokens(i,s,r,e,a)},b.prototype.renderTokens=function(e,t,r,a,n){for(var i,s,o,l="",c=0,u=e.length;c<u;++c)o=void 0,"#"===(s=(i=e[c])[0])?o=this.renderSection(i,t,r,a,n):"^"===s?o=this.renderInverted(i,t,r,a,n):">"===s?o=this.renderPartial(i,t,r,n):"&"===s?o=this.unescapedValue(i,t):"name"===s?o=this.escapedValue(i,t,n):"text"===s&&(o=this.rawValue(i)),void 0!==o&&(l+=o);return l},b.prototype.renderSection=function(e,t,r,a,s){var o=this,l="",c=t.lookup(e[1]);if(c){if(n(c))for(var u=0,d=c.length;u<d;++u)l+=this.renderTokens(e[4],t.push(c[u]),r,a,s);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)l+=this.renderTokens(e[4],t.push(c),r,a,s);else if(i(c)){if("string"!=typeof a)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(t.view,a.slice(e[3],e[5]),(function(e){return o.render(e,t,r,s)})))&&(l+=c)}else l+=this.renderTokens(e[4],t,r,a,s);return l}},b.prototype.renderInverted=function(e,t,r,a,i){var s=t.lookup(e[1]);if(!s||n(s)&&0===s.length)return this.renderTokens(e[4],t,r,a,i)},b.prototype.indentPartial=function(e,t,r){for(var a=t.replace(/[^ \t]/g,""),n=e.split("\n"),i=0;i<n.length;i++)n[i].length&&(i>0||!r)&&(n[i]=a+n[i]);return n.join("\n")},b.prototype.renderPartial=function(e,t,r,a){if(r){var n=this.getConfigTags(a),s=i(r)?r(e[1]):r[e[1]];if(null!=s){var o=e[6],l=e[5],c=e[4],u=s;0==l&&c&&(u=this.indentPartial(s,c,o));var d=this.parse(u,n);return this.renderTokens(d,t,r,u,a)}}},b.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(null!=r)return r},b.prototype.escapedValue=function(e,t,r){var a=this.getConfigEscape(r)||v.escape,n=t.lookup(e[1]);if(null!=n)return"number"==typeof n&&a===v.escape?String(n):a(n)},b.prototype.rawValue=function(e){return e[1]},b.prototype.getConfigTags=function(e){return n(e)?e:e&&"object"==typeof e?e.tags:void 0},b.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!n(e)?e.escape:void 0};var v={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){_.templateCache=e},get templateCache(){return _.templateCache}},_=new b;v.clearCache=function(){return _.clearCache()},v.parse=function(e,t){return _.parse(e,t)},v.render=function(e,t,r,a){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)');var i;return _.render(e,t,r,a)},v.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return u[e]}))},v.Scanner=g,v.Context=y,v.Writer=b;const w=v;var E=r(1368);function O(){w.escape=e=>e}const x=e=>{const t=e.split(""),r=[],a=(e,r)=>{for(let a=r;a<t.length;a+=1)if(e.includes(t[a]))return a;return-1};let n=0;for(;n<t.length;)if("{"===t[n]&&n+1<t.length&&"{"===t[n+1])r.push({type:"literal",text:"{"}),n+=2;else if("}"===t[n]&&n+1<t.length&&"}"===t[n+1])r.push({type:"literal",text:"}"}),n+=2;else if("{"===t[n]){const e=a("}",n);if(e<0)throw new Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(n+1,e).join("")}),n=e+1}else{if("}"===t[n])throw new Error("Single '}' in template.");{const e=a("{}",n),i=(e<0?t.slice(n):t.slice(n,e)).join("");r.push({type:"literal",text:i}),n=e<0?t.length:e}}return r},k=e=>(O(),(e=>e.map((e=>"name"===e[0]?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]})))(w.parse(e))),T={"f-string":(e,t)=>x(e).reduce(((e,r)=>{if("variable"===r.type){if(r.name in t)return e+("string"==typeof t[r.name]?t[r.name]:JSON.stringify(t[r.name]));throw new Error(`(f-string) Missing value for input ${r.name}`)}return e+r.text}),""),mustache:(e,t)=>(O(),w.render(e,t))},I={"f-string":x,mustache:k},S=(e,t,r)=>{try{return T[t](e,r)}catch(e){throw(0,E.Y)(e,"INVALID_PROMPT_INPUT")}},P=(e,t)=>I[t](e),A=(e,t,r)=>{if(!(t in T)){const e=Object.keys(T);throw new Error(`Invalid template format. Got \`${t}\`;\n                         should be one of ${e}`)}try{const a=r.reduce(((e,t)=>(e[t]="foo",e)),{});Array.isArray(e)?e.forEach((e=>{if("text"===e.type)S(e.text,t,a);else{if("image_url"!==e.type)throw new Error(`Invalid message template received. ${JSON.stringify(e,null,2)}`);if("string"==typeof e.image_url)S(e.image_url,t,a);else{const r=e.image_url.url;S(r,t,a)}}})):S(e,t,a)}catch(e){throw new Error(`Invalid prompt schema: ${e.message}`)}}},9855:(e,t,r)=>{const a=r(7737);e.exports=(e,t)=>{const r=a(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},9881:(e,t,r)=>{const a=r(9558),n=r(6635),{ANY:i}=n,s=r(995),o=r(4621),l=[new n(">=0.0.0-0")],c=[new n(">=0.0.0")],u=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===i){if(1===t.length&&t[0].semver===i)return!0;e=r.includePrerelease?l:c}if(1===t.length&&t[0].semver===i){if(r.includePrerelease)return!0;t=c}const a=new Set;let n,u,p,m,f,g,y;for(const t of e)">"===t.operator||">="===t.operator?n=d(n,t,r):"<"===t.operator||"<="===t.operator?u=h(u,t,r):a.add(t.semver);if(a.size>1)return null;if(n&&u){if(p=o(n.semver,u.semver,r),p>0)return null;if(0===p&&(">="!==n.operator||"<="!==u.operator))return null}for(const e of a){if(n&&!s(e,String(n),r))return null;if(u&&!s(e,String(u),r))return null;for(const a of t)if(!s(e,String(a),r))return!1;return!0}let b=!(!u||r.includePrerelease||!u.semver.prerelease.length)&&u.semver,v=!(!n||r.includePrerelease||!n.semver.prerelease.length)&&n.semver;b&&1===b.prerelease.length&&"<"===u.operator&&0===b.prerelease[0]&&(b=!1);for(const e of t){if(y=y||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,n)if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),">"===e.operator||">="===e.operator){if(m=d(n,e,r),m===e&&m!==n)return!1}else if(">="===n.operator&&!s(n.semver,String(e),r))return!1;if(u)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),"<"===e.operator||"<="===e.operator){if(f=h(u,e,r),f===e&&f!==u)return!1}else if("<="===u.operator&&!s(u.semver,String(e),r))return!1;if(!e.operator&&(u||n)&&0!==p)return!1}return!(n&&g&&!u&&0!==p||u&&y&&!n&&0!==p||v||b)},d=(e,t,r)=>{if(!e)return t;const a=o(e.semver,t.semver,r);return a>0?e:a<0||">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;const a=o(e.semver,t.semver,r);return a<0?e:a>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new a(e,r),t=new a(t,r);let n=!1;e:for(const a of e.set){for(const e of t.set){const t=u(a,e,r);if(n=n||null!==t,t)continue e}if(n)return!1}return!0}},9998:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let a=0,n=e.length;for(;n>0;){const i=n/2|0;let s=a+i;r(e[s],t)<=0?(a=++s,n-=i+1):n=i}return a}}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={id:a,loaded:!1,exports:{}};return e[a](i,i.exports,r),i.loaded=!0,i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.nc=void 0,(()=>{"use strict";var e=r(5072),t=r.n(e),a=r(7825),n=r.n(a),i=r(7659),s=r.n(i),o=r(5056),l=r.n(o),c=r(540),u=r.n(c),d=r(1113),h=r.n(d),p=r(365),m={};m.styleTagTransform=h(),m.setAttributes=l(),m.insert=s().bind(null,"head"),m.domAPI=n(),m.insertStyleElement=u(),t()(p.A,m),p.A&&p.A.locals&&p.A.locals;function f(e){const t=function(e){const t=e.querySelector(".ha h2");if(t)return t.textContent.trim();{console.log('Subject element not found with selector ".ha h2" within email item. Trying a broader search.');const e=document.querySelector(".hP");return e?e.textContent.trim():(console.warn('Subject element not found with selector ".hP" either. Subject might not be accessible or selector is incorrect.'),"Subject not found")}}(e);return`Subject: ${t}\nMail Content:\n${function(){let e="";const t=document.querySelectorAll(".ii.gt");return t&&t.length>0&&t.forEach((t=>{e+=t.textContent+"\n\n"})),e=e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").replace(/\s*([.,!?;])\s*/g,"$1 "),console.log("getEmailContent() called - Fetched content:",e),e.trim()}()}`}async function g(e){const t=document.querySelector(".mail-summery p"),r=document.querySelector(".action-items ul");t.textContent="Loading summary...",r.innerHTML="";const a=document.createElement("li");a.textContent="Fetching action items...",r.appendChild(a);try{await new Promise((e=>{const t=setInterval((()=>{document.querySelector(".ii.gt")&&(clearInterval(t),e())}),200);setTimeout((()=>{clearInterval(t),e()}),1e4)}));const t=f(e),r=await fetch("http://localhost:8000/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const a=await r.json();console.log(a),function(e){const t=document.querySelector(".mail-summery p"),r=document.querySelector(".action-items ul");if(t.textContent=e.summary||"Summary not found.",r.innerHTML="",e.actionItems&&e.actionItems.length>0)e.actionItems.forEach((e=>{const t=document.createElement("li");t.textContent=e,r.appendChild(t)}));else{const e=document.createElement("li");e.textContent="No Action Items",r.appendChild(e)}}(a)}catch(e){console.error("Error processing email:",e),t.textContent="Failed to load summary.",r.innerHTML="";const a=document.createElement("li");a.textContent="Failed to fetch action items.",r.appendChild(a)}}var y=r(1673),b=(r(2366),r(8028)),v="object"==typeof window?window:{},_="0123456789abcdef".split(""),w=[-2147483648,8388608,32768,128],E=[24,16,8,0],O=[];function x(e){e?(O[0]=O[16]=O[1]=O[2]=O[3]=O[4]=O[5]=O[6]=O[7]=O[8]=O[9]=O[10]=O[11]=O[12]=O[13]=O[14]=O[15]=0,this.blocks=O):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}x.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===v.ArrayBuffer&&(e=new Uint8Array(e));for(var r,a,n=0,i=e.length||0,s=this.blocks;n<i;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)for(a=this.start;n<i&&a<64;++n)s[a>>2]|=e[n]<<E[3&a++];else for(a=this.start;n<i&&a<64;++n)(r=e.charCodeAt(n))<128?s[a>>2]|=r<<E[3&a++]:r<2048?(s[a>>2]|=(192|r>>6)<<E[3&a++],s[a>>2]|=(128|63&r)<<E[3&a++]):r<55296||r>=57344?(s[a>>2]|=(224|r>>12)<<E[3&a++],s[a>>2]|=(128|r>>6&63)<<E[3&a++],s[a>>2]|=(128|63&r)<<E[3&a++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++n)),s[a>>2]|=(240|r>>18)<<E[3&a++],s[a>>2]|=(128|r>>12&63)<<E[3&a++],s[a>>2]|=(128|r>>6&63)<<E[3&a++],s[a>>2]|=(128|63&r)<<E[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=s[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},x.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=w[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},x.prototype.hash=function(){var e,t,r=this.h0,a=this.h1,n=this.h2,i=this.h3,s=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)r=(t=(a=(t=(n=(t=(i=(t=(s=(t=r<<5|r>>>27)+(a&n|~a&i)+s+1518500249+o[e]|0)<<5|s>>>27)+(r&(a=a<<30|a>>>2)|~r&n)+i+1518500249+o[e+1]|0)<<5|i>>>27)+(s&(r=r<<30|r>>>2)|~s&a)+n+1518500249+o[e+2]|0)<<5|n>>>27)+(i&(s=s<<30|s>>>2)|~i&r)+a+1518500249+o[e+3]|0)<<5|a>>>27)+(n&(i=i<<30|i>>>2)|~n&s)+r+1518500249+o[e+4]|0,n=n<<30|n>>>2;for(;e<40;e+=5)r=(t=(a=(t=(n=(t=(i=(t=(s=(t=r<<5|r>>>27)+(a^n^i)+s+1859775393+o[e]|0)<<5|s>>>27)+(r^(a=a<<30|a>>>2)^n)+i+1859775393+o[e+1]|0)<<5|i>>>27)+(s^(r=r<<30|r>>>2)^a)+n+1859775393+o[e+2]|0)<<5|n>>>27)+(i^(s=s<<30|s>>>2)^r)+a+1859775393+o[e+3]|0)<<5|a>>>27)+(n^(i=i<<30|i>>>2)^s)+r+1859775393+o[e+4]|0,n=n<<30|n>>>2;for(;e<60;e+=5)r=(t=(a=(t=(n=(t=(i=(t=(s=(t=r<<5|r>>>27)+(a&n|a&i|n&i)+s-1894007588+o[e]|0)<<5|s>>>27)+(r&(a=a<<30|a>>>2)|r&n|a&n)+i-1894007588+o[e+1]|0)<<5|i>>>27)+(s&(r=r<<30|r>>>2)|s&a|r&a)+n-1894007588+o[e+2]|0)<<5|n>>>27)+(i&(s=s<<30|s>>>2)|i&r|s&r)+a-1894007588+o[e+3]|0)<<5|a>>>27)+(n&(i=i<<30|i>>>2)|n&s|i&s)+r-1894007588+o[e+4]|0,n=n<<30|n>>>2;for(;e<80;e+=5)r=(t=(a=(t=(n=(t=(i=(t=(s=(t=r<<5|r>>>27)+(a^n^i)+s-899497514+o[e]|0)<<5|s>>>27)+(r^(a=a<<30|a>>>2)^n)+i-899497514+o[e+1]|0)<<5|i>>>27)+(s^(r=r<<30|r>>>2)^a)+n-899497514+o[e+2]|0)<<5|n>>>27)+(i^(s=s<<30|s>>>2)^r)+a-899497514+o[e+3]|0)<<5|a>>>27)+(n^(i=i<<30|i>>>2)^s)+r-899497514+o[e+4]|0,n=n<<30|n>>>2;this.h0=this.h0+r|0,this.h1=this.h1+a|0,this.h2=this.h2+n|0,this.h3=this.h3+i|0,this.h4=this.h4+s|0},x.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return _[e>>28&15]+_[e>>24&15]+_[e>>20&15]+_[e>>16&15]+_[e>>12&15]+_[e>>8&15]+_[e>>4&15]+_[15&e]+_[t>>28&15]+_[t>>24&15]+_[t>>20&15]+_[t>>16&15]+_[t>>12&15]+_[t>>8&15]+_[t>>4&15]+_[15&t]+_[r>>28&15]+_[r>>24&15]+_[r>>20&15]+_[r>>16&15]+_[r>>12&15]+_[r>>8&15]+_[r>>4&15]+_[15&r]+_[a>>28&15]+_[a>>24&15]+_[a>>20&15]+_[a>>16&15]+_[a>>12&15]+_[a>>8&15]+_[a>>4&15]+_[15&a]+_[n>>28&15]+_[n>>24&15]+_[n>>20&15]+_[n>>16&15]+_[n>>12&15]+_[n>>8&15]+_[n>>4&15]+_[15&n]},x.prototype.toString=x.prototype.hex,x.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,n>>24&255,n>>16&255,n>>8&255,255&n]},x.prototype.array=x.prototype.digest,x.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};var k=r(6362);const T=(...e)=>{return t=e.join("_"),new x(!0).update(t).hex();var t};class I{}const S=new Map;class P extends I{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(T(e,t))??null)}async update(e,t,r){this.cache.set(T(e,t),r)}static global(){return new P(S)}}var A=r(5311),j=r(9624),C=r(7526),$=Object.defineProperty;function N(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let r=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;r.length>1;){let a=null;for(let n=0;n<r.length-1;n++){const i=e.slice(r[n].start,r[n+1].end),s=t.get(i.join(","));null!=s&&(null==a||s<a[0])&&(a=[s,n])}if(null==a)break;{const e=a[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}}return r}(e,t).map((r=>t.get(e.slice(r.start,r.end).join(",")))).filter((e=>null!=e))}var R,L=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const r=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[r,a,...n]=t.split(" "),i=Number.parseInt(a,10);return n.forEach(((t,r)=>e[t]=i+r)),e}),{});for(const[e,t]of Object.entries(r)){const r=C.toByteArray(e);this.rankMap.set(r.join(","),t),this.textMap.set(t,r)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],r="all"){const a=new RegExp(this.patStr,"ug"),n=L.specialTokenRegex(Object.keys(this.specialTokens)),i=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter((e=>!s.has(e))):r);if(o.size>0){const t=L.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw new Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;n.lastIndex=r,t=n.exec(e),null!=t&&!s.has(t[0]);)r=t.index+1;const o=t?.index??e.length;for(const t of e.substring(l,o).matchAll(a)){const e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));null==r?i.push(...N(e,this.rankMap)):i.push(r)}if(null==t)break;let c=this.specialTokens[t[0]];i.push(c),l=t.index+t[0].length}return i}decode(e){const t=[];let r=0;for(let a=0;a<e.length;++a){const n=e[a],i=this.textMap.get(n)??this.inverseSpecialTokens[n];null!=i&&(t.push(i),r+=i.length)}const a=new Uint8Array(r);let n=0;for(const e of t)a.set(e,n),n+=e.length;return this.textDecoder.decode(a)}},M=L;((e,t,r)=>{t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(M,"symbol"!=typeof(R="specialTokenRegex")?R+"":R,(e=>new RegExp(e.map((e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"))).join("|"),"g")));const U={},F=new j.g({});var D=r(3230);class Z extends D.YN{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class z extends Z{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){const{cache:a,...n}=r;super({callbacks:e??t,...n}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache="object"==typeof a?a:a?P.global():void 0,this.caller=new j.g(r??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await async function(e){return async function(e){return e in U||(U[e]=F.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then((e=>e.json())).then((e=>new M(e))).catch((t=>{throw delete U[e],t}))),await U[e]}(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}(e))}("modelName"in this?(r=this.modelName,r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}var r;if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new A.HY(e):Array.isArray(e)?new A.aB(e.map(k.K0)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()},a=Object.entries(r).filter((([e,t])=>void 0!==t)).map((([e,t])=>`${e}:${JSON.stringify(t)}`)).sort().join(",");return a}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}var B=r(5780),H=r(58);r(765),D.YN;var V=r(5960),G="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==r.g&&r.g||{},q="URLSearchParams"in G,Y="Symbol"in G&&"iterator"in Symbol,J="FileReader"in G&&"Blob"in G&&function(){try{return new Blob,!0}catch(e){return!1}}(),W="FormData"in G,K="ArrayBuffer"in G;if(K)var X=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Q=ArrayBuffer.isView||function(e){return e&&X.indexOf(Object.prototype.toString.call(e))>-1};function ee(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function te(e){return"string"!=typeof e&&(e=String(e)),e}function re(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return Y&&(t[Symbol.iterator]=function(){return t}),t}function ae(e){this.map={},e instanceof ae?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function ne(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function ie(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function se(e){var t=new FileReader,r=ie(t);return t.readAsArrayBuffer(e),r}function oe(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function le(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:J&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:W&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:q&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():K&&J&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=oe(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):K&&(ArrayBuffer.prototype.isPrototypeOf(e)||Q(e))?this._bodyArrayBuffer=oe(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):q&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},J&&(this.blob=function(){var e=ne(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer)return ne(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer));if(J)return this.blob().then(se);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,r,a,n,i=ne(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,r=ie(t=new FileReader),n=(a=/charset=([A-Za-z0-9_-]+)/.exec(e.type))?a[1]:"utf-8",t.readAsText(e,n),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),a=0;a<t.length;a++)r[a]=String.fromCharCode(t[a]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},W&&(this.formData=function(){return this.text().then(de)}),this.json=function(){return this.text().then(JSON.parse)},this}ae.prototype.append=function(e,t){e=ee(e),t=te(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},ae.prototype.delete=function(e){delete this.map[ee(e)]},ae.prototype.get=function(e){return e=ee(e),this.has(e)?this.map[e]:null},ae.prototype.has=function(e){return this.map.hasOwnProperty(ee(e))},ae.prototype.set=function(e,t){this.map[ee(e)]=te(t)},ae.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},ae.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),re(e)},ae.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),re(e)},ae.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),re(e)},Y&&(ae.prototype[Symbol.iterator]=ae.prototype.entries);var ce=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function ue(e,t){if(!(this instanceof ue))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,a,n=(t=t||{}).body;if(e instanceof ue){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new ae(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new ae(t.headers)),this.method=(a=(r=t.method||this.method||"GET").toUpperCase(),ce.indexOf(a)>-1?a:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in G)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var i=/([?&])_=[^&]*/;i.test(this.url)?this.url=this.url.replace(i,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function de(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),a=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(a),decodeURIComponent(n))}})),t}function he(e,t){if(!(this instanceof he))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new ae(t.headers),this.url=t.url||"",this._initBody(e)}ue.prototype.clone=function(){return new ue(this,{body:this._bodyInit})},le.call(ue.prototype),le.call(he.prototype),he.prototype.clone=function(){return new he(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new ae(this.headers),url:this.url})},he.error=function(){var e=new he(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var pe=[301,302,303,307,308];he.redirect=function(e,t){if(-1===pe.indexOf(t))throw new RangeError("Invalid status code");return new he(null,{status:t,headers:{location:e}})};var me=G.DOMException;try{new me}catch(e){(me=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),me.prototype.constructor=me}function fe(e,t){return new Promise((function(r,a){var n=new ue(e,t);if(n.signal&&n.signal.aborted)return a(new me("Aborted","AbortError"));var i=new XMLHttpRequest;function s(){i.abort()}if(i.onload=function(){var e,t,a={statusText:i.statusText,headers:(e=i.getAllResponseHeaders()||"",t=new ae,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),a=r.shift().trim();if(a){var n=r.join(":").trim();try{t.append(a,n)}catch(e){console.warn("Response "+e.message)}}})),t)};0===n.url.indexOf("file://")&&(i.status<200||i.status>599)?a.status=200:a.status=i.status,a.url="responseURL"in i?i.responseURL:a.headers.get("X-Request-URL");var s="response"in i?i.response:i.responseText;setTimeout((function(){r(new he(s,a))}),0)},i.onerror=function(){setTimeout((function(){a(new TypeError("Network request failed"))}),0)},i.ontimeout=function(){setTimeout((function(){a(new TypeError("Network request timed out"))}),0)},i.onabort=function(){setTimeout((function(){a(new me("Aborted","AbortError"))}),0)},i.open(n.method,function(e){try{return""===e&&G.location.href?G.location.href:e}catch(t){return e}}(n.url),!0),"include"===n.credentials?i.withCredentials=!0:"omit"===n.credentials&&(i.withCredentials=!1),"responseType"in i&&(J?i.responseType="blob":K&&(i.responseType="arraybuffer")),t&&"object"==typeof t.headers&&!(t.headers instanceof ae||G.Headers&&t.headers instanceof G.Headers)){var o=[];Object.getOwnPropertyNames(t.headers).forEach((function(e){o.push(ee(e)),i.setRequestHeader(e,te(t.headers[e]))})),n.headers.forEach((function(e,t){-1===o.indexOf(t)&&i.setRequestHeader(t,e)}))}else n.headers.forEach((function(e,t){i.setRequestHeader(t,e)}));n.signal&&(n.signal.addEventListener("abort",s),i.onreadystatechange=function(){4===i.readyState&&n.signal.removeEventListener("abort",s)}),i.send(void 0===n._bodyInit?null:n._bodyInit)}))}fe.polyfill=!0,G.fetch||(G.fetch=fe,G.Headers=ae,G.Request=ue,G.Response=he);const ge="11434",ye=`http://127.0.0.1:${ge}`;var be=Object.defineProperty,ve=(e,t,r)=>(((e,t,r)=>{t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);class _e extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,_e)}}class we{constructor(e,t,r){ve(this,"abortController"),ve(this,"itr"),ve(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(const e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||"success"===e.status)return void this.doneCallback()}throw new Error("Did not receive done or success response in stream.")}}const Ee=async e=>{if(e.ok)return;let t=`Error ${e.status}: ${e.statusText}`,r=null;if(e.headers.get("content-type")?.includes("application/json"))try{r=await e.json(),t=r.error||t}catch(e){console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),t=await e.text()||t}catch(e){console.log("Failed to get text from error response")}throw new _e(t,e.status)};function Oe(){if("undefined"!=typeof window&&window.navigator){const e=navigator;return"userAgentData"in e&&e.userAgentData?.platform?`${e.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}return"undefined"!=typeof process?`${process.arch} ${process.platform} Node.js/${process.version}`:""}const xe=async(e,t,r={})=>{const a={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/0.5.14 (${Oe()})`};r.headers=function(e){if(e instanceof Headers){const t={};return e.forEach(((e,r)=>{t[r]=e})),t}return Array.isArray(e)?Object.fromEntries(e):e||{}}(r.headers);const n=Object.fromEntries(Object.entries(r.headers).filter((([e])=>!Object.keys(a).some((t=>t.toLowerCase()===e.toLowerCase())))));return r.headers={...a,...n},e(t,r)},ke=async(e,t,r)=>{const a=await xe(e,t,{headers:r?.headers});return await Ee(a),a},Te=async(e,t,r,a)=>{const n=null===(i=r)||"object"!=typeof i||Array.isArray(i)?r:JSON.stringify(r);var i;const s=await xe(e,t,{method:"POST",body:n,signal:a?.signal,headers:a?.headers});return await Ee(s),s};var Ie=Object.defineProperty,Se=(e,t,r)=>(((e,t,r)=>{t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);let Pe=class{constructor(e){Se(this,"config"),Se(this,"fetch"),Se(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e?.headers},e?.proxy||(this.config.host=(e=>{if(!e)return ye;let t=e.includes("://");e.startsWith(":")&&(e=`http://127.0.0.1${e}`,t=!0),t||(e=`http://${e}`);const r=new URL(e);let a=r.port;a||(a=t?"https:"===r.protocol?"443":"80":ge);let n=`${r.protocol}//${r.hostname}:${a}${r.pathname}`;return n.endsWith("/")&&(n=n.slice(0,-1)),n})(e?.host??ye)),this.fetch=e?.fetch??fetch}abort(){for(const e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){t.stream=t.stream??!1;const r=`${this.config.host}/api/${e}`;if(t.stream){const e=new AbortController,a=await Te(this.fetch,r,t,{signal:e.signal,headers:this.config.headers});if(!a.body)throw new Error("Missing body");const n=async function*(e){const t=new TextDecoder("utf-8");let r="";const a=e.getReader();for(;;){const{done:e,value:n}=await a.read();if(e)break;r+=t.decode(n);const i=r.split("\n");r=i.pop()??"";for(const e of i)try{yield JSON.parse(e)}catch(t){console.warn("invalid json: ",e)}}for(const e of r.split("\n").filter((e=>""!==e)))try{yield JSON.parse(e)}catch(t){console.warn("invalid json: ",e)}}(a.body),i=new we(e,n,(()=>{const e=this.ongoingStreamedRequests.indexOf(i);e>-1&&this.ongoingStreamedRequests.splice(e,1)}));return this.ongoingStreamedRequests.push(i),i}const a=await Te(this.fetch,r,t,{headers:this.config.headers});return await a.json()}async encodeImage(e){if("string"!=typeof e){const t=new Uint8Array(e);let r="";const a=t.byteLength;for(let e=0;e<a;e++)r+=String.fromCharCode(t[e]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(const t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await(async(e,t,r,a)=>{const n=await xe(e,t,{method:"DELETE",body:JSON.stringify(r),headers:a?.headers});return await Ee(n),n})(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await Te(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){const e=await ke(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers});return await e.json()}async show(e){const t=await Te(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers});return await t.json()}async embed(e){const t=await Te(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers});return await t.json()}async embeddings(e){const t=await Te(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers});return await t.json()}async ps(){const e=await ke(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers});return await e.json()}};new Pe,D.YN,D.YN,D.fJ,r(1368),D.YN,Error,"undefined"!=typeof self&&self.location&&"null"!==self.location.origin?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");const Ae=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function je(e){return e.test.bind(e)}var Ce;(function(e,t){const r=t.match(Ae);if(!r)return!1;const a=+r[1],n=+r[2],i=+r[3],s=!!r[5];return(a<=23&&n<=59&&i<=59||23==a&&59==n&&60==i)&&(!e||s)}).bind(void 0,!1),je(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),je(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),je(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),je(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),je(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),je(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),je(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),je(/^(?:\/(?:[^~/]|~0|~1)*)*$/),je(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),je(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/),function(e){e[e.Flag=1]="Flag",e[e.Basic=2]="Basic",e[e.Detailed=4]="Detailed"}(Ce||(Ce={})),r(3490),r(4476),r(6150),r(780),r(3829);class $e extends z{constructor({concurrency:e,...t}){super(e?{maxConcurrency:e,...t}:t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]})}async invoke(e,t){const r=$e._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].text}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async*_streamIterator(e,t){if(this._streamResponseChunks===$e.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=$e._convertInputToPromptValue(e),[a,n]=this._separateRunnableConfigFromCallOptionsCompat(t),i=await B.Td.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),s={options:n,invocation_params:this?.invocationParams(n),batch_size:1},o=await(i?.handleLLMStart(this.toJSON(),[r.toString()],a.runId,void 0,s,void 0,void 0,a.runName));let l=new b.mu({text:""});try{for await(const e of this._streamResponseChunks(r.toString(),n,o?.[0]))l=l?l.concat(e):e,"string"==typeof e.text&&(yield e.text)}catch(e){throw await Promise.all((o??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((o??[]).map((e=>e?.handleLLMEnd({generations:[[l]]}))))}}async generatePrompt(e,t,r){const a=e.map((e=>e.toString()));return this.generate(a,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let r=0;r<e.generations.length;r+=1){const a=e.generations[r];if(0===r)t.push({generations:[a],llmOutput:e.llmOutput});else{const r=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[a],llmOutput:r})}}return t}async _generateUncached(e,t,r,a){let n,i;if(void 0!==a&&a.length===e.length)n=a;else{const a=await B.Td.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i={options:t,invocation_params:this?.invocationParams(t),batch_size:e.length};n=await(a?.handleLLMStart(this.toJSON(),e,r.runId,void 0,i,void 0,void 0,r?.runName))}if(n?.[0].handlers.find(V.xL)&&1===e.length&&this._streamResponseChunks!==$e.prototype._streamResponseChunks)try{const r=await this._streamResponseChunks(e[0],t,n?.[0]);let a;for await(const e of r)a=void 0===a?e:(0,H.xW)(a,e);if(void 0===a)throw new Error("Received empty response from chat model call.");i={generations:[[a]],llmOutput:{}},await(n?.[0].handleLLMEnd(i))}catch(e){throw await(n?.[0].handleLLMError(e)),e}else{try{i=await this._generate(e,t,n?.[0])}catch(e){throw await Promise.all((n??[]).map((t=>t?.handleLLMError(e)))),e}const r=this._flattenLLMResult(i);await Promise.all((n??[]).map(((e,t)=>e?.handleLLMEnd(r[t]))))}const s=n?.map((e=>e.runId))||void 0;return Object.defineProperty(i,b.SP,{value:s?{runIds:s}:void 0,configurable:!0}),i}async _generateCached({prompts:e,cache:t,llmStringKey:r,parsedOptions:a,handledOptions:n,runId:i}){const s=await B.Td.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),o={options:a,invocation_params:this?.invocationParams(a),batch_size:e.length},l=await(s?.handleLLMStart(this.toJSON(),e,i,void 0,o,void 0,void 0,n?.runName)),c=[],u=(await Promise.allSettled(e.map((async(e,a)=>{const n=await t.lookup(e,r);return null==n&&c.push(a),n})))).map(((e,t)=>({result:e,runManager:l?.[t]}))).filter((({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status)),d=[];await Promise.all(u.map((async({result:e,runManager:t},r)=>{if("fulfilled"===e.status){const a=e.value;return d[r]=a.map((e=>(e.generationInfo={...e.generationInfo,tokenUsage:{}},e))),a.length&&await(t?.handleLLMNewToken(a[0].text)),t?.handleLLMEnd({generations:[a]},void 0,void 0,void 0,{cached:!0})}return await(t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(e.reason)})));const h={generations:d,missingPromptIndices:c,startedRunManagers:l};return Object.defineProperty(h,b.SP,{value:l?{runIds:l?.map((e=>e.runId))}:void 0,configurable:!0}),h}async generate(e,t,r){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let a;a=Array.isArray(t)?{stop:t}:t;const[n,i]=this._separateRunnableConfigFromCallOptionsCompat(a);if(n.callbacks=n.callbacks??r,!this.cache)return this._generateUncached(e,i,n);const{cache:s}=this,o=this._getSerializedCacheKeyParametersForCall(i),{generations:l,missingPromptIndices:c,startedRunManagers:u}=await this._generateCached({prompts:e,cache:s,llmStringKey:o,parsedOptions:i,handledOptions:n,runId:n.runId});let d={};if(c.length>0){const t=await this._generateUncached(c.map((t=>e[t])),i,n,void 0!==u?c.map((e=>u?.[e])):void 0);await Promise.all(t.generations.map((async(t,r)=>{const a=c[r];return l[a]=t,s.update(e[a],o,t)}))),d=t.llmOutput??{}}return{generations:l,llmOutput:d}}async call(e,t,r){const{generations:a}=await this.generate([e],t,r);return a[0][0].text}async predict(e,t,r){return this.call(e,t,r)}async predictMessages(e,t,r){const a=(0,y.Sw)(e),n=await this.call(a,t,r);return new y.Od(n)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}}class Ne extends $e{async _generate(e,t,r){return{generations:await Promise.all(e.map(((e,a)=>this._call(e,{...t,promptIndex:a},r).then((e=>[{text:e}])))))}}}class Re extends Ne{static lc_name(){return"Ollama"}constructor(e){super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"llama3"}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:"http://localhost:11434"}),Object.defineProperty(this,"keepAlive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"embeddingOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"f16KV",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitsAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowVram",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mainGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatEta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatTau",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numBatch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numCtx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numKeep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numPredict",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numThread",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"penalizeNewline",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatLastN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tfsZ",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typicalP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMLock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vocabOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e?.model??this.model,this.baseUrl=e?.baseUrl?.endsWith("/")?e?.baseUrl.slice(0,-1):e?.baseUrl??this.baseUrl,this.client=new Pe({host:this.baseUrl,headers:e?.headers}),this.keepAlive=e?.keepAlive,this.embeddingOnly=e?.embeddingOnly,this.f16KV=e?.f16Kv,this.frequencyPenalty=e?.frequencyPenalty,this.logitsAll=e?.logitsAll,this.lowVram=e?.lowVram,this.mainGpu=e?.mainGpu,this.mirostat=e?.mirostat,this.mirostatEta=e?.mirostatEta,this.mirostatTau=e?.mirostatTau,this.numBatch=e?.numBatch,this.numCtx=e?.numCtx,this.numGpu=e?.numGpu,this.numKeep=e?.numKeep,this.numPredict=e?.numPredict,this.numThread=e?.numThread,this.penalizeNewline=e?.penalizeNewline,this.presencePenalty=e?.presencePenalty,this.repeatLastN=e?.repeatLastN,this.repeatPenalty=e?.repeatPenalty,this.temperature=e?.temperature,this.stop=e?.stop,this.tfsZ=e?.tfsZ,this.topK=e?.topK,this.topP=e?.topP,this.typicalP=e?.typicalP,this.useMLock=e?.useMlock,this.useMMap=e?.useMmap,this.vocabOnly=e?.vocabOnly,this.format=e?.format}_llmType(){return"ollama"}invocationParams(e){return{model:this.model,format:this.format,keep_alive:this.keepAlive,images:e?.images,options:{embedding_only:this.embeddingOnly,f16_kv:this.f16KV,frequency_penalty:this.frequencyPenalty,logits_all:this.logitsAll,low_vram:this.lowVram,main_gpu:this.mainGpu,mirostat:this.mirostat,mirostat_eta:this.mirostatEta,mirostat_tau:this.mirostatTau,num_batch:this.numBatch,num_ctx:this.numCtx,num_gpu:this.numGpu,num_keep:this.numKeep,num_predict:this.numPredict,num_thread:this.numThread,penalize_newline:this.penalizeNewline,presence_penalty:this.presencePenalty,repeat_last_n:this.repeatLastN,repeat_penalty:this.repeatPenalty,temperature:this.temperature,stop:e?.stop??this.stop,tfs_z:this.tfsZ,top_k:this.topK,top_p:this.topP,typical_p:this.typicalP,use_mlock:this.useMLock,use_mmap:this.useMMap,vocab_only:this.vocabOnly}}}async*_streamResponseChunks(e,t,r){const a=await this.caller.call((async()=>this.client.generate({...this.invocationParams(t),prompt:e,stream:!0})));for await(const e of a){if(t.signal?.aborted)throw new Error("This operation was aborted");e.done?yield new b.mu({text:"",generationInfo:{model:e.model,total_duration:e.total_duration,load_duration:e.load_duration,prompt_eval_count:e.prompt_eval_count,prompt_eval_duration:e.prompt_eval_duration,eval_count:e.eval_count,eval_duration:e.eval_duration}}):(yield new b.mu({text:e.response,generationInfo:{...e,response:void 0}}),await(r?.handleLLMNewToken(e.response??"")))}}async _call(e,t,r){const a=[];for await(const n of this._streamResponseChunks(e,t,r))a.push(n.text);return a.join("")}}var Le=r(6993),Me=r(3766);r(2771),Le.m;var Ue=r(3650);function Fe(){const e=document.createElement("div");e.className="summary-sidebar";const t=document.createElement("div");t.className="container";const r=document.createElement("nav");r.className="nav-header";const a=document.createElement("button");a.className="back-button",a.innerHTML="⬅️",a.style.display="none";const n=document.createElement("h1");n.innerHTML="MailMind AI ✨",r.appendChild(a),r.appendChild(n);const i=document.createElement("div");i.className="summery-box",i.style.display="none";const s=document.createElement("div");s.className="mail-summery";const o=document.createElement("h3");o.textContent="Summery:",s.appendChild(o);const l=document.createElement("p");s.appendChild(l);const c=document.createElement("div");c.className="action-items";const u=document.createElement("h3");u.textContent="Action Items:";const d=document.createElement("ul");c.appendChild(u),c.appendChild(d);const h=document.createElement("div");h.className="actionButtons";const p=document.createElement("button");p.textContent="Copy";const m=document.createElement("button");m.textContent="Reply";const y=document.createElement("button");y.textContent="Double Check",h.appendChild(p),h.appendChild(y),h.appendChild(m),i.appendChild(s),i.appendChild(c),i.appendChild(h);const b=document.createElement("div");b.className="intoCopy";const v=document.createElement("h2");v.innerHTML='🚀 <span style="color: #32cd32;">Supercharge</span> your gmail with <span style="color: #32cd32;">MailMind AI</span>';const _=document.createElement("p");_.textContent="Tired of reading long emails? MailMind AI brings AI-powered summaries right into your Gmail sidebar. Instantly get the key points, copy, double-check, or reply in seconds—saving you time and effort. Stay focused, work smarter, and never miss important details again!";const w=document.createElement("div"),E=document.createElement("h3");E.textContent="What can we do with MailMind AI?",w.appendChild(E);const O=document.createElement("ul");["Get Summary","Get Action Item (if any)","Double Check"].forEach((e=>{const t=document.createElement("li");t.textContent=e,O.appendChild(t)})),w.appendChild(O);const x=document.createElement("button");x.textContent="Try Now ✨ (by selecting mail)";const k=document.createElement("div");k.className="privacy-toggle-container";const T=document.createElement("label");T.className="toggle-label",T.textContent="Privacy Mode";const I=document.createElement("label");I.className="switch";const S=document.createElement("input");S.type="checkbox";const P=document.createElement("span");return P.className="slider",I.appendChild(S),I.appendChild(P),k.appendChild(T),k.appendChild(I),b.appendChild(v),b.appendChild(_),b.appendChild(w),b.appendChild(x),b.appendChild(k),t.appendChild(r),t.appendChild(i),t.appendChild(b),e.appendChild(t),a.addEventListener("click",(()=>{i.style.display="none",a.style.display="none",b.style.display="block"})),b.style.display,document.addEventListener("click",(async e=>{e.target.closest(".zA")&&(b.style.display="none",i.style.display="block",a.style.display="block")})),p.addEventListener("click",(()=>{(async e=>{try{await navigator.clipboard.writeText(e),(e=>{const t=document.createElement("div");t.textContent=e,t.className="copy-feedback",document.body.appendChild(t),setTimeout((()=>{document.body.removeChild(t)}),2e3)})("Summary copied to clipboard!")}catch(e){console.error("Failed to copy:",e)}})(document.querySelector(".mail-summery p").textContent)})),y.addEventListener("click",(e=>{console.log("Double check clicked"),async function(){const e=document.querySelector(".zA.yO");e?await g(e):(console.error("No email selected for double check"),document.querySelector(".mail-summery p").textContent="Please select an email first.")}()})),m.addEventListener("click",(async()=>{console.log("Reply clicked"),await async function(){try{const t=document.querySelector(".zA.yO");if(!t)throw new Error("No email selected");const r=f(t),a=document.querySelector('[aria-label="Reply"]');if(!a)throw new Error("Reply button not found");{a.click(),await(e=".Am.Al.editable",new Promise((t=>{if(document.querySelector(e))return t();const r=new MutationObserver((()=>{document.querySelector(e)&&(r.disconnect(),t())}));r.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{r.disconnect(),t()}),5e3)})));const t=document.querySelector(".Am.Al.editable");if(t){t.innerHTML="Generating reply...<br><br>";const e=await async function(e){const t=new Re({model:"phi4:latest",temperature:0,maxRetries:2}),r=Ue.PromptTemplate.fromTemplate("\nPlease generate an email reply only not the subject to the following email content.\n\nEmail Content:\n{mail_content}\n\nGenerate Reply:\n").pipe(t);return await r.invoke({mail_content:e})}(r);t.innerHTML=e;const a=window.getSelection(),n=document.createRange();n.selectNodeContents(t),n.collapse(!1),a.removeAllRanges(),a.addRange(n)}}}catch(e){console.error("Error handling reply:",e),alert("Failed to generate reply. Please try again.")}var e}()})),e}r(329),r(9849),r(6279),Me.RZ,window.addEventListener("load",(function(){const e=Fe(),t=document.querySelector(".aUx");t?t.insertBefore(e,t.firstChild):console.error("Target container (.aUx) not found."),async function(){document.addEventListener("click",(async e=>{const t=e.target.closest(".zA");if(t){const e=document.querySelector(".summery-box");document.querySelector(".intoCopy").style.display="none",e.style.display="block",await g(t)}}))}()}))})()})();